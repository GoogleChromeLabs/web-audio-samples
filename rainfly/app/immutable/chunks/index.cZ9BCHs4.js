import{g as Vt}from"./2.D9NOyHvF.js";import{m as Pr,s as Br}from"./editor.api.CvkiD53Q.js";function _r(G,w){for(var pe=0;pe<w.length;pe++){const re=w[pe];if(typeof re!="string"&&!Array.isArray(re)){for(const S in re)if(S!=="default"&&!(S in G)){const H=Object.getOwnPropertyDescriptor(re,S);H&&Object.defineProperty(G,S,H.get?H:{enumerable:!0,get:()=>re[S]})}}}return Object.freeze(Object.defineProperty(G,Symbol.toStringTag,{value:"Module"}))}var Ht={},Wt={},Ft={};const Nr=Vt(Pr),Kr=Vt(Br);(function(G){Object.defineProperty(G,"__esModule",{value:!0}),G.default=void 0;var w=Nr,pe=Kr;function re(y,h){return P(y)||R(y,h)||H(y,h)||S()}function S(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H(y,h){if(y){if(typeof y=="string")return O(y,h);var f=Object.prototype.toString.call(y).slice(8,-1);if(f==="Object"&&y.constructor&&(f=y.constructor.name),f==="Map"||f==="Set")return Array.from(y);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return O(y,h)}}function O(y,h){(h==null||h>y.length)&&(h=y.length);for(var f=0,d=new Array(h);f<h;f++)d[f]=y[f];return d}function R(y,h){var f=y==null?null:typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(f!=null){var d=[],v=!0,m=!1,A,K;try{for(f=f.call(y);!(v=(A=f.next()).done)&&(d.push(A.value),!(h&&d.length===h));v=!0);}catch(V){m=!0,K=V}finally{try{!v&&f.return!=null&&f.return()}finally{if(m)throw K}}return d}}function P(y){if(Array.isArray(y))return y}function U(y){"@babel/helpers - typeof";return U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},U(y)}function _(y,h){if(!(y instanceof h))throw new TypeError("Cannot call a class as a function")}function F(y,h){for(var f=0;f<h.length;f++){var d=h[f];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function D(y,h,f){return h&&F(y.prototype,h),Object.defineProperty(y,"prototype",{writable:!1}),y}var ye={Bottom:4},Ce={readOnly:65,cursorWidth:20,fontInfo:32},Re=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function Ke(y){return/\w/.test(y)||y>"Â€"&&(y.toUpperCase()!=y.toLowerCase()||Re.test(y))}function Ee(y,h){if(!(this instanceof Ee))return new Ee(y,h);this.line=y,this.ch=h}function $e(y,h,f){y.dispatch(h,f)}function Oe(y){return function(){}}var Qe=function(h,f){this.pos=this.start=0,this.string=h,this.tabSize=f||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Qe.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(h){var f=this.string.charAt(this.pos);if(typeof h=="string")var d=f==h;else var d=f&&(h.test?h.test(f):h(f));if(d)return++this.pos,f},eatWhile:function(h){for(var f=this.pos;this.eat(h););return this.pos>f},eatSpace:function(){for(var h=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>h},skipToEnd:function(){this.pos=this.string.length},skipTo:function(h){var f=this.string.indexOf(h,this.pos);if(f>-1)return this.pos=f,!0},backUp:function(h){this.pos-=h},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(h,f,d){if(typeof h=="string"){var v=function(V){return d?V.toLowerCase():V},m=this.string.substr(this.pos,h.length);if(v(m)==v(h))return f!==!1&&(this.pos+=h.length),!0}else{var A=this.string.slice(this.pos).match(h);return A&&A.index>0?null:(A&&f!==!1&&(this.pos+=A[0].length),A)}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(h,f){this.lineStart+=h;try{return f()}finally{this.lineStart-=h}}};function ne(y){return new Ee(y.lineNumber-1,y.column-1)}function J(y){return new w.Position(y.line+1,y.ch+1)}var De=function(){function y(h,f,d,v){_(this,y),this.cm=h,this.id=f,this.lineNumber=d+1,this.column=v+1,h.marks[this.id]=this}return D(y,[{key:"clear",value:function(){delete this.cm.marks[this.id]}},{key:"find",value:function(){return ne(this)}}]),y}();function Ve(y){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f=!0,d=w.KeyCode[y.keyCode];y.key&&(d=y.key,f=!1);var v=d,m=h;switch(y.keyCode){case w.KeyCode.Shift:case w.KeyCode.Meta:case w.KeyCode.Alt:case w.KeyCode.Ctrl:return v;case w.KeyCode.Escape:m=!0,v="Esc";break;case w.KeyCode.Space:m=!0;break}return d.startsWith("Key")||d.startsWith("KEY_")?v=d[d.length-1].toLowerCase():d.startsWith("Digit")?v=d.slice(5,6):d.startsWith("Numpad")?v=d.slice(6,7):d.endsWith("Arrow")?(m=!0,v=d.substring(0,d.length-5)):(d.startsWith("US_")||d.startsWith("Bracket")||!v)&&(v=y.browserEvent.key),!m&&!y.altKey&&!y.ctrlKey&&!y.metaKey?v=y.key||y.browserEvent.key:(y.altKey&&(v="Alt-".concat(v)),y.ctrlKey&&(v="Ctrl-".concat(v)),y.metaKey&&(v="Meta-".concat(v)),y.shiftKey&&(v="Shift-".concat(v))),v.length===1&&f&&(v="'".concat(v,"'")),v}var j=function(){function y(h){_(this,y),Je.call(this),this.editor=h,this.state={keyMap:"vim"},this.marks={},this.$uid=0,this.disposables=[],this.listeners={},this.curOp={},this.attached=!1,this.statusBar=null,this.options={},this.addLocalListeners(),this.ctxInsert=this.editor.createContextKey("insertMode",!0)}return D(y,[{key:"attach",value:function(){y.keyMap.vim.attach(this)}},{key:"addLocalListeners",value:function(){this.disposables.push(this.editor.onDidChangeCursorPosition(this.handleCursorChange),this.editor.onDidChangeModelContent(this.handleChange),this.editor.onKeyDown(this.handleKeyDown))}},{key:"handleReplaceMode",value:function(f,d){var v=!1,m=f,A=this.editor.getPosition(),K=new w.Range(A.lineNumber,A.column,A.lineNumber,A.column+1),V=!0;if(f.startsWith("'"))m=f[1];else if(m==="Enter")m=`
`;else if(m==="Backspace"){var B=this.replaceStack.pop();if(!B)return;v=!0,m=B,K=new w.Range(A.lineNumber,A.column,A.lineNumber,A.column-1)}else return;d.preventDefault(),d.stopPropagation(),this.replaceStack||(this.replaceStack=[]),v||this.replaceStack.push(this.editor.getModel().getValueInRange(K)),this.editor.executeEdits("vim",[{text:m,range:K,forceMoveMarkers:V}]),v&&this.editor.setPosition(K.getStartPosition())}},{key:"setOption",value:function(f,d){this.state[f]=d,f==="theme"&&w.editor.setTheme(d)}},{key:"getConfiguration",value:function(){var f=this.editor,d=Ce;return typeof f.getConfiguration=="function"?f.getConfiguration():("EditorOption"in w.editor&&(d=w.editor.EditorOption),{readOnly:f.getOption(d.readOnly),viewInfo:{cursorWidth:f.getOption(d.cursorWidth)},fontInfo:f.getOption(d.fontInfo)})}},{key:"getOption",value:function(f){return f==="readOnly"?this.getConfiguration().readOnly:f==="firstLineNumber"?this.firstLine()+1:f==="indentWithTabs"?!this.editor.getModel().getOptions().insertSpaces:typeof this.editor.getConfiguration=="function"?this.editor.getRawConfiguration()[f]:this.editor.getRawOptions()[f]}},{key:"dispatch",value:function(f){for(var d=arguments.length,v=new Array(d>1?d-1:0),m=1;m<d;m++)v[m-1]=arguments[m];var A=this.listeners[f];A&&A.forEach(function(K){return K.apply(void 0,v)})}},{key:"on",value:function(f,d){this.listeners[f]||(this.listeners[f]=[]),this.listeners[f].push(d)}},{key:"off",value:function(f,d){var v=this.listeners[f];v&&(this.listeners[f]=v.filter(function(m){return m!==d}))}},{key:"firstLine",value:function(){return 0}},{key:"lastLine",value:function(){return this.lineCount()-1}},{key:"lineCount",value:function(){return this.editor.getModel().getLineCount()}},{key:"defaultTextHeight",value:function(){return 1}},{key:"getLine",value:function(f){if(f<0)return"";var d=this.editor.getModel(),v=d.getLineCount();return f+1>v&&(f=v-1),this.editor.getModel().getLineContent(f+1)}},{key:"getAnchorForSelection",value:function(f){if(f.isEmpty())return f.getPosition();var d=f.getDirection();return d===w.SelectionDirection.LTR?f.getStartPosition():f.getEndPosition()}},{key:"getHeadForSelection",value:function(f){if(f.isEmpty())return f.getPosition();var d=f.getDirection();return d===w.SelectionDirection.LTR?f.getEndPosition():f.getStartPosition()}},{key:"getCursor",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(!f)return ne(this.editor.getPosition());var d=this.editor.getSelection(),v;return d.isEmpty()?v=d.getPosition():f==="anchor"?v=this.getAnchorForSelection(d):v=this.getHeadForSelection(d),ne(v)}},{key:"getRange",value:function(f,d){var v=J(f),m=J(d);return this.editor.getModel().getValueInRange(w.Range.fromPositions(v,m))}},{key:"getSelection",value:function(){var f=[],d=this.editor;return d.getSelections().map(function(v){f.push(d.getModel().getValueInRange(v))}),f.join(`
`)}},{key:"replaceRange",value:function(f,d,v){var m=J(d),A=v?J(v):m;this.editor.executeEdits("vim",[{text:f,range:w.Range.fromPositions(m,A)}]),this.pushUndoStop()}},{key:"pushUndoStop",value:function(){this.editor.pushUndoStop()}},{key:"setCursor",value:function(f,d){var v=f;U(f)!=="object"&&(v={},v.line=f,v.ch=d);var m=this.editor.getModel().validatePosition(J(v));this.editor.setPosition(J(v)),this.editor.revealPosition(m)}},{key:"somethingSelected",value:function(){return!this.editor.getSelection().isEmpty()}},{key:"operation",value:function(f,d){return f()}},{key:"listSelections",value:function(){var f=this,d=this.editor.getSelections();return!d.length||this.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:d.map(function(v){return v.getPosition(),v.getStartPosition(),v.getEndPosition(),{anchor:f.clipPos(ne(f.getAnchorForSelection(v))),head:f.clipPos(ne(f.getHeadForSelection(v)))}})}},{key:"focus",value:function(){this.editor.focus()}},{key:"setSelections",value:function(f,d){var v=!!this.editor.getSelections().length,m=f.map(function(V,B){var Z=V.anchor,te=V.head;return v?w.Selection.fromPositions(J(Z),J(te)):w.Selection.fromPositions(J(te),J(Z))});if(d&&m[d]&&m.push(m.splice(d,1)[0]),!!m.length){var A=m[0],K;A.getDirection()===w.SelectionDirection.LTR?K=A.getEndPosition():K=A.getStartPosition(),this.editor.setSelections(m),this.editor.revealPosition(K)}}},{key:"setSelection",value:function(f,d){var v=w.Range.fromPositions(J(f),J(d));this.editor.setSelection(v)}},{key:"getSelections",value:function(){var f=this.editor;return f.getSelections().map(function(d){return f.getModel().getValueInRange(d)})}},{key:"replaceSelections",value:function(f){var d=this.editor;d.getSelections().forEach(function(v,m){d.executeEdits("vim",[{range:v,text:f[m],forceMoveMarkers:!1}])})}},{key:"toggleOverwrite",value:function(f){f?(this.enterVimMode(),this.replaceMode=!0):(this.leaveVimMode(),this.replaceMode=!1,this.replaceStack=[])}},{key:"charCoords",value:function(f,d){return{top:f.line,left:f.ch}}},{key:"coordsChar",value:function(f,d){}},{key:"clipPos",value:function(f){var d=this.editor.getModel().validatePosition(J(f));return ne(d)}},{key:"setBookmark",value:function(f,d){var v=new De(this,this.$uid++,f.line,f.ch);return(!d||!d.insertLeft)&&(v.$insertRight=!0),this.marks[v.id]=v,v}},{key:"getScrollInfo",value:function(){var f=this.editor,d=f.getVisibleRanges(),v=re(d,1),m=v[0];return{left:0,top:m.startLineNumber-1,height:f.getModel().getLineCount(),clientHeight:m.endLineNumber-m.startLineNumber+1}}},{key:"triggerEditorAction",value:function(f){this.editor.trigger("vim",f)}},{key:"dispose",value:function(){this.dispatch("dispose"),this.removeOverlay(),y.keyMap.vim&&y.keyMap.vim.detach(this),this.disposables.forEach(function(f){return f.dispose()})}},{key:"getInputField",value:function(){}},{key:"getWrapperElement",value:function(){}},{key:"enterVimMode",value:function(){this.ctxInsert.set(!1);var f=this.getConfiguration();this.initialCursorWidth=f.viewInfo.cursorWidth||0,this.editor.updateOptions({cursorWidth:f.fontInfo.typicalFullwidthCharacterWidth,cursorBlinking:"solid"})}},{key:"leaveVimMode",value:function(){this.ctxInsert.set(!0),this.editor.updateOptions({cursorWidth:this.initialCursorWidth||0,cursorBlinking:"blink"})}},{key:"virtualSelectionMode",value:function(){return this.inVirtualSelectionMode}},{key:"markText",value:function(){return{clear:function(){},find:function(){}}}},{key:"getUserVisibleLines",value:function(){var f=this.editor.getVisibleRanges();if(!f.length)return{top:0,bottom:0};var d={top:1/0,bottom:0};return f.reduce(function(v,m){return m.startLineNumber<v.top&&(v.top=m.startLineNumber),m.endLineNumber>v.bottom&&(v.bottom=m.endLineNumber),v},d),d.top-=1,d.bottom-=1,d}},{key:"findPosV",value:function(f,d,v){var m=this.editor,A=d,K=v,V=J(f);if(v==="page"){var B=m.getLayoutInfo().height,Z=this.getConfiguration().fontInfo.lineHeight;A=A*Math.floor(B/Z),K="line"}return K==="line"&&(V.lineNumber+=A),ne(V)}},{key:"findMatchingBracket",value:function(f){var d=J(f),v=this.editor.getModel(),m;if(v.bracketPairs)m=v.bracketPairs.matchBracket(d);else{var A;m=(A=v.matchBracket)===null||A===void 0?void 0:A.call(v,d)}return!m||m.length!==2?{to:null}:{to:ne(m[1].getStartPosition())}}},{key:"findFirstNonWhiteSpaceCharacter",value:function(f){return this.editor.getModel().getLineFirstNonWhitespaceColumn(f+1)-1}},{key:"scrollTo",value:function(f,d){!f&&!d||f||(d<0&&(d=this.editor.getPosition().lineNumber-d),this.editor.setScrollTop(this.editor.getTopForLineNumber(d+1)))}},{key:"moveCurrentLineTo",value:function(f){var d,v=this.editor,m=v.getPosition(),A=w.Range.fromPositions(m,m);switch(f){case"top":v.revealRangeAtTop(A);return;case"center":v.revealRangeInCenter(A);return;case"bottom":(d=v._revealRange)===null||d===void 0||d.call(v,A,ye.Bottom);return}}},{key:"getSearchCursor",value:function(f,d){var v=!1,m=!1;f instanceof RegExp&&!f.global&&(v=!f.ignoreCase,f=f.source,m=!0),d.ch==null&&(d.ch=Number.MAX_VALUE);var A=J(d),K=this,V=this.editor,B=null,Z=V.getModel(),te=Z.findMatches(f,!1,m,v)||[];return{getMatches:function(){return te},findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},jumpTo:function(ke){if(!te||!te.length)return!1;var ie=te[ke];return B=ie.range,K.highlightRanges([B],"currentFindMatch"),K.highlightRanges(te.map(function(le){return le.range}).filter(function(le){return!le.equalsRange(B)})),B},find:function(ke){if(!te||!te.length)return!1;var ie;if(ke){var le=B?B.getStartPosition():A;if(ie=Z.findPreviousMatch(f,le,m,v),!ie||!ie.range.getStartPosition().isBeforeOrEqual(le))return!1}else{var xe=B?Z.getPositionAt(Z.getOffsetAt(B.getEndPosition())+1):A;if(ie=Z.findNextMatch(f,xe,m,v),!ie||!xe.isBeforeOrEqual(ie.range.getStartPosition()))return!1}return B=ie.range,K.highlightRanges([B],"currentFindMatch"),K.highlightRanges(te.map(function(L){return L.range}).filter(function(L){return!L.equalsRange(B)})),B},from:function(){return B&&ne(B.getStartPosition())},to:function(){return B&&ne(B.getEndPosition())},replace:function(ke){B&&(V.executeEdits("vim",[{range:B,text:ke,forceMoveMarkers:!0}],function(ie){var le=ie[0].range,xe=le.endLineNumber,L=le.endColumn;B=B.setEndPosition(xe,L)}),V.setPosition(B.getStartPosition()))}}}},{key:"highlightRanges",value:function(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"findMatch",v="decoration".concat(d);return this[v]=this.editor.deltaDecorations(this[v]||[],f.map(function(m){return{range:m,options:{stickiness:w.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,zIndex:13,className:d,showIfCollapsed:!0}}})),this[v]}},{key:"addOverlay",value:function(f,d,v){var m=f.query,A=!1,K=!1;m&&m instanceof RegExp&&!m.global&&(K=!0,A=!m.ignoreCase,m=m.source);var V=this.editor.getModel().findNextMatch(m,this.editor.getPosition(),K,A);!V||!V.range||this.highlightRanges([V.range])}},{key:"removeOverlay",value:function(){var f=this;["currentFindMatch","findMatch"].forEach(function(d){f.editor.deltaDecorations(f["decoration".concat(d)]||[],[])})}},{key:"scrollIntoView",value:function(f){f&&this.editor.revealPosition(J(f))}},{key:"moveH",value:function(f,d){if(d==="char"){var v=this.editor.getPosition();this.editor.setPosition(new w.Position(v.lineNumber,v.column+f))}}},{key:"scanForBracket",value:function(f,d,v,m){for(var A=m.bracketRegex,K=J(f),V=this.editor.getModel(),B=(d===-1?V.findPreviousMatch:V.findNextMatch).bind(V),Z=[],te=0;;){if(te>10)return;var Y=B(A.source,K,!0,!0,null,!0),ke=Y.matches[0];if(Y===void 0)return;var ie=y.matchingBrackets[ke];if(ie&&ie.charAt(1)===">"==d>0)Z.push(ke);else if(Z.length===0){var le=Y.range.getStartPosition();return{pos:ne(le)}}else Z.pop();K=V.getPositionAt(V.getOffsetAt(Y.range.getStartPosition())+d),te+=1}}},{key:"indexFromPos",value:function(f){return this.editor.getModel().getOffsetAt(J(f))}},{key:"posFromIndex",value:function(f){return ne(this.editor.getModel().getPositionAt(f))}},{key:"indentLine",value:function(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,v=this.editor,m;v._getViewModel?m=v._getViewModel().cursorConfig:m=v._getCursors().context.config;var A=new w.Position(f+1,1),K=w.Selection.fromPositions(A,A);v.executeCommand("vim",new pe.ShiftCommand(K,{isUnshift:!d,tabSize:m.tabSize,indentSize:m.indentSize,insertSpaces:m.insertSpaces,useTabStops:m.useTabStops,autoIndent:m.autoIndent}))}},{key:"setStatusBar",value:function(f){this.statusBar=f}},{key:"openDialog",value:function(f,d,v){if(this.statusBar)return this.statusBar.setSec(f,d,v)}},{key:"openNotification",value:function(f){this.statusBar&&this.statusBar.showNotification(f)}},{key:"smartIndent",value:function(){this.editor.getAction("editor.action.formatSelection").run()}},{key:"moveCursorTo",value:function(f){var d=this.editor.getPosition();f==="start"?d.column=1:f==="end"&&(d.column=this.editor.getModel().getLineMaxColumn(d.lineNumber)),this.editor.setPosition(d)}},{key:"execCommand",value:function(f){switch(f){case"goLineLeft":this.moveCursorTo("start");break;case"goLineRight":this.moveCursorTo("end");break;case"indentAuto":this.smartIndent();break}}}]),y}();j.Pos=Ee,j.signal=$e,j.on=Oe(),j.off=Oe(),j.addClass=Oe(),j.rmClass=Oe(),j.defineOption=Oe(),j.keyMap={default:function(h){return function(f){return!0}}},j.matchingBrackets={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"},j.isWordChar=Ke,j.keyName=Ve,j.StringStream=Qe,j.e_stop=function(y){return y.stopPropagation?y.stopPropagation():y.cancelBubble=!0,j.e_preventDefault(y),!1},j.e_preventDefault=function(y){return y.preventDefault?(y.preventDefault(),y.browserEvent&&y.browserEvent.preventDefault()):y.returnValue=!1,!1},j.commands={redo:function(h){h.editor.getModel().redo()},undo:function(h){h.editor.getModel().undo()},newlineAndIndent:function(h){h.triggerEditorAction("editor.action.insertLineAfter")}},j.lookupKey=function y(h,f,d){typeof f=="string"&&(f=j.keyMap[f]);var v=typeof f=="function"?f(h):f[h];if(v===!1)return"nothing";if(v==="...")return"multi";if(v!=null&&d(v))return"handled";if(f.fallthrough){if(!Array.isArray(f.fallthrough))return y(h,f.fallthrough,d);for(var m=0;m<f.fallthrough.length;m++){var A=y(h,f.fallthrough[m],d);if(A)return A}}},j.defineExtension=function(y,h){j.prototype[y]=h};var Je=function(){var h=this;this.handleKeyDown=function(f){if(!(f.browserEvent.defaultPrevented&f.keyCode!==w.KeyCode.Escape)&&h.attached){var d=Ve(f);if(h.replaceMode&&h.handleReplaceMode(d,f),!!d){var v=h.state.keyMap;if(j.keyMap[v]&&j.keyMap[v].call){var m=j.keyMap[v].call(d,h);if(m){f.preventDefault(),f.stopPropagation();try{m()}catch(A){console.error(A)}}}}}},this.handleCursorChange=function(f){var d=f.position;f.source;var v=h.editor,m=v.getSelection();if(!h.ctxInsert.get()&&f.source==="mouse"&&m.isEmpty()){var A=v.getModel().getLineMaxColumn(d.lineNumber);if(f.position.column===A){v.setPosition(new w.Position(f.position.lineNumber,A-1));return}}h.dispatch("cursorActivity",h,f)},this.handleChange=function(f){var d=f.changes,v={text:d.reduce(function(A,K){return A.push(K.text),A},[]),origin:"+input"},m=h.curOp=h.curOp||{};m.changeHandlers||(m.changeHandlers=h.listeners.change&&h.listeners.change.slice()),!h.virtualSelectionMode()&&(m.lastChange?m.lastChange.next=m.lastChange=v:m.lastChange=m.change=v,h.dispatch("change",h,v))}},Ze=j;G.default=Ze})(Ft);(function(G){Object.defineProperty(G,"__esModule",{value:!0}),G.default=G.Vim=void 0;var w=pe(Ft);function pe(F){return F&&F.__esModule?F:{default:F}}function re(F){"@babel/helpers - typeof";return re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},re(F)}var S=w.default.Pos;function H(F,D){var ye=F.state.vim;if(!ye||ye.insertMode)return D.head;var Ce=ye.sel.head;if(!Ce)return D.head;if(!(ye.visualBlock&&D.head.line!=Ce.line))return D.from()==D.anchor&&!D.empty()&&D.head.line==Ce.line&&D.head.ch!=Ce.ch?new S(D.head.line,D.head.ch-1):D.head}var O=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],R=O.length,P=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"global",shortName:"g"}],U=function(){function D(n){n.setOption("disableInput",!0),n.setOption("showCursorWhenSelecting",!1),w.default.signal(n,"vim-mode-change",{mode:"normal"}),n.on("cursorActivity",_t),xe(n),n.enterVimMode()}function ye(n){n.setOption("disableInput",!1),n.off("cursorActivity",_t),n.state.vim=null,qe&&clearTimeout(qe),n.leaveVimMode()}function Ce(n,e){n.attached=!1,this==w.default.keyMap.vim&&(n.options.$customCursor=null),(!e||e.attach!=Re)&&ye(n)}function Re(n,e){this==w.default.keyMap.vim&&(n.attached=!0,n.curOp&&(n.curOp.selectionChanged=!0),n.options.$customCursor=H),(!e||e.attach!=Re)&&D(n)}w.default.defineOption("vimMode",!1,function(n,e,t){e&&n.getOption("keyMap")!="vim"?n.setOption("keyMap","vim"):!e&&t!=w.default.Init&&/^vim/.test(n.getOption("keyMap"))&&n.setOption("keyMap","default")});function Ke(n,e){if(e){if(this[n])return this[n];var t=Oe(n);if(!t)return!1;var r=_e.findKey(e,t);return typeof r=="function"&&w.default.signal(e,"vim-keypress",t),r}}var Ee={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A",CapsLock:""},$e={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"};function Oe(n){if(n.charAt(0)=="'")return n.charAt(1);if(n==="AltGraph")return!1;var e=n.split(/-(?!$)/),t=e[e.length-1];if(e.length==1&&e[0].length==1)return!1;if(e.length==2&&e[0]=="Shift"&&t.length==1)return!1;for(var r=!1,i=0;i<e.length;i++){var o=e[i];o in Ee?e[i]=Ee[o]:r=!0,o in $e&&(e[i]=$e[o])}return r?(m(t)&&(e[e.length-1]=t.toLowerCase()),"<"+e.join("-")+">"):!1}var Qe=/[\d]/,ne=[w.default.isWordChar,function(n){return n&&!w.default.isWordChar(n)&&!/\s/.test(n)}],J=[function(n){return/\S/.test(n)}];function De(n,e){for(var t=[],r=n;r<n+e;r++)t.push(String.fromCharCode(r));return t}var Ve=De(65,26),j=De(97,26),Je=De(48,10),Ze=[].concat(Ve,j,Je,["<",">"]),y=[].concat(Ve,j,Je,["-",'"',".",":","_","/"]),h;try{h=new RegExp("^[\\p{Lu}]$","u")}catch{h=/^[A-Z]$/}function f(n,e){return e>=n.firstLine()&&e<=n.lastLine()}function d(n){return/^[a-z]$/.test(n)}function v(n){return Qe.test(n)}function m(n){return h.test(n)}function A(n){return/^\s*$/.test(n)}function K(n){return".?!".indexOf(n)!=-1}function V(n,e){for(var t=0;t<e.length;t++)if(e[t]==n)return!0;return!1}var B={};function Z(n,e,t,r,i){if(e===void 0&&!i)throw Error("defaultValue is required unless callback is provided");if(t||(t="string"),B[n]={type:t,defaultValue:e,callback:i},r)for(var o=0;o<r.length;o++)B[r[o]]=B[n];e&&te(n,e)}function te(n,e,t,r){var i=B[n];r=r||{};var o=r.scope;if(!i)return new Error("Unknown option: "+n);if(i.type=="boolean"){if(e&&e!==!0)return new Error("Invalid argument: "+n+"="+e);e!==!1&&(e=!0)}i.callback?(o!=="local"&&i.callback(e,void 0),o!=="global"&&t&&i.callback(e,t)):(o!=="local"&&(i.value=i.type=="boolean"?!!e:e),o!=="global"&&t&&(t.state.vim.options[n]={value:e}))}function Y(n,e,t){var r=B[n];t=t||{};var i=t.scope;if(!r)return new Error("Unknown option: "+n);if(r.callback){var o=e&&r.callback(void 0,e);return i!=="global"&&o!==void 0?o:i!=="local"?r.callback():void 0}else{var o=i!=="global"&&e&&e.state.vim.options[n];return(o||i!=="local"&&r||{}).value}}Z("filetype",void 0,"string",["ft"],function(n,e){if(e!==void 0)if(n===void 0){var t=e.getOption("mode");return t=="null"?"":t}else{var t=n==""?"null":n;e.setOption("mode",t)}});var ke=function(){var e=100,t=-1,r=0,i=0,o=new Array(e);function a(u,c,p){var k=t%e,C=o[k];function g(x){var M=++t%e,E=o[M];E&&E.clear(),o[M]=u.setBookmark(x)}if(C){var b=C.find();b&&!ve(b,c)&&g(c)}else g(c);g(p),r=t,i=t-e+1,i<0&&(i=0)}function s(u,c){t+=c,t>r?t=r:t<i&&(t=i);var p=o[(e+t)%e];if(p&&!p.find()){var k=c>0?1:-1,C,g=u.getCursor();do if(t+=k,p=o[(e+t)%e],p&&(C=p.find())&&!ve(g,C))break;while(t<r&&t>i)}return p}function l(u,c){var p=t,k=s(u,c);return t=p,k&&k.find()}return{cachedCursor:void 0,add:a,find:l,move:s}},ie=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};function le(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=ie()}le.prototype={exitMacroRecordMode:function(){var e=L.macroModeState;e.onRecordingDone&&e.onRecordingDone(),e.onRecordingDone=void 0,e.isRecording=!1},enterMacroRecordMode:function(e,t){var r=L.registerController.getRegister(t);r&&(r.clear(),this.latestRegister=t,e.openDialog&&(this.onRecordingDone=e.openDialog(document.createTextNode("(recording)["+t+"]"),null,{bottom:!0})),this.isRecording=!0)}};function xe(n){return n.state.vim||(n.state.vim={inputState:new ze,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),n.state.vim}var L;function lt(){L={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:ke(),macroModeState:new le,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new ut({}),searchHistoryController:new et,exCommandHistoryController:new et};for(var n in B){var e=B[n];e.value=e.defaultValue}}var He,_e={buildKeyMap:function(){},getRegisterController:function(){return L.registerController},resetVimGlobalState_:lt,getVimGlobalState_:function(){return L},maybeInitVimState_:xe,suppressErrorLogging:!1,InsertModeKey:st,map:function(e,t,r){be.map(e,t,r)},unmap:function(e,t){return be.unmap(e,t)},noremap:function(e,t,r){function i(C){return C?[C]:["normal","insert","visual"]}for(var o=i(r),a=O.length,s=R,l=a-s;l<a&&o.length;l++){var u=O[l];if(u.keys==t&&(!r||!u.context||u.context===r)&&u.type.substr(0,2)!=="ex"&&u.type.substr(0,3)!=="key"){var c={};for(var p in u)c[p]=u[p];c.keys=e,r&&!c.context&&(c.context=r),this._mapCommand(c);var k=i(u.context);o=o.filter(function(C){return k.indexOf(C)===-1})}}},mapclear:function(e){var t=O.length,r=R,i=O.slice(0,t-r);if(O=O.slice(t-r),e)for(var o=i.length-1;o>=0;o--){var a=i[o];if(e!==a.context)if(a.context)this._mapCommand(a);else{var s=["normal","insert","visual"];for(var l in s)if(s[l]!==e){var u={};for(var c in a)u[c]=a[c];u.context=s[l],this._mapCommand(u)}}}},setOption:te,getOption:Y,defineOption:Z,defineEx:function(e,t,r){if(!t)t=e;else if(e.indexOf(t)!==0)throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered');Ot[e]=r,be.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,r){var i=this.findKey(e,t,r);if(typeof i=="function")return i()},findKey:function(e,t,r){var i=xe(e);function o(){var p=L.macroModeState;if(p.isRecording){if(t=="q")return p.exitMacroRecordMode(),he(e),!0;r!="mapping"&&Ir(p,t)}}function a(){if(t=="<Esc>"){if(i.visualMode)we(e);else if(i.insertMode)Fe(e);else return;return he(e),!0}}function s(p){for(var k;p;)k=/<\w+-.+?>|<\w+>|./.exec(p),t=k[0],p=p.substring(k.index+t.length),_e.handleKey(e,t,"mapping")}function l(){if(a())return!0;for(var p=i.inputState.keyBuffer=i.inputState.keyBuffer+t,k=t.length==1,C=Te.matchCommand(p,O,i.inputState,"insert");p.length>1&&C.type!="full";){var p=i.inputState.keyBuffer=p.slice(1),g=Te.matchCommand(p,O,i.inputState,"insert");g.type!="none"&&(C=g)}if(C.type=="none")return he(e),!1;if(C.type=="partial")return He&&window.clearTimeout(He),He=window.setTimeout(function(){i.insertMode&&i.inputState.keyBuffer&&he(e)},Y("insertModeEscKeysTimeout")),!k;if(He&&window.clearTimeout(He),k){for(var b=e.listSelections(),x=0;x<b.length;x++){var M=b[x].head;e.replaceRange("",ue(M,0,-(p.length-1)),M,"+input")}L.macroModeState.lastInsertModeChanges.changes.pop()}return he(e),C.command}function u(){if(o()||a())return!0;var p=i.inputState.keyBuffer=i.inputState.keyBuffer+t;if(/^[1-9]\d*$/.test(p))return!0;var b=/^(\d*)(.*)$/.exec(p);if(!b)return he(e),!1;var k=i.visualMode?"visual":"normal",C=b[2]||b[1];i.inputState.operatorShortcut&&i.inputState.operatorShortcut.slice(-1)==C&&(C=i.inputState.operatorShortcut);var g=Te.matchCommand(C,O,i.inputState,k);if(g.type=="none")return he(e),!1;if(g.type=="partial")return!0;i.inputState.keyBuffer="";var b=/^(\d*)(.*)$/.exec(p);return b[1]&&b[1]!="0"&&i.inputState.pushRepeatDigit(b[1]),g.command}var c;return i.insertMode?c=l():c=u(),c===!1?!i.insertMode&&t.length===1?function(){return!0}:void 0:c===!0?function(){return!0}:function(){return e.operation(function(){e.curOp.isVimOp=!0;try{c.type=="keyToKey"?s(c.toKeys):Te.processCommand(e,i,c)}catch(p){throw e.state.vim=void 0,xe(e),_e.suppressErrorLogging||console.log(p),p}return!0})}},handleEx:function(e,t){be.processCommand(e,t)},defineMotion:$t,defineAction:Jt,defineOperator:Qt,mapCommand:Ar,_mapCommand:Pt,defineRegister:jt,exitVisualMode:we,exitInsertMode:Fe};function ze(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}ze.prototype.pushRepeatDigit=function(n){this.operator?this.motionRepeat=this.motionRepeat.concat(n):this.prefixRepeat=this.prefixRepeat.concat(n)},ze.prototype.getRepeat=function(){var n=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(n=1,this.prefixRepeat.length>0&&(n*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(n*=parseInt(this.motionRepeat.join(""),10))),n};function he(n,e){n.state.vim.inputState=new ze,w.default.signal(n,"vim-command-done",e)}function me(n,e,t){this.clear(),this.keyBuffer=[n||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!e,this.blockwise=!!t}me.prototype={setText:function(e,t,r){this.keyBuffer=[e||""],this.linewise=!!t,this.blockwise=!!r},pushText:function(e,t){t&&(this.linewise||this.keyBuffer.push(`
`),this.linewise=!0),this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(ie(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}};function jt(n,e){var t=L.registerController.registers;if(!n||n.length!=1)throw Error("Register name must be 1 character");if(t[n])throw Error("Register already defined "+n);t[n]=e,y.push(n)}function ut(n){this.registers=n,this.unnamedRegister=n['"']=new me,n["."]=new me,n[":"]=new me,n["/"]=new me}ut.prototype={pushText:function(e,t,r,i,o){if(e!=="_"){i&&r.charAt(r.length-1)!==`
`&&(r+=`
`);var a=this.isValidRegister(e)?this.getRegister(e):null;if(!a){switch(t){case"yank":this.registers[0]=new me(r,i,o);break;case"delete":case"change":r.indexOf(`
`)==-1?this.registers["-"]=new me(r,i):(this.shiftNumericRegisters_(),this.registers[1]=new me(r,i));break}this.unnamedRegister.setText(r,i,o);return}var s=m(e);s?a.pushText(r,i):a.setText(r,i,o),this.unnamedRegister.setText(a.toString(),i)}},getRegister:function(e){return this.isValidRegister(e)?(e=e.toLowerCase(),this.registers[e]||(this.registers[e]=new me),this.registers[e]):this.unnamedRegister},isValidRegister:function(e){return e&&V(e,y)},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--)this.registers[e]=this.getRegister(""+(e-1))}};function et(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}et.prototype={nextMatch:function(e,t){var r=this.historyBuffer,i=t?-1:1;this.initialPrefix===null&&(this.initialPrefix=e);for(var o=this.iterator+i;t?o>=0:o<r.length;o+=i)for(var a=r[o],s=0;s<=a.length;s++)if(this.initialPrefix==a.substring(0,s))return this.iterator=o,a;if(o>=r.length)return this.iterator=r.length,this.initialPrefix;if(o<0)return e},pushInput:function(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1),e.length&&this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var Te={matchCommand:function(e,t,r,i){var o=zt(e,t,i,r);if(!o.full&&!o.partial)return{type:"none"};if(!o.full&&o.partial)return{type:"partial"};for(var a,s=0;s<o.full.length;s++){var l=o.full[s];a||(a=l)}if(a.keys.slice(-11)=="<character>"){var u=Xt(e);if(!u)return{type:"none"};r.selectedCharacter=u}return{type:"full",command:a}},processCommand:function(e,t,r){switch(t.inputState.repeatOverride=r.repeatOverride,r.type){case"motion":this.processMotion(e,t,r);break;case"operator":this.processOperator(e,t,r);break;case"operatorMotion":this.processOperatorMotion(e,t,r);break;case"action":this.processAction(e,t,r);break;case"search":this.processSearch(e,t,r);break;case"ex":case"keyToEx":this.processEx(e,t,r);break}},processMotion:function(e,t,r){t.inputState.motion=r.motion,t.inputState.motionArgs=Ge(r.motionArgs),this.evalInput(e,t)},processOperator:function(e,t,r){var i=t.inputState;if(i.operator)if(i.operator==r.operator){i.motion="expandToLine",i.motionArgs={linewise:!0},this.evalInput(e,t);return}else he(e);i.operator=r.operator,i.operatorArgs=Ge(r.operatorArgs),r.keys.length>1&&(i.operatorShortcut=r.keys),r.exitVisualBlock&&(t.visualBlock=!1,Ne(e)),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,r){var i=t.visualMode,o=Ge(r.operatorMotionArgs);o&&i&&o.visualLine&&(t.visualLine=!0),this.processOperator(e,t,r),i||this.processMotion(e,t,r)},processAction:function(e,t,r){var i=t.inputState,o=i.getRepeat(),a=!!o,s=Ge(r.actionArgs)||{};i.selectedCharacter&&(s.selectedCharacter=i.selectedCharacter),r.operator&&this.processOperator(e,t,r),r.motion&&this.processMotion(e,t,r),(r.motion||r.operator)&&this.evalInput(e,t),s.repeat=o||1,s.repeatIsExplicit=a,s.registerName=i.registerName,he(e),t.lastMotion=null,r.isEdit&&this.recordLastEdit(t,i,r),tt[r.action](e,s,t)},processSearch:function(e,t,r){if(!e.getSearchCursor)return;var i=r.searchArgs.forward,o=r.searchArgs.wholeWordOnly;Me(e).setReversed(!i);var a=i?"/":"?",s=Me(e).getQuery(),l=e.getScrollInfo();function u(M,E,T){L.searchHistoryController.pushInput(M),L.searchHistoryController.reset();try{We(e,M,E,T)}catch{$(e,"Invalid regex: "+M),he(e);return}Te.processMotion(e,t,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:r.searchArgs.toJumplist}})}function c(M){e.scrollTo(l.left,l.top),u(M,!0,!0);var E=L.macroModeState;E.isRecording&&Er(E,M)}function p(M,E,T){var I=w.default.keyName(M),Q,fe;I=="Up"||I=="Down"?(Q=I=="Up",fe=M.target?M.target.selectionEnd:0,E=L.searchHistoryController.nextMatch(E,Q)||"",T(E),fe&&M.target&&(M.target.selectionEnd=M.target.selectionStart=Math.min(fe,M.target.value.length))):I!="Left"&&I!="Right"&&I!="Ctrl"&&I!="Alt"&&I!="Shift"&&L.searchHistoryController.reset();var X;try{X=We(e,E,!0,!0)}catch{}X?e.scrollIntoView(Tt(e,!i,X),30):(ot(e),e.scrollTo(l.left,l.top))}function k(M,E,T){var I=w.default.keyName(M);I=="Esc"||I=="Ctrl-C"||I=="Ctrl-["||I=="Backspace"&&E==""?(L.searchHistoryController.pushInput(E),L.searchHistoryController.reset(),We(e,s),ot(e),e.scrollTo(l.left,l.top),w.default.e_stop(M),he(e),T(),e.focus()):I=="Up"||I=="Down"?w.default.e_stop(M):I=="Ctrl-U"&&(w.default.e_stop(M),T(""))}switch(r.searchArgs.querySrc){case"prompt":var C=L.macroModeState;if(C.isPlaying){var x=C.replaySearchQueries.shift();u(x,!0,!1)}else Ye(e,{onClose:c,prefix:a,desc:"(JavaScript regexp)",onKeyUp:p,onKeyDown:k});break;case"wordUnderCursor":var g=Xe(e,!1,!0,!1,!0),b=!0;if(g||(g=Xe(e,!1,!0,!1,!1),b=!1),!g)return;var x=e.getLine(g.start.line).substring(g.start.ch,g.end.ch);b&&o?x="\\b"+x+"\\b":x=Yt(x),L.jumpList.cachedCursor=e.getCursor(),e.setCursor(g.start),u(x,!0,!1);break}},processEx:function(e,t,r){function i(a){L.exCommandHistoryController.pushInput(a),L.exCommandHistoryController.reset(),be.processCommand(e,a)}function o(a,s,l){var u=w.default.keyName(a),c,p;(u=="Esc"||u=="Ctrl-C"||u=="Ctrl-["||u=="Backspace"&&s=="")&&(L.exCommandHistoryController.pushInput(s),L.exCommandHistoryController.reset(),w.default.e_stop(a),he(e),l(),e.focus()),u=="Up"||u=="Down"?(w.default.e_stop(a),c=u=="Up",p=a.target?a.target.selectionEnd:0,s=L.exCommandHistoryController.nextMatch(s,c)||"",l(s),p&&a.target&&(a.target.selectionEnd=a.target.selectionStart=Math.min(p,a.target.value.length))):u=="Ctrl-U"?(w.default.e_stop(a),l("")):u!="Left"&&u!="Right"&&u!="Ctrl"&&u!="Alt"&&u!="Shift"&&L.exCommandHistoryController.reset()}r.type=="keyToEx"?be.processCommand(e,r.exArgs.input):t.visualMode?Ye(e,{onClose:i,prefix:":",value:"'<,'>",onKeyDown:o,selectValueOnOpen:!1}):Ye(e,{onClose:i,prefix:":",onKeyDown:o})},evalInput:function(e,t){var r=t.inputState,i=r.motion,o=r.motionArgs||{},a=r.operator,s=r.operatorArgs||{},l=r.registerName,u=t.sel,c=z(t.visualMode?de(e,u.head):e.getCursor("head")),p=z(t.visualMode?de(e,u.anchor):e.getCursor("anchor")),k=z(c),C=z(p),g,b,x;if(a&&this.recordLastEdit(t,r),r.repeatOverride!==void 0?x=r.repeatOverride:x=r.getRepeat(),x>0&&o.explicitRepeat?o.repeatIsExplicit=!0:(o.noRepeat||!o.explicitRepeat&&x===0)&&(x=1,o.repeatIsExplicit=!1),r.selectedCharacter&&(o.selectedCharacter=s.selectedCharacter=r.selectedCharacter),o.repeat=x,he(e),i){var M=Le[i](e,c,o,t,r);if(t.lastMotion=Le[i],!M)return;if(o.toJumplist){var E=L.jumpList,T=E.cachedCursor;T?(yt(e,T,M),delete E.cachedCursor):yt(e,c,M)}M instanceof Array?(b=M[0],g=M[1]):g=M,g||(g=z(c)),t.visualMode?(t.visualBlock&&g.ch===1/0||(g=de(e,g)),b&&(b=de(e,b)),b=b||C,u.anchor=b,u.head=g,Ne(e),Ae(e,t,"<",q(b,g)?b:g),Ae(e,t,">",q(b,g)?g:b)):a||(g=de(e,g),e.setCursor(g.line,g.ch))}if(a){if(s.lastSel){b=C;var I=s.lastSel,Q=Math.abs(I.head.line-I.anchor.line),fe=Math.abs(I.head.ch-I.anchor.ch);I.visualLine?g=new S(C.line+Q,C.ch):I.visualBlock?g=new S(C.line+Q,C.ch+fe):I.head.line==I.anchor.line?g=new S(C.line,C.ch+fe):g=new S(C.line+Q,C.ch),t.visualMode=!0,t.visualLine=I.visualLine,t.visualBlock=I.visualBlock,u=t.sel={anchor:b,head:g},Ne(e)}else t.visualMode&&(s.lastSel={anchor:z(u.anchor),head:z(u.head),visualBlock:t.visualBlock,visualLine:t.visualLine});var X,ae,W,N,oe;if(t.visualMode){if(X=ge(u.head,u.anchor),ae=Pe(u.head,u.anchor),W=t.visualLine||s.linewise,N=t.visualBlock?"block":W?"line":"char",oe=nt(e,{anchor:X,head:ae},N),W){var ce=oe.ranges;if(N=="block")for(var se=0;se<ce.length;se++)ce[se].head.ch=ee(e,ce[se].head.line);else N=="line"&&(ce[0].head=new S(ce[0].head.line+1,0))}}else{if(X=z(b||C),ae=z(g||k),q(ae,X)){var Ie=X;X=ae,ae=Ie}W=o.linewise||s.linewise,W?ir(e,X,ae):o.forward&&nr(e,X,ae),N="char";var Ue=!o.inclusive||W;oe=nt(e,{anchor:X,head:ae},N,Ue)}e.setSelections(oe.ranges,oe.primary),t.lastMotion=null,s.repeat=x,s.registerName=l,s.linewise=W;var je=ct[a](e,s,oe.ranges,C,g);t.visualMode&&we(e,je!=null),je&&e.setCursor(je)}},recordLastEdit:function(e,t,r){var i=L.macroModeState;i.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=r,i.lastInsertModeChanges.changes=[],i.lastInsertModeChanges.expectCursorActivityForChange=!1,i.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0)}},Le={moveToTopLine:function(e,t,r){var i=at(e).top+r.repeat-1;return new S(i,Se(e.getLine(i)))},moveToMiddleLine:function(e){var t=at(e),r=Math.floor((t.top+t.bottom)*.5);return new S(r,Se(e.getLine(r)))},moveToBottomLine:function(e,t,r){var i=at(e).bottom-r.repeat+1;return new S(i,Se(e.getLine(i)))},expandToLine:function(e,t,r){var i=t;return new S(i.line+r.repeat-1,1/0)},findNext:function(e,t,r){var i=Me(e),o=i.getQuery();if(o){var a=!r.forward;return a=i.isReversed()?!a:a,At(e,o),Tt(e,a,o,r.repeat)}},findAndSelectNextInclusive:function(e,t,r,i,o){var a=Me(e),s=a.getQuery();if(s){var l=!r.forward;l=a.isReversed()?!l:l;var u=br(e,l,s,r.repeat,i);if(u){if(o.operator)return u;var c=u[0],p=new S(u[1].line,u[1].ch-1);if(i.visualMode){(i.visualLine||i.visualBlock)&&(i.visualLine=!1,i.visualBlock=!1,w.default.signal(e,"vim-mode-change",{mode:"visual",subMode:""}));var k=i.sel.anchor;if(k)return a.isReversed()?r.forward?[k,c]:[k,p]:r.forward?[k,p]:[k,c]}else i.visualMode=!0,i.visualLine=!1,i.visualBlock=!1,w.default.signal(e,"vim-mode-change",{mode:"visual",subMode:""});return l?[p,c]:[c,p]}}},goToMark:function(e,t,r,i){var o=It(e,i,r.selectedCharacter);return o?r.linewise?{line:o.line,ch:Se(e.getLine(o.line))}:o:null},moveToOtherHighlightedEnd:function(e,t,r,i){if(i.visualBlock&&r.sameLine){var o=i.sel;return[de(e,new S(o.anchor.line,o.head.ch)),de(e,new S(o.head.line,o.anchor.ch))]}else return[i.sel.head,i.sel.anchor]},jumpToMark:function(e,t,r,i){for(var o=t,a=0;a<r.repeat;a++){var s=o;for(var l in i.marks)if(d(l)){var u=i.marks[l].find(),c=r.forward?q(u,s):q(s,u);if(!c&&!(r.linewise&&u.line==s.line)){var p=ve(s,o),k=r.forward?dt(s,u,o):dt(o,u,s);(p||k)&&(o=u)}}}return r.linewise&&(o=new S(o.line,Se(e.getLine(o.line)))),o},moveByCharacters:function(e,t,r){var i=t,o=r.repeat,a=r.forward?i.ch+o:i.ch-o;return new S(i.line,a)},moveByLines:function(e,t,r,i){var o=t,a=o.ch;switch(i.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:a=i.lastHPos;break;default:i.lastHPos=a}var s=r.repeat+(r.repeatOffset||0),l=r.forward?o.line+s:o.line-s,u=e.firstLine(),c=e.lastLine(),p=e.findPosV(o,r.forward?s:-s,"line",i.lastHSPos),k=r.forward?p.line>l:p.line<l;return k&&(l=p.line,a=p.ch),l<u&&o.line==u?this.moveToStartOfLine(e,t,r,i):l>c&&o.line==c?mt(e,t,r,i,!0):(r.toFirstChar&&(a=Se(e.getLine(l)),i.lastHPos=a),i.lastHSPos=e.charCoords(new S(l,a),"div").left,new S(l,a))},moveByDisplayLines:function(e,t,r,i){var o=t;switch(i.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:i.lastHSPos=e.charCoords(o,"div").left}var a=r.repeat,s=e.findPosV(o,r.forward?a:-a,"line",i.lastHSPos);if(s.hitSide)if(r.forward)var l=e.charCoords(s,"div"),u={top:l.top+8,left:i.lastHSPos},s=e.coordsChar(u,"div");else{var c=e.charCoords(new S(e.firstLine(),0),"div");c.left=i.lastHSPos,s=e.coordsChar(c,"div")}return i.lastHPos=s.ch,s},moveByPage:function(e,t,r){var i=t,o=r.repeat;return e.findPosV(i,r.forward?o:-o,"page")},moveByParagraph:function(e,t,r){var i=r.forward?1:-1;return wt(e,t,r.repeat,i)},moveBySentence:function(e,t,r){var i=r.forward?1:-1;return hr(e,t,r.repeat,i)},moveByScroll:function(e,t,r,i){var o=e.getScrollInfo(),l=null,a=r.repeat;a||(a=o.clientHeight/(2*e.defaultTextHeight()));var s=e.charCoords(t,"local");r.repeat=a;var l=Le.moveByDisplayLines(e,t,r,i);if(!l)return null;var u=e.charCoords(l,"local");return e.scrollTo(null,o.top+u.top-s.top),l},moveByWords:function(e,t,r){return ur(e,t,r.repeat,!!r.forward,!!r.wordEnd,!!r.bigWord)},moveTillCharacter:function(e,t,r){var i=r.repeat,o=it(e,i,r.forward,r.selectedCharacter),a=r.forward?-1:1;return Ct(a,r),o?(o.ch+=a,o):null},moveToCharacter:function(e,t,r){var i=r.repeat;return Ct(0,r),it(e,i,r.forward,r.selectedCharacter)||t},moveToSymbol:function(e,t,r){var i=r.repeat;return sr(e,i,r.forward,r.selectedCharacter)||t},moveToColumn:function(e,t,r,i){var o=r.repeat;return i.lastHPos=o-1,i.lastHSPos=e.charCoords(t,"div").left,fr(e,o)},moveToEol:function(e,t,r,i){return mt(e,t,r,i,!1)},moveToFirstNonWhiteSpaceCharacter:function(e,t){var r=t;return new S(r.line,Se(e.getLine(r.line)))},moveToMatchedSymbol:function(e,t){var r=t,i=r.line,o=r.ch,a=e.getLine(i);if(o<a.length){var s=o==="<"||o===">"?/[(){}[\]<>]/:/[(){}[\]]/,l=e.findMatchingBracket(new S(i,o),{bracketRegex:s});return l.to}else return r},moveToStartOfLine:function(e,t){return new S(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,r){var i=r.forward?e.lastLine():e.firstLine();return r.repeatIsExplicit&&(i=r.repeat-e.getOption("firstLineNumber")),new S(i,Se(e.getLine(i)))},moveToStartOfDisplayLine:function(e){return e.execCommand("goLineLeft"),e.getCursor()},moveToEndOfDisplayLine:function(e){e.execCommand("goLineRight");var t=e.getCursor();return t.sticky=="before"&&t.ch--,t},textObjectManipulation:function(e,t,r,i){var o={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"},a={"'":!0,'"':!0,"`":!0},s=r.selectedCharacter;s=="b"?s="(":s=="B"&&(s="{");var l=!r.textObjectInner,u;if(o[s])u=dr(e,t,s,l);else if(a[s])u=pr(e,t,s,l);else if(s==="W")u=Xe(e,l,!0,!0);else if(s==="w")u=Xe(e,l,!0,!1);else if(s==="p")if(u=wt(e,t,r.repeat,0,l),r.linewise=!0,i.visualMode)i.visualLine||(i.visualLine=!0);else{var c=i.inputState.operatorArgs;c&&(c.linewise=!0),u.end.line--}else if(s==="t")u=or(e,t,l);else return null;return e.state.vim.visualMode?tr(e,u.start,u.end):[u.start,u.end]},repeatLastCharacterSearch:function(e,t,r){var i=L.lastCharacterSearch,o=r.repeat,a=r.forward===i.forward,s=(i.increment?1:0)*(a?-1:1);e.moveH(-s,"char"),r.inclusive=!!a;var l=it(e,o,a,i.selectedCharacter);return l?(l.ch+=s,l):(e.moveH(s,"char"),t)}};function $t(n,e){Le[n]=e}function ft(n,e){for(var t=[],r=0;r<e;r++)t.push(n);return t}var ct={change:function(e,t,r){var i,o,a=e.state.vim,s=r[0].anchor,l=r[0].head;if(a.visualMode)if(t.fullLine)l.ch=Number.MAX_VALUE,l.line--,e.setSelection(s,l),o=e.getSelection(),e.replaceSelections(""),i=s;else{o=e.getSelection();var C=ft("",r.length);e.replaceSelections(C),i=ge(r[0].head,r[0].anchor)}else{o=e.getRange(s,l);var u=a.lastEditInputState||{};if(u.motion=="moveByWords"&&!A(o)){var c=/\s+$/.exec(o);c&&u.motionArgs&&u.motionArgs.forward&&(l=ue(l,0,-c[0].length),o=o.slice(0,-c[0].length))}var p=new S(s.line-1,Number.MAX_VALUE),k=e.firstLine()==e.lastLine();l.line>e.lastLine()&&t.linewise&&!k?e.replaceRange("",p,l):e.replaceRange("",s,l),t.linewise&&(k||(e.setCursor(p),w.default.commands.newlineAndIndent(e)),s.ch=Number.MAX_VALUE),i=s}L.registerController.pushText(t.registerName,"change",o,t.linewise,r.length>1),tt.enterInsertMode(e,{head:i},e.state.vim)},delete:function(e,t,r){e.pushUndoStop();var i,o,a=e.state.vim;if(a.visualBlock){o=e.getSelection();var u=ft("",r.length);e.replaceSelections(u),i=ge(r[0].head,r[0].anchor)}else{var s=r[0].anchor,l=r[0].head;t.linewise&&l.line!=e.firstLine()&&s.line==e.lastLine()&&s.line==l.line-1&&(s.line==e.firstLine()?s.ch=0:s=new S(s.line-1,ee(e,s.line-1))),o=e.getRange(s,l),e.replaceRange("",s,l),i=s,t.linewise&&(i=Le.moveToFirstNonWhiteSpaceCharacter(e,s))}return L.registerController.pushText(t.registerName,"delete",o,t.linewise,a.visualBlock),de(e,i)},indent:function(e,t,r){var i=e.state.vim,o=r[0].anchor.line,a=i.visualBlock?r[r.length-1].anchor.line:r[0].head.line,s=i.visualMode?t.repeat:1;t.linewise&&a--,e.pushUndoStop();for(var l=o;l<=a;l++)for(var u=0;u<s;u++)e.indentLine(l,t.indentRight);return e.pushUndoStop(),Le.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},indentAuto:function(e,t,r){return e.execCommand("indentAuto"),Le.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},changeCase:function(e,t,r,i,o){for(var a=e.getSelections(),s=[],l=t.toLower,u=0;u<a.length;u++){var c=a[u],p="";if(l===!0)p=c.toLowerCase();else if(l===!1)p=c.toUpperCase();else for(var k=0;k<c.length;k++){var C=c.charAt(k);p+=m(C)?C.toLowerCase():C.toUpperCase()}s.push(p)}return e.replaceSelections(s),t.shouldMoveCursor?o:!e.state.vim.visualMode&&t.linewise&&r[0].anchor.line+1==r[0].head.line?Le.moveToFirstNonWhiteSpaceCharacter(e,i):t.linewise?i:ge(r[0].anchor,r[0].head)},yank:function(e,t,r,i){var o=e.state.vim,a=e.getSelection(),s=o.visualMode?ge(o.sel.anchor,o.sel.head,r[0].head,r[0].anchor):i;return L.registerController.pushText(t.registerName,"yank",a,t.linewise,o.visualBlock),s}};function Qt(n,e){ct[n]=e}var tt={jumpListWalk:function(e,t,r){if(!r.visualMode){var i=t.repeat,o=t.forward,a=L.jumpList,s=a.move(e,o?i:-i),l=s?s.find():void 0;l=l||e.getCursor(),e.setCursor(l)}},scroll:function(e,t,r){if(!r.visualMode){var i=t.repeat||1,o=e.defaultTextHeight(),a=e.getScrollInfo().top,s=o*i,l=t.forward?a+s:a-s,u=z(e.getCursor()),c=e.charCoords(u,"local");if(t.forward)l>c.top?(u.line+=(l-c.top)/o,u.line=Math.ceil(u.line),e.setCursor(u),c=e.charCoords(u,"local"),e.scrollTo(null,c.top)):e.scrollTo(null,l);else{var p=l+e.getScrollInfo().clientHeight;p<c.bottom?(u.line-=(c.bottom-p)/o,u.line=Math.floor(u.line),e.setCursor(u),c=e.charCoords(u,"local"),e.scrollTo(null,c.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,l)}}},scrollToCursor:function(e,t){var r=e.getCursor().line,i=e.charCoords(new S(r,0),"local"),o=e.getScrollInfo().clientHeight,a=i.top,s=i.bottom-a;switch(t.position){case"center":a=a-o/2+s;break;case"bottom":a=a-o+s;break}e.moveCurrentLineTo(a)},replayMacro:function(e,t,r){var i=t.selectedCharacter,o=t.repeat,a=L.macroModeState;for(i=="@"?i=a.latestRegister:a.latestRegister=i;o--;)Tr(e,r,a,i)},enterMacroRecordMode:function(e,t){var r=L.macroModeState,i=t.selectedCharacter;L.registerController.isValidRegister(i)&&r.enterMacroRecordMode(e,i)},toggleOverwrite:function(e){e.state.overwrite?(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),w.default.signal(e,"vim-mode-change",{mode:"insert"})):(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),w.default.signal(e,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(e,t,r){if(!e.getOption("readOnly")){r.insertMode=!0,r.insertModeRepeat=t&&t.repeat||1;var i=t?t.insertAt:null,o=r.sel,a=t.head||e.getCursor("head"),s=e.listSelections().length;if(i=="eol")a=new S(a.line,ee(e,a.line));else if(i=="bol")a=new S(a.line,0);else if(i=="charAfter")a=ue(a,0,1);else if(i=="firstNonBlank")a=Le.moveToFirstNonWhiteSpaceCharacter(e,a);else if(i=="startOfSelectedArea"){if(!r.visualMode)return;r.visualBlock?(a=new S(Math.min(o.head.line,o.anchor.line),Math.min(o.head.ch,o.anchor.ch)),s=Math.abs(o.head.line-o.anchor.line)+1):o.head.line<o.anchor.line?a=o.head:a=new S(o.anchor.line,0)}else if(i=="endOfSelectedArea"){if(!r.visualMode)return;r.visualBlock?(a=new S(Math.min(o.head.line,o.anchor.line),Math.max(o.head.ch,o.anchor.ch)+1),s=Math.abs(o.head.line-o.anchor.line)+1):o.head.line>=o.anchor.line?a=ue(o.head,0,1):a=new S(o.anchor.line,0)}else if(i=="inplace"){if(r.visualMode)return}else i=="lastEdit"&&(a=Rt(e)||a);e.setOption("disableInput",!1),t&&t.replace?(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),w.default.signal(e,"vim-mode-change",{mode:"replace"})):(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),w.default.signal(e,"vim-mode-change",{mode:"insert"})),L.macroModeState.isPlaying||(e.on("change",Bt),w.default.on(e.getInputField(),"keydown",Nt)),r.visualMode&&we(e),vt(e,a,s)}},toggleVisualMode:function(e,t,r){var i=t.repeat,o=e.getCursor(),a;r.visualMode?r.visualLine^t.linewise||r.visualBlock^t.blockwise?(r.visualLine=!!t.linewise,r.visualBlock=!!t.blockwise,w.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),Ne(e)):we(e):(r.visualMode=!0,r.visualLine=!!t.linewise,r.visualBlock=!!t.blockwise,a=de(e,new S(o.line,o.ch+i-1)),r.sel={anchor:o,head:a},w.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),Ne(e),Ae(e,r,"<",ge(o,a)),Ae(e,r,">",Pe(o,a)))},reselectLastSelection:function(e,t,r){var i=r.lastSelection;if(r.visualMode&&gt(e,r),i){var o=i.anchorMark.find(),a=i.headMark.find();if(!o||!a)return;r.sel={anchor:o,head:a},r.visualMode=!0,r.visualLine=i.visualLine,r.visualBlock=i.visualBlock,Ne(e),Ae(e,r,"<",ge(o,a)),Ae(e,r,">",Pe(o,a)),w.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""})}},joinLines:function(e,t,r){var i,o;if(r.visualMode){if(i=e.getCursor("anchor"),o=e.getCursor("head"),q(o,i)){var a=o;o=i,i=a}o.ch=ee(e,o.line)-1}else{var s=Math.max(t.repeat,2);i=e.getCursor(),o=de(e,new S(i.line+s-1,1/0))}for(var l=0,u=i.line;u<o.line;u++){l=ee(e,i.line);var a=new S(i.line+1,ee(e,i.line+1)),c=e.getRange(i,a);c=t.keepSpaces?c.replace(/\n\r?/g,""):c.replace(/\n\s*/g," "),e.replaceRange(c,i,a)}var p=new S(i.line,l);r.visualMode&&we(e,!1),e.setCursor(p)},newLineAndEnterInsertMode:function(e,t,r){if(!e.getOption("readOnly")){r.insertMode=!0;var i=z(e.getCursor());if(i.line===e.firstLine()&&!t.after)e.replaceRange(`
`,new S(e.firstLine(),0)),e.setCursor(e.firstLine(),0);else{i.line=t.after?i.line:i.line-1,i.ch=ee(e,i.line),e.setCursor(i);var o=w.default.commands.newlineAndIndentContinueComment||w.default.commands.newlineAndIndent;o(e)}this.enterInsertMode(e,{repeat:t.repeat},r)}},paste:function(e,t,r){var i=z(e.getCursor()),o=L.registerController.getRegister(t.registerName),a=o.toString();if(a){if(t.matchIndent){var s=e.getOption("tabSize"),l=function(Ie){var Ue=Ie.split("	").length-1,je=Ie.split(" ").length-1;return Ue*s+je*1},u=e.getLine(e.getCursor().line),c=l(u.match(/^\s*/)[0]),p=a.replace(/\n$/,""),k=a!==p,C=l(a.match(/^\s*/)[0]),a=p.replace(/^\s*/gm,function(se){var Ie=c+(l(se)-C);if(Ie<0)return"";if(e.getOption("indentWithTabs")){var Ue=Math.floor(Ie/s);return Array(Ue+1).join("	")}else return Array(Ie+1).join(" ")});a+=k?`
`:""}if(t.repeat>1)var a=Array(t.repeat+1).join(a);var g=o.linewise,b=o.blockwise;if(b){a=a.split(`
`),g&&a.pop();for(var x=0;x<a.length;x++)a[x]=a[x]==""?" ":a[x];i.ch+=t.after?1:0,i.ch=Math.min(ee(e,i.line),i.ch)}else g?r.visualMode?a=r.visualLine?a.slice(0,-1):`
`+a.slice(0,a.length-1)+`
`:t.after?(a=`
`+a.slice(0,a.length-1),i.ch=ee(e,i.line)):i.ch=0:i.ch+=t.after?1:0;var M,E;if(r.visualMode){r.lastPastedText=a;var T,I=er(e,r),Q=I[0],fe=I[1],X=e.getSelection(),ae=e.listSelections(),W=new Array(ae.length).join("1").split("1");r.lastSelection&&(T=r.lastSelection.headMark.find()),L.registerController.unnamedRegister.setText(X),b?(e.replaceSelections(W),fe=new S(Q.line+a.length-1,Q.ch),e.setCursor(Q),pt(e,fe),e.replaceSelections(a),M=Q):r.visualBlock?(e.replaceSelections(W),e.setCursor(Q),e.replaceRange(a,Q,Q),M=Q):(e.replaceRange(a,Q,fe),M=e.posFromIndex(e.indexFromPos(Q)+a.length-1)),T&&(r.lastSelection.headMark=e.setBookmark(T)),g&&(M.ch=0)}else if(b){e.setCursor(i);for(var x=0;x<a.length;x++){var N=i.line+x;N>e.lastLine()&&e.replaceRange(`
`,new S(N,0));var oe=ee(e,N);oe<i.ch&&qt(e,N,i.ch)}e.setCursor(i),pt(e,new S(i.line+a.length-1,i.ch)),e.replaceSelections(a),M=i}else e.replaceRange(a,i),g&&t.after?M=new S(i.line+1,Se(e.getLine(i.line+1))):g&&!t.after?M=new S(i.line,Se(e.getLine(i.line))):!g&&t.after?(E=e.indexFromPos(i),M=e.posFromIndex(E+a.length-1)):(E=e.indexFromPos(i),M=e.posFromIndex(E+a.length));r.visualMode&&we(e,!1),e.setCursor(M)}},undo:function(e,t){e.operation(function(){ht(e,w.default.commands.undo,t.repeat)(),e.setCursor(e.getCursor("anchor"))})},redo:function(e,t){ht(e,w.default.commands.redo,t.repeat)()},setRegister:function(e,t,r){r.inputState.registerName=t.selectedCharacter},setMark:function(e,t,r){var i=t.selectedCharacter;Ae(e,r,i,e.getCursor())},replace:function(e,t,r){var i=t.selectedCharacter,o=e.getCursor(),a,s,l=e.listSelections();if(r.visualMode)o=e.getCursor("start"),s=e.getCursor("end");else{var u=e.getLine(o.line);a=o.ch+t.repeat,a>u.length&&(a=u.length),s=new S(o.line,a)}if(i==`
`)r.visualMode||e.replaceRange("",o,s),(w.default.commands.newlineAndIndentContinueComment||w.default.commands.newlineAndIndent)(e);else{var c=e.getRange(o,s);if(c=c.replace(/[^\n]/g,i),r.visualBlock){var p=new Array(e.getOption("tabSize")+1).join(" ");c=e.getSelection(),c=c.replace(/\t/g,p).replace(/[^\n]/g,i).split(`
`),e.replaceSelections(c)}else e.replaceRange(c,o,s);r.visualMode?(o=q(l[0].anchor,l[0].head)?l[0].anchor:l[0].head,e.setCursor(o),we(e,!1)):e.setCursor(ue(s,0,-1))}},incrementNumberToken:function(e,t){for(var r=e.getCursor(),i=e.getLine(r.line),o=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi,a,s,l,u;(a=o.exec(i))!==null&&(s=a.index,l=s+a[0].length,!(r.ch<l)););if(!(!t.backtrack&&l<=r.ch)){if(a){var c=a[2]||a[4],p=a[3]||a[5],k=t.increase?1:-1,C={"0b":2,0:8,"":10,"0x":16}[c.toLowerCase()],g=parseInt(a[1]+p,C)+k*t.repeat;u=g.toString(C);var b=c?new Array(p.length-u.length+1+a[1].length).join("0"):"";u.charAt(0)==="-"?u="-"+c+b+u.substr(1):u=c+b+u;var x=new S(r.line,s),M=new S(r.line,l);e.replaceRange(u,x,M)}else return;e.setCursor(new S(r.line,s+u.length-1))}},repeatLastEdit:function(e,t,r){var i=r.lastEditInputState;if(i){var o=t.repeat;o&&t.repeatIsExplicit?r.lastEditInputState.repeatOverride=o:o=r.lastEditInputState.repeatOverride||o,Kt(e,r,o,!1)}},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:Fe};function Jt(n,e){tt[n]=e}function de(n,e){var t=n.state.vim,r=t.insertMode||t.visualMode,i=Math.min(Math.max(n.firstLine(),e.line),n.lastLine()),o=ee(n,i)-1+!!r,a=Math.min(Math.max(0,e.ch),o);return new S(i,a)}function Ge(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function ue(n,e,t){return re(e)==="object"&&(t=e.ch,e=e.line),new S(n.line+e,n.ch+t)}function zt(n,e,t,r){for(var i,o=[],a=[],s=0;s<e.length;s++){var l=e[s];t=="insert"&&l.context!="insert"||l.context&&l.context!=t||r.operator&&l.type=="action"||!(i=Gt(n,l.keys))||(i=="partial"&&o.push(l),i=="full"&&a.push(l))}return{partial:o.length&&o,full:a.length&&a}}function Gt(n,e){if(e.slice(-11)=="<character>"){var t=e.length-11,r=n.slice(0,t),i=e.slice(0,t);return r==i&&n.length>t?"full":i.indexOf(r)==0?"partial":!1}else return n==e?"full":e.indexOf(n)==0?"partial":!1}function Xt(n){var e=/^.*(<[^>]+>)$/.exec(n),t=e?e[1]:n.slice(-1);if(t.length>1)switch(t){case"<CR>":t=`
`;break;case"<Space>":t=" ";break;default:t="";break}return t}function ht(n,e,t){return function(){for(var r=0;r<t;r++)e(n)}}function z(n){return new S(n.line,n.ch)}function ve(n,e){return n.ch==e.ch&&n.line==e.line}function q(n,e){return n.line<e.line||n.line==e.line&&n.ch<e.ch}function ge(n,e){return arguments.length>2&&(e=ge.apply(void 0,Array.prototype.slice.call(arguments,1))),q(n,e)?n:e}function Pe(n,e){return arguments.length>2&&(e=Pe.apply(void 0,Array.prototype.slice.call(arguments,1))),q(n,e)?e:n}function dt(n,e,t){var r=q(n,e),i=q(e,t);return r&&i}function ee(n,e){return n.getLine(e).length}function rt(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function Yt(n){return n.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function qt(n,e,t){var r=ee(n,e),i=new Array(t-r+1).join(" ");n.setCursor(new S(e,r)),n.replaceRange(i,n.getCursor())}function pt(n,e){var t=[],r=n.listSelections(),i=z(n.clipPos(e)),o=!ve(e,i),a=n.getCursor("head"),s=Zt(r,a),l=ve(r[s].head,r[s].anchor),u=r.length-1,c=u-s>s?u:0,p=r[c].anchor,k=Math.min(p.line,i.line),C=Math.max(p.line,i.line),g=p.ch,b=i.ch,x=r[c].head.ch-g,M=b-g;x>0&&M<=0?(g++,o||b--):x<0&&M>=0?(g--,l||b++):x<0&&M==-1&&(g--,b++);for(var E=k;E<=C;E++){var T={anchor:new S(E,g),head:new S(E,b)};t.push(T)}return n.setSelections(t),e.ch=b,p.ch=g,p}function vt(n,e,t){for(var r=[],i=0;i<t;i++){var o=ue(e,i,0);r.push({anchor:o,head:o})}n.setSelections(r,0)}function Zt(n,e,t){for(var r=0;r<n.length;r++){var i=ve(n[r].anchor,e),o=ve(n[r].head,e);if(i||o)return r}return-1}function er(n,e){var t=e.lastSelection,r=function(){var a=n.listSelections(),s=a[0],l=a[a.length-1],u=q(s.anchor,s.head)?s.anchor:s.head,c=q(l.anchor,l.head)?l.head:l.anchor;return[u,c]},i=function(){var a=n.getCursor(),s=n.getCursor(),l=t.visualBlock;if(l){var u=l.width,c=l.height;s=new S(a.line+c,a.ch+u);for(var p=[],k=a.line;k<s.line;k++){var C=new S(k,a.ch),g=new S(k,s.ch),b={anchor:C,head:g};p.push(b)}n.setSelections(p)}else{var x=t.anchorMark.find(),M=t.headMark.find(),E=M.line-x.line,T=M.ch-x.ch;s={line:s.line+E,ch:E?s.ch:T+s.ch},t.visualLine&&(a=new S(a.line,0),s=new S(s.line,ee(n,s.line))),n.setSelection(a,s)}return[a,s]};return e.visualMode?r():i()}function gt(n,e){var t=e.sel.anchor,r=e.sel.head;e.lastPastedText&&(r=n.posFromIndex(n.indexFromPos(t)+e.lastPastedText.length),e.lastPastedText=null),e.lastSelection={anchorMark:n.setBookmark(t),headMark:n.setBookmark(r),anchor:z(t),head:z(r),visualMode:e.visualMode,visualLine:e.visualLine,visualBlock:e.visualBlock}}function tr(n,e,t){var r=n.state.vim.sel,i=r.head,o=r.anchor,a;return q(t,e)&&(a=t,t=e,e=a),q(i,o)?(i=ge(e,i),o=Pe(o,t)):(o=ge(e,o),i=Pe(i,t),i=ue(i,0,-1),i.ch==-1&&i.line!=n.firstLine()&&(i=new S(i.line-1,ee(n,i.line-1)))),[o,i]}function Ne(n,e,i){var r=n.state.vim;e=e||r.sel;var i=i||r.visualLine?"line":r.visualBlock?"block":"char",o=nt(n,e,i);n.setSelections(o.ranges,o.primary)}function nt(n,e,t,r){var i=z(e.head),o=z(e.anchor);if(t=="char"){var a=!r&&!q(e.head,e.anchor)?1:0,s=q(e.head,e.anchor)?1:0;return i=ue(e.head,0,a),o=ue(e.anchor,0,s),{ranges:[{anchor:o,head:i}],primary:0}}else if(t=="line"){if(q(e.head,e.anchor))i.ch=0,o.ch=ee(n,o.line);else{o.ch=0;var l=n.lastLine();i.line>l&&(i.line=l),i.ch=ee(n,i.line)}return{ranges:[{anchor:o,head:i}],primary:0}}else if(t=="block"){var u=Math.min(o.line,i.line),c=o.ch,p=Math.max(o.line,i.line),k=i.ch;c<k?k+=1:c+=1;for(var C=p-u+1,g=i.line==u?0:C-1,b=[],x=0;x<C;x++)b.push({anchor:new S(u+x,c),head:new S(u+x,k)});return{ranges:b,primary:g}}}function rr(n){var e=n.getCursor("head");return n.getSelection().length==1&&(e=ge(e,n.getCursor("anchor"))),e}function we(n,e){var t=n.state.vim;e!==!1&&n.setCursor(de(n,t.sel.head)),gt(n,t),t.visualMode=!1,t.visualLine=!1,t.visualBlock=!1,t.insertMode||w.default.signal(n,"vim-mode-change",{mode:"normal"})}function nr(n,e,t){var r=n.getRange(e,t);if(/\n\s*$/.test(r)){var i=r.split(`
`);i.pop();for(var o,o=i.pop();i.length>0&&o&&A(o);o=i.pop())t.line--,t.ch=0;o?(t.line--,t.ch=ee(n,t.line)):t.ch=0}}function ir(n,e,t){e.ch=0,t.ch=0,t.line++}function Se(n){if(!n)return 0;var e=n.search(/\S/);return e==-1?n.length:e}function Xe(n,e,t,r,i){for(var o=rr(n),a=n.getLine(o.line),s=o.ch,l=i?ne[0]:J[0];!l(a.charAt(s));)if(s++,s>=a.length)return null;r?l=J[0]:(l=ne[0],l(a.charAt(s))||(l=ne[1]));for(var u=s,c=s;l(a.charAt(u))&&u<a.length;)u++;for(;l(a.charAt(c))&&c>=0;)c--;if(c++,e){for(var p=u;/\s/.test(a.charAt(u))&&u<a.length;)u++;if(p==u){for(var k=c;/\s/.test(a.charAt(c-1))&&c>0;)c--;c||(c=k)}}return{start:new S(o.line,c),end:new S(o.line,u)}}function or(n,e,t){var r=e;if(!w.default.findMatchingTag||!w.default.findEnclosingTag)return{start:r,end:r};var i=w.default.findMatchingTag(n,e)||w.default.findEnclosingTag(n,e);return!i||!i.open||!i.close?{start:r,end:r}:t?{start:i.open.from,end:i.close.to}:{start:i.open.to,end:i.close.from}}function yt(n,e,t){ve(e,t)||L.jumpList.add(n,e,t)}function Ct(n,e){L.lastCharacterSearch.increment=n,L.lastCharacterSearch.forward=e.forward,L.lastCharacterSearch.selectedCharacter=e.selectedCharacter}var ar={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},kt={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return e.index===0&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t=e.lastCh==="*"&&e.nextCh==="/";return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb=e.symb==="m"?"{":"}",e.reverseSymb=e.symb==="{"?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if(e.nextCh==="#"){var t=e.lineText.match(/^#(\w+)/)[1];if(t==="endif"){if(e.forward&&e.depth===0)return!0;e.depth++}else if(t==="if"){if(!e.forward&&e.depth===0)return!0;e.depth--}if(t==="else"&&e.depth===0)return!0}return!1}}};function sr(n,e,t,r){var i=z(n.getCursor()),o=t?1:-1,a=t?n.lineCount():-1,s=i.ch,l=i.line,u=n.getLine(l),c={lineText:u,nextCh:u.charAt(s),lastCh:null,index:s,symb:r,reverseSymb:(t?{")":"(","}":"{"}:{"(":")","{":"}"})[r],forward:t,depth:0,curMoveThrough:!1},p=ar[r];if(!p)return i;var k=kt[p].init,C=kt[p].isComplete;for(k&&k(c);l!==a&&e;){if(c.index+=o,c.nextCh=c.lineText.charAt(c.index),!c.nextCh){if(l+=o,c.lineText=n.getLine(l)||"",o>0)c.index=0;else{var g=c.lineText.length;c.index=g>0?g-1:0}c.nextCh=c.lineText.charAt(c.index)}C(c)&&(i.line=l,i.ch=c.index,e--)}return c.nextCh||c.curMoveThrough?new S(l,c.index):i}function lr(n,e,t,r,i){var o=e.line,a=e.ch,s=n.getLine(o),l=t?1:-1,u=r?J:ne;if(i&&s==""){if(o+=l,s=n.getLine(o),!f(n,o))return null;a=t?0:s.length}for(;;){if(i&&s=="")return{from:0,to:0,line:o};for(var c=l>0?s.length:-1,p=c,k=c;a!=c;){for(var C=!1,g=0;g<u.length&&!C;++g)if(u[g](s.charAt(a))){for(p=a;a!=c&&u[g](s.charAt(a));)a+=l;if(k=a,C=p!=k,p==e.ch&&o==e.line&&k==p+l)continue;return{from:Math.min(p,k+1),to:Math.max(p,k),line:o}}C||(a+=l)}if(o+=l,!f(n,o))return null;s=n.getLine(o),a=l>0?0:s.length}}function ur(n,e,t,r,i,o){var a=z(e),s=[];(r&&!i||!r&&i)&&t++;for(var l=!(r&&i),u=0;u<t;u++){var c=lr(n,e,r,o,l);if(!c){var p=ee(n,n.lastLine());s.push(r?{line:n.lastLine(),from:p,to:p}:{line:0,from:0,to:0});break}s.push(c),e=new S(c.line,r?c.to-1:c.from)}var k=s.length!=t,C=s[0],g=s.pop();return r&&!i?(!k&&(C.from!=a.ch||C.line!=a.line)&&(g=s.pop()),new S(g.line,g.from)):r&&i?new S(g.line,g.to-1):!r&&i?(!k&&(C.to!=a.ch||C.line!=a.line)&&(g=s.pop()),new S(g.line,g.to)):new S(g.line,g.from)}function mt(n,e,t,r,i){var o=e,a=new S(o.line+t.repeat-1,1/0),s=n.clipPos(a);return s.ch--,i||(r.lastHPos=1/0,r.lastHSPos=n.charCoords(s,"div").left),a}function it(n,e,t,r){for(var i=n.getCursor(),o=i.ch,a,s=0;s<e;s++){var l=n.getLine(i.line);if(a=cr(o,l,r,t,!0),a==-1)return null;o=a}return new S(n.getCursor().line,a)}function fr(n,e){var t=n.getCursor().line;return de(n,new S(t,e-1))}function Ae(n,e,t,r){V(t,Ze)&&(e.marks[t]&&e.marks[t].clear(),e.marks[t]=n.setBookmark(r))}function cr(n,e,t,r,i){var o;return r?(o=e.indexOf(t,n+1),o!=-1&&!i&&(o-=1)):(o=e.lastIndexOf(t,n-1),o!=-1&&!i&&(o+=1)),o}function wt(n,e,t,r,i){var o=e.line,a=n.firstLine(),s=n.lastLine(),l,u,c=o;function p(x){return!n.getLine(x)}function k(x,M,E){return E?p(x)!=p(x+M):!p(x)&&p(x+M)}if(r){for(;a<=c&&c<=s&&t>0;)k(c,r)&&t--,c+=r;return new S(c,0)}var C=n.state.vim;if(C.visualLine&&k(o,1,!0)){var g=C.sel.anchor;k(g.line,-1,!0)&&(!i||g.line!=o)&&(o+=1)}var b=p(o);for(c=o;c<=s&&t;c++)k(c,1,!0)&&(!i||p(c)!=b)&&t--;for(u=new S(c,0),c>s&&!b?b=!0:i=!1,c=o;c>a&&!((!i||p(c)==b||c==o)&&k(c,-1,!0));c--);return l=new S(c,0),{start:l,end:u}}function hr(n,e,t,r){function i(l,u){if(u.pos+u.dir<0||u.pos+u.dir>=u.line.length){if(u.ln+=u.dir,!f(l,u.ln)){u.line=null,u.ln=null,u.pos=null;return}u.line=l.getLine(u.ln),u.pos=u.dir>0?0:u.line.length-1}else u.pos+=u.dir}function o(l,u,c,p){var x=l.getLine(u),k=x==="",C={line:x,ln:u,pos:c,dir:p},g={ln:C.ln,pos:C.pos},b=C.line==="";for(i(l,C);C.line!==null;){if(g.ln=C.ln,g.pos=C.pos,C.line===""&&!b)return{ln:C.ln,pos:C.pos};if(k&&C.line!==""&&!A(C.line[C.pos]))return{ln:C.ln,pos:C.pos};K(C.line[C.pos])&&!k&&(C.pos===C.line.length-1||A(C.line[C.pos+1]))&&(k=!0),i(l,C)}var x=l.getLine(g.ln);g.pos=0;for(var M=x.length-1;M>=0;--M)if(!A(x[M])){g.pos=M;break}return g}function a(l,u,c,p){var b=l.getLine(u),k={line:b,ln:u,pos:c,dir:p},C={ln:k.ln,pos:null},g=k.line==="";for(i(l,k);k.line!==null;){if(k.line===""&&!g)return C.pos!==null?C:{ln:k.ln,pos:k.pos};if(K(k.line[k.pos])&&C.pos!==null&&!(k.ln===C.ln&&k.pos+1===C.pos))return C;k.line!==""&&!A(k.line[k.pos])&&(g=!1,C={ln:k.ln,pos:k.pos}),i(l,k)}var b=l.getLine(C.ln);C.pos=0;for(var x=0;x<b.length;++x)if(!A(b[x])){C.pos=x;break}return C}for(var s={ln:e.line,pos:e.ch};t>0;)r<0?s=a(n,s.ln,s.pos,r):s=o(n,s.ln,s.pos,r),t--;return new S(s.ln,s.pos)}function dr(n,e,t,r){var i=e,o,a,s={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[t],l={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[t],u=n.getLine(i.line).charAt(i.ch),c=u===l?1:0;if(o=n.scanForBracket(new S(i.line,i.ch+c),-1,void 0,{bracketRegex:s}),a=n.scanForBracket(new S(i.line,i.ch+c),1,void 0,{bracketRegex:s}),!o||!a)return{start:i,end:i};if(o=o.pos,a=a.pos,o.line==a.line&&o.ch>a.ch||o.line>a.line){var p=o;o=a,a=p}return r?a.ch+=1:o.ch+=1,{start:o,end:a}}function pr(n,e,t,r){var i=z(e),o=n.getLine(i.line),a=o.split(""),s,l,u,c,p=a.indexOf(t);if(i.ch<p?i.ch=p:p<i.ch&&a[i.ch]==t&&(l=i.ch,--i.ch),a[i.ch]==t&&!l)s=i.ch+1;else for(u=i.ch;u>-1&&!s;u--)a[u]==t&&(s=u+1);if(s&&!l)for(u=s,c=a.length;u<c&&!l;u++)a[u]==t&&(l=u);return!s||!l?{start:i,end:i}:(r&&(--s,++l),{start:new S(i.line,s),end:new S(i.line,l)})}Z("pcre",!0,"boolean");function St(){}St.prototype={getQuery:function(){return L.query},setQuery:function(e){L.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return L.isReversed},setReversed:function(e){L.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}};function Me(n){var e=n.state.vim;return e.searchState_||(e.searchState_=new St)}function vr(n){return Mt(n,"/")}function gr(n){return bt(n,"/")}function Mt(n,e){var t=bt(n,e)||[];if(!t.length)return[];var r=[];if(t[0]===0){for(var i=0;i<t.length;i++)typeof t[i]=="number"&&r.push(n.substring(t[i]+1,t[i+1]));return r}}function bt(n,e){e||(e="/");for(var t=!1,r=[],i=0;i<n.length;i++){var o=n.charAt(i);!t&&o==e&&r.push(i),t=!t&&o=="\\"}return r}function yr(n){for(var e="|(){",t="}",r=!1,i=[],o=-1;o<n.length;o++){var a=n.charAt(o)||"",s=n.charAt(o+1)||"",l=s&&e.indexOf(s)!=-1;r?((a!=="\\"||!l)&&i.push(a),r=!1):a==="\\"?(r=!0,s&&t.indexOf(s)!=-1&&(l=!0),(!l||s==="\\")&&i.push(a)):(i.push(a),l&&s!=="\\"&&i.push("\\"))}return i.join("")}var xt={"\\n":`
`,"\\r":"\r","\\t":"	"};function Cr(n){for(var e=!1,t=[],r=-1;r<n.length;r++){var i=n.charAt(r)||"",o=n.charAt(r+1)||"";xt[i+o]?(t.push(xt[i+o]),r++):e?(t.push(i),e=!1):i==="\\"?(e=!0,v(o)||o==="$"?t.push("$"):o!=="/"&&o!=="\\"&&t.push("\\")):(i==="$"&&t.push("$"),t.push(i),o==="/"&&t.push("\\"))}return t.join("")}var Lt={"\\/":"/","\\\\":"\\","\\n":`
`,"\\r":"\r","\\t":"	","\\&":"&"};function kr(n){for(var e=new w.default.StringStream(n),t=[];!e.eol();){for(;e.peek()&&e.peek()!="\\";)t.push(e.next());var r=!1;for(var i in Lt)if(e.match(i,!0)){r=!0,t.push(Lt[i]);break}r||t.push(e.next())}return t.join("")}function mr(n,e,t){var r=L.registerController.getRegister("/");if(r.setText(n),n instanceof RegExp)return n;var i=gr(n),o,a;if(!i.length)o=n;else{o=n.substring(0,i[0]);var s=n.substring(i[0]);a=s.indexOf("i")!=-1}if(!o)return null;Y("pcre")||(o=yr(o)),t&&(e=/^[^A-Z]*$/.test(o));var l=new RegExp(o,e||a?"im":"m");return l}function Be(n){typeof n=="string"&&(n=document.createElement(n));for(var e,t=1;t<arguments.length;t++)if(e=arguments[t])if(re(e)!=="object"&&(e=document.createTextNode(e)),e.nodeType)n.appendChild(e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(r[0]==="$"?n.style[r.slice(1)]=e[r]:n.setAttribute(r,e[r]));return n}function $(n,e){var t=Be("pre",{$color:"red",class:"cm-vim-message"},e);n.openNotification?n.openNotification(t,{bottom:!0,duration:5e3}):alert(t.innerText)}function wr(n,e){return Be(document.createDocumentFragment(),Be("span",{$fontFamily:"monospace",$whiteSpace:"pre"},n,Be("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})),e&&Be("span",{$color:"#888"},e))}function Ye(n,e){var t=wr(e.prefix,e.desc);if(n.openDialog)n.openDialog(t,e.onClose,{onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:e.value});else{var r="";typeof e.prefix!="string"&&e.prefix&&(r+=e.prefix.textContent),e.desc&&(r+=" "+e.desc),e.onClose(prompt(r,""))}}function Sr(n,e){if(n instanceof RegExp&&e instanceof RegExp){for(var t=["global","multiline","ignoreCase","source"],r=0;r<t.length;r++){var i=t[r];if(n[i]!==e[i])return!1}return!0}return!1}function We(n,e,t,r){if(e){var i=Me(n),o=mr(e,!!t,!!r);if(o)return At(n,o),Sr(o,i.getQuery())||i.setQuery(o),o}}function Mr(n){if(n.source.charAt(0)=="^")var e=!0;return{token:function(r){if(e&&!r.sol()){r.skipToEnd();return}var i=r.match(n,!1);if(i)return i[0].length==0?(r.next(),"searching"):!r.sol()&&(r.backUp(1),!n.exec(r.next()+i[0]))?(r.next(),null):(r.match(n),"searching");for(;!r.eol()&&(r.next(),!r.match(n,!1)););},query:n}}var qe=0;function At(n,e){clearTimeout(qe),qe=setTimeout(function(){if(n.state.vim){var t=Me(n),r=t.getOverlay();(!r||e!=r.query)&&(r&&n.removeOverlay(r),r=Mr(e),n.addOverlay(r),n.showMatchesOnScrollbar&&(t.getScrollbarAnnotate()&&t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(n.showMatchesOnScrollbar(e))),t.setOverlay(r))}},50)}function Tt(n,e,t,r){return r===void 0&&(r=1),n.operation(function(){for(var i=n.getCursor(),o=n.getSearchCursor(t,i),a=0;a<r;a++){var s=o.find(e);if(a==0&&s&&ve(o.from(),i)){var l=e?o.from():o.to();s=o.find(e),s&&!s[0]&&ve(o.from(),l)&&n.getLine(l.line).length==l.ch&&(s=o.find(e))}if(!s&&(o=n.getSearchCursor(t,e?new S(n.lastLine()):new S(n.firstLine(),0)),!o.find(e)))return}return o.from()})}function br(n,e,t,r,i){return r===void 0&&(r=1),n.operation(function(){var o=n.getCursor(),a=n.getSearchCursor(t,o),s=a.find(!e);!i.visualMode&&s&&ve(a.from(),o)&&a.find(!e);for(var l=0;l<r;l++)if(s=a.find(e),!s&&(a=n.getSearchCursor(t,e?new S(n.lastLine()):new S(n.firstLine(),0)),!a.find(e)))return;return[a.from(),a.to()]})}function ot(n){var e=Me(n);n.removeOverlay(Me(n).getOverlay()),e.setOverlay(null),e.getScrollbarAnnotate()&&(e.getScrollbarAnnotate().clear(),e.setScrollbarAnnotate(null))}function xr(n,e,t){return typeof n!="number"&&(n=n.line),e instanceof Array?V(n,e):typeof t=="number"?n>=e&&n<=t:n==e}function at(n){var e=n.getScrollInfo(),t=6,r=10,i=n.coordsChar({left:0,top:t+e.top},"local"),o=e.clientHeight-r+e.top,a=n.coordsChar({left:0,top:o},"local");return{top:i.line,bottom:a.line}}function It(n,e,t){if(t=="'"||t=="`")return L.jumpList.find(n,-1)||new S(0,0);if(t==".")return Rt(n);var r=e.marks[t];return r&&r.find()}function Rt(n){for(var e=n.doc.history.done,t=e.length;t--;)if(e[t].changes)return z(e[t].changes[0].to)}var Et=function(){this.buildCommandMap_()};Et.prototype={processCommand:function(e,t,r){var i=this;e.operation(function(){e.curOp.isVimOp=!0,i._processCommand(e,t,r)})},_processCommand:function(e,t,r){var i=e.state.vim,o=L.registerController.getRegister(":"),a=o.toString();i.visualMode&&we(e);var s=new w.default.StringStream(t);o.setText(t);var l=r||{};l.input=t;try{this.parseInput_(e,s,l)}catch(k){throw $(e,k.toString()),k}var u,c;if(!l.commandName)l.line!==void 0&&(c="move");else if(u=this.matchCommand_(l.commandName),u){if(c=u.name,u.excludeFromCommandHistory&&o.setText(a),this.parseCommandArgs_(s,l,u),u.type=="exToKey"){for(var p=0;p<u.toKeys.length;p++)_e.handleKey(e,u.toKeys[p],"mapping");return}else if(u.type=="exToEx"){this.processCommand(e,u.toInput);return}}if(!c){$(e,'Not an editor command ":'+t+'"');return}try{Ot[c](e,l),(!u||!u.possiblyAsync)&&l.callback&&l.callback()}catch(k){throw $(e,k.toString()),k}},parseInput_:function(e,t,r){t.eatWhile(":"),t.eat("%")?(r.line=e.firstLine(),r.lineEnd=e.lastLine()):(r.line=this.parseLineSpec_(e,t),r.line!==void 0&&t.eat(",")&&(r.lineEnd=this.parseLineSpec_(e,t)));var i=t.match(/^(\w+|!!|@@|[!#&*<=>@~])/);return i?r.commandName=i[1]:r.commandName=t.match(/.*/)[0],r},parseLineSpec_:function(e,t){var r=t.match(/^(\d+)/);if(r)return parseInt(r[1],10)-1;switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var i=t.next(),o=It(e,e.state.vim,i);if(!o)throw new Error("Mark not set");return this.parseLineSpecOffset_(t,o.line);case"-":case"+":return t.backUp(1),this.parseLineSpecOffset_(t,e.getCursor().line);default:t.backUp(1);return}},parseLineSpecOffset_:function(e,t){var r=e.match(/^([+-])?(\d+)/);if(r){var i=parseInt(r[2],10);r[1]=="-"?t-=i:t+=i}return t},parseCommandArgs_:function(e,t,r){if(!e.eol()){t.argString=e.match(/.*/)[0];var i=r.argDelimiter||/\s+/,o=rt(t.argString).split(i);o.length&&o[0]&&(t.args=o)}},matchCommand_:function(e){for(var t=e.length;t>0;t--){var r=e.substring(0,t);if(this.commandMap_[r]){var i=this.commandMap_[r];if(i.name.indexOf(e)===0)return i}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0;e<P.length;e++){var t=P[e],r=t.shortName||t.name;this.commandMap_[r]=t}},map:function(e,t,r){if(e!=":"&&e.charAt(0)==":"){if(r)throw Error("Mode not supported for ex mappings");var i=e.substring(1);t!=":"&&t.charAt(0)==":"?this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:!0}:this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:!0}}else if(t!=":"&&t.charAt(0)==":"){var o={keys:e,type:"keyToEx",exArgs:{input:t.substring(1)}};r&&(o.context=r),O.unshift(o)}else{var o={keys:e,type:"keyToKey",toKeys:t};r&&(o.context=r),O.unshift(o)}},unmap:function(e,t){if(e!=":"&&e.charAt(0)==":"){if(t)throw Error("Mode not supported for ex mappings");var r=e.substring(1);if(this.commandMap_[r]&&this.commandMap_[r].user)return delete this.commandMap_[r],!0}else for(var i=e,o=0;o<O.length;o++)if(i==O[o].keys&&O[o].context===t)return O.splice(o,1),!0}};var Ot={colorscheme:function(e,t){if(!t.args||t.args.length<1){$(e,e.getOption("theme"));return}e.setOption("theme",t.args[0])},map:function(e,t,r){var i=t.args;if(!i||i.length<2){e&&$(e,"Invalid mapping: "+t.input);return}be.map(i[0],i[1],r)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},unmap:function(e,t,r){var i=t.args;(!i||i.length<1||!be.unmap(i[0],r))&&e&&$(e,"No such mapping: "+t.input)},move:function(e,t){Te.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e,t){var r=t.args,i=t.setCfg||{};if(!r||r.length<1){e&&$(e,"Invalid mapping: "+t.input);return}var o=r[0].split("="),a=o[0],s=o[1],l=!1;if(a.charAt(a.length-1)=="?"){if(s)throw Error("Trailing characters: "+t.argString);a=a.substring(0,a.length-1),l=!0}s===void 0&&a.substring(0,2)=="no"&&(a=a.substring(2),s=!1);var u=B[a]&&B[a].type=="boolean";if(u&&s==null&&(s=!0),!u&&s===void 0||l){var c=Y(a,e,i);c instanceof Error?$(e,c.message):c===!0||c===!1?$(e," "+(c?"":"no")+a):$(e,"  "+a+"="+c)}else{var p=te(a,s,e,i);p instanceof Error&&$(e,p.message)}},setlocal:function(e,t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e,t){var r=t.args,i=L.registerController.registers,o=`----------Registers----------

`;if(r){var a;r=r.join("");for(var l=0;l<r.length;l++)if(a=r.charAt(l),!!L.registerController.isValidRegister(a)){var u=i[a]||new me;o+='"'+a+"    "+u.toString()+`
`}}else for(var a in i){var s=i[a].toString();s.length&&(o+='"'+a+"    "+s+`
`)}$(e,o)},sort:function(e,t){var r,i,o,a,s;function l(){if(t.argString){var W=new w.default.StringStream(t.argString);if(W.eat("!")&&(r=!0),W.eol())return;if(!W.eatSpace())return"Invalid arguments";var N=W.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!N&&!W.eol())return"Invalid arguments";if(N[1]){i=N[1].indexOf("i")!=-1,o=N[1].indexOf("u")!=-1;var oe=N[1].indexOf("d")!=-1||N[1].indexOf("n")!=-1&&1,ce=N[1].indexOf("x")!=-1&&1,se=N[1].indexOf("o")!=-1&&1;if(oe+ce+se>1)return"Invalid arguments";a=oe&&"decimal"||ce&&"hex"||se&&"octal"}N[2]&&(s=new RegExp(N[2].substr(1,N[2].length-2),i?"i":""))}}var u=l();if(u){$(e,u+": "+t.argString);return}var c=t.line||e.firstLine(),p=t.lineEnd||t.line||e.lastLine();if(c==p)return;var k=new S(c,0),C=new S(p,ee(e,p)),g=e.getRange(k,C).split(`
`),b=s||(a=="decimal"?/(-?)([\d]+)/:a=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:a=="octal"?/([0-7]+)/:null),x=a=="decimal"?10:a=="hex"?16:a=="octal"?8:null,M=[],E=[];if(a||s)for(var T=0;T<g.length;T++){var I=s?g[T].match(s):null;I&&I[0]!=""?M.push(I):!s&&b.exec(g[T])?M.push(g[T]):E.push(g[T])}else E=g;function Q(W,N){if(r){var oe;oe=W,W=N,N=oe}i&&(W=W.toLowerCase(),N=N.toLowerCase());var ce=a&&b.exec(W),se=a&&b.exec(N);return ce?(ce=parseInt((ce[1]+ce[2]).toLowerCase(),x),se=parseInt((se[1]+se[2]).toLowerCase(),x),ce-se):W<N?-1:1}function fe(W,N){if(r){var oe;oe=W,W=N,N=oe}return i&&(W[0]=W[0].toLowerCase(),N[0]=N[0].toLowerCase()),W[0]<N[0]?-1:1}if(M.sort(s?fe:Q),s)for(var T=0;T<M.length;T++)M[T]=M[T].input;else a||E.sort(Q);if(g=r?M.concat(E):E.concat(M),o){var X=g,ae;g=[];for(var T=0;T<X.length;T++)X[T]!=ae&&g.push(X[T]),ae=X[T]}e.replaceRange(g.join(`
`),k,C)},vglobal:function(e,t){this.global(e,t)},global:function(e,t){var r=t.argString;if(!r){$(e,"Regular Expression missing from global");return}var i=t.commandName[0]==="v",o=t.line!==void 0?t.line:e.firstLine(),a=t.lineEnd||t.line||e.lastLine(),s=vr(r),l=r,u;if(s.length&&(l=s[0],u=s.slice(1,s.length).join("/")),l)try{We(e,l,!0,!0)}catch{$(e,"Invalid regex: "+l);return}for(var c=Me(e).getQuery(),p=[],k=o;k<=a;k++){var C=e.getLineHandle(k),g=c.test(C.text);g!==i&&p.push(u?C:C.text)}if(!u){$(e,p.join(`
`));return}var b=0,x=function M(){if(b<p.length){var E=p[b++],T=e.getLineNumber(E);if(T==null){M();return}var I=T+1+u;be.processCommand(e,I,{callback:M})}};x()},substitute:function(e,t){if(!e.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var r=t.argString,i=r?Mt(r,r[0]):[],o,a="",s,l,u,c=!1,p=!1;if(i.length)o=i[0],Y("pcre")&&o!==""&&(o=new RegExp(o).source),a=i[1],a!==void 0&&(Y("pcre")?a=kr(a.replace(/([^\\])&/g,"$1$$&")):a=Cr(a),L.lastSubstituteReplacePart=a),s=i[2]?i[2].split(" "):[];else if(r&&r.length){$(e,"Substitutions should be of the form :s/pattern/replace/");return}if(s&&(l=s[0],u=parseInt(s[1]),l&&(l.indexOf("c")!=-1&&(c=!0),l.indexOf("g")!=-1&&(p=!0),Y("pcre")?o=o+"/"+l:o=o.replace(/\//g,"\\/")+"/"+l)),o)try{We(e,o,!0,!0)}catch{$(e,"Invalid regex: "+o);return}if(a=a||L.lastSubstituteReplacePart,a===void 0){$(e,"No previous substitute regular expression");return}var k=Me(e),C=k.getQuery(),g=t.line!==void 0?t.line:e.getCursor().line,b=t.lineEnd||g;g==e.firstLine()&&b==e.lastLine()&&(b=1/0),u&&(g=b,b=g+u-1);var x=de(e,new S(g,0)),M=e.getSearchCursor(C,x);e.pushUndoStop(),Lr(e,c,p,g,b,M,C,a,t.callback)},redo:w.default.commands.redo,undo:w.default.commands.undo,write:function(e){w.default.commands.save?w.default.commands.save(e):e.save&&e.save()},nohlsearch:function(e){ot(e)},yank:function(e){var t=z(e.getCursor()),r=t.line,i=e.getLine(r);L.registerController.pushText("0","yank",i,!0,!0)},delmarks:function(e,t){if(!t.argString||!rt(t.argString)){$(e,"Argument required");return}for(var r=e.state.vim,i=new w.default.StringStream(rt(t.argString));!i.eol();){i.eatSpace();var o=i.pos;if(!i.match(/[a-zA-Z]/,!1)){$(e,"Invalid argument: "+t.argString.substring(o));return}var a=i.next();if(i.match("-",!0)){if(!i.match(/[a-zA-Z]/,!1)){$(e,"Invalid argument: "+t.argString.substring(o));return}var s=a,l=i.next();if(d(s)&&d(l)||m(s)&&m(l)){var u=s.charCodeAt(0),c=l.charCodeAt(0);if(u>=c){$(e,"Invalid argument: "+t.argString.substring(o));return}for(var p=0;p<=c-u;p++){var k=String.fromCharCode(u+p);delete r.marks[k]}}else{$(e,"Invalid argument: "+s+"-");return}}else delete r.marks[a]}}},be=new Et;function Lr(n,e,t,r,i,o,a,s,l){n.state.vim.exMode=!0;var u=!1,c,p,k;function C(){n.operation(function(){for(;!u;)g(),x();M()})}function g(){var T=n.getRange(o.from(),o.to()),I=T.replace(a,s),Q=o.to().line;o.replace(I),p=o.to().line,i+=p-Q,k=p<Q}function b(){var T=c&&z(o.to()),I=o.findNext();return I&&!I[0]&&T&&ve(o.from(),T)&&(I=o.findNext()),I}function x(){for(;b()&&xr(o.from(),r,i);)if(!(!t&&o.from().line==p&&!k)){n.scrollIntoView(o.from(),30),n.setSelection(o.from(),o.to()),c=o.from(),u=!1;return}u=!0}function M(T){if(T&&T(),n.focus(),c){n.setCursor(c);var I=n.state.vim;I.exMode=!1,I.lastHPos=I.lastHSPos=c.ch}l&&l()}function E(T,I,Q){w.default.e_stop(T);var fe=w.default.keyName(T);switch(fe){case"Y":g(),x();break;case"N":x();break;case"A":var X=l;l=void 0,n.operation(C),l=X;break;case"L":g();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":M(Q);break}return u&&M(Q),!0}if(x(),u){$(n,"No matches for "+a.source);return}if(!e){C(),l&&l();return}Ye(n,{prefix:Be("span","replace with ",Be("strong",s)," (y/n/a/q/l)"),onKeyDown:E})}w.default.keyMap.vim={attach:Re,detach:Ce,call:Ke};function Fe(n){var e=n.state.vim,t=L.macroModeState,r=L.registerController.getRegister("."),i=t.isPlaying,o=t.lastInsertModeChanges;i||(n.off("change",Bt),w.default.off(n.getInputField(),"keydown",Nt)),!i&&e.insertModeRepeat>1&&(Kt(n,e,e.insertModeRepeat-1,!0),e.lastEditInputState.repeatOverride=e.insertModeRepeat),delete e.insertModeRepeat,e.insertMode=!1,n.setCursor(n.getCursor().line,n.getCursor().ch-1),n.setOption("keyMap","vim"),n.setOption("disableInput",!0),n.toggleOverwrite(!1),r.setText(o.changes.join("")),w.default.signal(n,"vim-mode-change",{mode:"normal"}),t.isRecording&&Rr(t),n.enterVimMode()}function Pt(n){O.unshift(n)}function Ar(n,e,t,r,i){var o={keys:n,type:e};o[e]=t,o[e+"Args"]=r;for(var a in i)o[a]=i[a];Pt(o)}Z("insertModeEscKeysTimeout",200,"number"),w.default.keyMap["vim-insert"]={fallthrough:["default"],attach:Re,detach:Ce,call:Ke},w.default.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:Re,detach:Ce,call:Ke};function Tr(n,e,t,r){var i=L.registerController.getRegister(r);if(r==":"){i.keyBuffer[0]&&be.processCommand(n,i.keyBuffer[0]),t.isPlaying=!1;return}var o=i.keyBuffer,a=0;t.isPlaying=!0,t.replaySearchQueries=i.searchQueries.slice(0);for(var s=0;s<o.length;s++)for(var l=o[s],u,c;l;)if(u=/<\w+-.+?>|<\w+>|./.exec(l),c=u[0],l=l.substring(u.index+c.length),_e.handleKey(n,c,"macro"),e.insertMode){var p=i.insertModeChanges[a++].changes;L.macroModeState.lastInsertModeChanges.changes=p,Dt(n,p,1),Fe(n)}t.isPlaying=!1}function Ir(n,e){if(!n.isPlaying){var t=n.latestRegister,r=L.registerController.getRegister(t);r&&r.pushText(e)}}function Rr(n){if(!n.isPlaying){var e=n.latestRegister,t=L.registerController.getRegister(e);t&&t.pushInsertModeChanges&&t.pushInsertModeChanges(n.lastInsertModeChanges)}}function Er(n,e){if(!n.isPlaying){var t=n.latestRegister,r=L.registerController.getRegister(t);r&&r.pushSearchQuery&&r.pushSearchQuery(e)}}function Bt(n,e){var t=L.macroModeState,r=t.lastInsertModeChanges;if(!t.isPlaying)for(;e;){if(r.expectCursorActivityForChange=!0,r.ignoreCount>1)r.ignoreCount--;else if(e.origin=="+input"||e.origin=="paste"||e.origin===void 0){var i=n.listSelections().length;i>1&&(r.ignoreCount=i);var o=e.text.join(`
`);r.maybeReset&&(r.changes=[],r.maybeReset=!1),o&&(n.state.overwrite&&!/\n/.test(o)?r.changes.push([o]):r.changes.push(o))}e=e.next}}function _t(n){var e=n.state.vim;if(e.insertMode){var t=L.macroModeState;if(t.isPlaying)return;var r=t.lastInsertModeChanges;r.expectCursorActivityForChange?r.expectCursorActivityForChange=!1:r.maybeReset=!0}else n.curOp.isVimOp||Or(n,e)}function Or(n,e){var t=n.getCursor("anchor"),r=n.getCursor("head");if(e.visualMode&&!n.somethingSelected()?we(n,!1):!e.visualMode&&!e.insertMode&&n.somethingSelected()&&(e.visualMode=!0,e.visualLine=!1,w.default.signal(n,"vim-mode-change",{mode:"visual"})),e.visualMode){var i=q(r,t)?0:-1,o=q(r,t)?-1:0;r=ue(r,0,i),t=ue(t,0,o),e.sel={anchor:t,head:r},Ae(n,e,"<",ge(r,t)),Ae(n,e,">",Pe(r,t))}else e.insertMode||(e.lastHPos=n.getCursor().ch)}function st(n){this.keyName=n}function Nt(n){var e=L.macroModeState,t=e.lastInsertModeChanges,r=w.default.keyName(n);if(!r)return;function i(){return t.maybeReset&&(t.changes=[],t.maybeReset=!1),t.changes.push(new st(r)),!0}(r.indexOf("Delete")!=-1||r.indexOf("Backspace")!=-1)&&w.default.lookupKey(r,"vim-insert",i)}function Kt(n,e,t,r){var i=L.macroModeState;i.isPlaying=!0;var o=!!e.lastEditActionCommand,a=e.inputState;function s(){o?Te.processAction(n,e,e.lastEditActionCommand):Te.evalInput(n,e)}function l(c){if(i.lastInsertModeChanges.changes.length>0){c=e.lastEditActionCommand?c:1;var p=i.lastInsertModeChanges;Dt(n,p.changes,c)}}if(e.inputState=e.lastEditInputState,o&&e.lastEditActionCommand.interlaceInsertRepeat)for(var u=0;u<t;u++)s(),l(1);else r||s(),l(t);e.inputState=a,e.insertMode&&!r&&Fe(n),i.isPlaying=!1}function Dt(n,e,t){function r(p){return typeof p=="string"?w.default.commands[p](n):p(n),!0}var i=n.getCursor("head"),o=L.macroModeState.lastInsertModeChanges.visualBlock;o&&(vt(n,i,o+1),t=n.listSelections().length,n.setCursor(i));for(var a=0;a<t;a++){o&&n.setCursor(ue(i,a,0));for(var s=0;s<e.length;s++){var l=e[s];if(l instanceof st)w.default.lookupKey(l.keyName,"vim-insert",r);else if(typeof l=="string")window.cm=n,n.replaceSelections(l);else{var u=n.getCursor(),c=ue(u,0,l[0].length);n.replaceRange(l[0],u,c),n.setCursor(c)}}}o&&n.setCursor(ue(i,0,1))}return lt(),_e};G.Vim=U,w.default.Vim=U();var _=w.default;G.default=_})(Wt);var Ut={};(function(G){Object.defineProperty(G,"__esModule",{value:!0}),G.default=void 0;function w(H,O){if(!(H instanceof O))throw new TypeError("Cannot call a class as a function")}function pe(H,O){for(var R=0;R<O.length;R++){var P=O[R];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(H,P.key,P)}}function re(H,O,R){return O&&pe(H.prototype,O),Object.defineProperty(H,"prototype",{writable:!1}),H}var S=function(){function H(O,R){var P=this,U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;w(this,H),this.closeInput=function(){P.removeInputListeners(),P.input=null,P.setSec(""),P.editor&&P.editor.focus()},this.clear=function(){P.setInnerHtml_(P.node,"")},this.inputKeyUp=function(_){var F=P.input.options;F&&F.onKeyUp&&F.onKeyUp(_,_.target.value,P.closeInput)},this.inputKeyInput=function(_){var F=P.input.options;F&&F.onKeyInput&&F.onKeyUp(_,_.target.value,P.closeInput)},this.inputBlur=function(){var _=P.input.options;_.closeOnBlur&&P.closeInput()},this.inputKeyDown=function(_){var F=P.input,D=F.options,ye=F.callback;D&&D.onKeyDown&&D.onKeyDown(_,_.target.value,P.closeInput)||((_.keyCode===27||D&&D.closeOnEnter!==!1&&_.keyCode==13)&&(P.input.node.blur(),_.stopPropagation(),P.closeInput()),_.keyCode===13&&ye&&(_.stopPropagation(),_.preventDefault(),ye(_.target.value)))},this.node=O,this.modeInfoNode=document.createElement("span"),this.secInfoNode=document.createElement("span"),this.notifNode=document.createElement("span"),this.notifNode.className="vim-notification",this.keyInfoNode=document.createElement("span"),this.keyInfoNode.setAttribute("style","float: right"),this.node.appendChild(this.modeInfoNode),this.node.appendChild(this.secInfoNode),this.node.appendChild(this.notifNode),this.node.appendChild(this.keyInfoNode),this.toggleVisibility(!1),this.editor=R,this.sanitizer=U}return re(H,[{key:"setMode",value:function(R){if(R.mode==="visual"){R.subMode==="linewise"?this.setText("--VISUAL LINE--"):R.subMode==="blockwise"?this.setText("--VISUAL BLOCK--"):this.setText("--VISUAL--");return}this.setText("--".concat(R.mode.toUpperCase(),"--"))}},{key:"setKeyBuffer",value:function(R){this.keyInfoNode.textContent=R}},{key:"setSec",value:function(R,P,U){if(this.notifNode.textContent="",R===void 0)return this.closeInput;this.setInnerHtml_(this.secInfoNode,R);var _=this.secInfoNode.querySelector("input");return _&&(_.focus(),this.input={callback:P,options:U,node:_},U&&(U.selectValueOnOpen&&_.select(),U.value&&(_.value=U.value)),this.addInputListeners()),this.closeInput}},{key:"setText",value:function(R){this.modeInfoNode.textContent=R}},{key:"toggleVisibility",value:function(R){R?this.node.style.display="block":this.node.style.display="none",this.input&&this.removeInputListeners(),clearInterval(this.notifTimeout)}},{key:"addInputListeners",value:function(){var R=this.input.node;R.addEventListener("keyup",this.inputKeyUp),R.addEventListener("keydown",this.inputKeyDown),R.addEventListener("input",this.inputKeyInput),R.addEventListener("blur",this.inputBlur)}},{key:"removeInputListeners",value:function(){if(!(!this.input||!this.input.node)){var R=this.input.node;R.removeEventListener("keyup",this.inputKeyUp),R.removeEventListener("keydown",this.inputKeyDown),R.removeEventListener("input",this.inputKeyInput),R.removeEventListener("blur",this.inputBlur)}}},{key:"showNotification",value:function(R){var P=this,U=document.createElement("span");this.setInnerHtml_(U,R),this.notifNode.textContent=U.textContent,this.notifTimeout=setTimeout(function(){P.notifNode.textContent=""},5e3)}},{key:"setInnerHtml_",value:function(R,P){for(;R.childNodes.length;)R.removeChild(R.childNodes[0]);P&&(this.sanitizer?R.appendChild(this.sanitizer(P)):R.appendChild(P))}}]),H}();G.default=S})(Ut);(function(G){Object.defineProperty(G,"__esModule",{value:!0}),Object.defineProperty(G,"StatusBar",{enumerable:!0,get:function(){return pe.default}}),Object.defineProperty(G,"VimMode",{enumerable:!0,get:function(){return w.default}}),G.initVimMode=S;var w=re(Wt),pe=re(Ut);function re(H){return H&&H.__esModule?H:{default:H}}function S(H){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pe.default,P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,U=new w.default(H);if(!O)return U.attach(),U;var _=new R(O,H,P),F="";return U.on("vim-mode-change",function(D){_.setMode(D)}),U.on("vim-keypress",function(D){D===":"?F="":F+=D,_.setKeyBuffer(F)}),U.on("vim-command-done",function(){F="",_.setKeyBuffer(F)}),U.on("dispose",function(){_.toggleVisibility(!1),_.closeInput(),_.clear()}),_.toggleVisibility(!0),U.setStatusBar(_),U.attach(),U}})(Ht);const Hr=_r({__proto__:null},[Ht]);export{Hr as i};
