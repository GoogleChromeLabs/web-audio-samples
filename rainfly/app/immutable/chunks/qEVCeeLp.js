import{g as Dt}from"./CrW9gevp.js";import{m as Or,s as Pr}from"./BvU8ycQE.js";function Br(z,k){for(var ve=0;ve<k.length;ve++){const re=k[ve];if(typeof re!="string"&&!Array.isArray(re)){for(const S in re)if(S!=="default"&&!(S in z)){const Z=Object.getOwnPropertyDescriptor(re,S);Z&&Object.defineProperty(z,S,Z.get?Z:{enumerable:!0,get:()=>re[S]})}}}return Object.freeze(Object.defineProperty(z,Symbol.toStringTag,{value:"Module"}))}var Vt={},Ht={},Wt={};const _r=Dt(Or),Kr=Dt(Pr);(function(z){Object.defineProperty(z,"__esModule",{value:!0}),z.default=void 0;var k=_r,ve=Kr;function re(g,h){return _(g)||W(g,h)||Z(g,h)||S()}function S(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z(g,h){if(g){if(typeof g=="string")return $(g,h);var f={}.toString.call(g).slice(8,-1);return f==="Object"&&g.constructor&&(f=g.constructor.name),f==="Map"||f==="Set"?Array.from(g):f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f)?$(g,h):void 0}}function $(g,h){(h==null||h>g.length)&&(h=g.length);for(var f=0,d=Array(h);f<h;f++)d[f]=g[f];return d}function W(g,h){var f=g==null?null:typeof Symbol<"u"&&g[Symbol.iterator]||g["@@iterator"];if(f!=null){var d,v,w,A,P=[],V=!0,N=!1;try{if(w=(f=f.call(g)).next,h!==0)for(;!(V=(d=w.call(f)).done)&&(P.push(d.value),P.length!==h);V=!0);}catch(Q){N=!0,v=Q}finally{try{if(!V&&f.return!=null&&(A=f.return(),Object(A)!==A))return}finally{if(N)throw v}}return P}}function _(g){if(Array.isArray(g))return g}function T(g){"@babel/helpers - typeof";return T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},T(g)}function I(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")}function B(g,h){for(var f=0;f<h.length;f++){var d=h[f];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(g,Y(d.key),d)}}function K(g,h,f){return h&&B(g.prototype,h),Object.defineProperty(g,"prototype",{writable:!1}),g}function Y(g){var h=he(g,"string");return T(h)=="symbol"?h:h+""}function he(g,h){if(T(g)!="object"||!g)return g;var f=g[Symbol.toPrimitive];if(f!==void 0){var d=f.call(g,h);if(T(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(g)}var Te={Bottom:4},Ue={readOnly:65,cursorWidth:20,fontInfo:32},$e=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function Ze(g){return/\w/.test(g)||g>"Â€"&&(g.toUpperCase()!=g.toLowerCase()||$e.test(g))}function Be(g,h){if(!(this instanceof Be))return new Be(g,h);this.line=g,this.ch=h}function _e(g,h,f){g.dispatch(h,f)}function xe(g){return function(){}}var Ke=function(h,f){this.pos=this.start=0,this.string=h,this.tabSize=f||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Ke.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(h){var f=this.string.charAt(this.pos);if(typeof h=="string")var d=f==h;else var d=f&&(h.test?h.test(f):h(f));if(d)return++this.pos,f},eatWhile:function(h){for(var f=this.pos;this.eat(h););return this.pos>f},eatSpace:function(){for(var h=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>h},skipToEnd:function(){this.pos=this.string.length},skipTo:function(h){var f=this.string.indexOf(h,this.pos);if(f>-1)return this.pos=f,!0},backUp:function(h){this.pos-=h},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(h,f,d){if(typeof h=="string"){var v=function(V){return d?V.toLowerCase():V},w=this.string.substr(this.pos,h.length);if(v(w)==v(h))return f!==!1&&(this.pos+=h.length),!0}else{var A=this.string.slice(this.pos).match(h);return A&&A.index>0?null:(A&&f!==!1&&(this.pos+=A[0].length),A)}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(h,f){this.lineStart+=h;try{return f()}finally{this.lineStart-=h}}};function oe(g){return new Be(g.lineNumber-1,g.column-1)}function G(g){return new k.Position(g.line+1,g.ch+1)}var Qe=function(){function g(h,f,d,v){I(this,g),this.cm=h,this.id=f,this.lineNumber=d+1,this.column=v+1,h.marks[this.id]=this}return K(g,[{key:"clear",value:function(){delete this.cm.marks[this.id]}},{key:"find",value:function(){return oe(this)}}])}();function Je(g){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f=!0,d=k.KeyCode[g.keyCode];g.key&&(d=g.key,f=!1);var v=d,w=h;switch(g.keyCode){case k.KeyCode.Shift:case k.KeyCode.Meta:case k.KeyCode.Alt:case k.KeyCode.Ctrl:return v;case k.KeyCode.Escape:w=!0,v="Esc";break;case k.KeyCode.Space:w=!0;break}return d.startsWith("Key")||d.startsWith("KEY_")?v=d[d.length-1].toLowerCase():d.startsWith("Digit")?v=d.slice(5,6):d.startsWith("Numpad")?v=d.slice(6,7):d.endsWith("Arrow")?(w=!0,v=d.substring(0,d.length-5)):(d.startsWith("US_")||d.startsWith("Bracket")||!v)&&(v=g.browserEvent.key),!w&&!g.altKey&&!g.ctrlKey&&!g.metaKey?v=g.key||g.browserEvent.key:(g.altKey&&(v="Alt-".concat(v)),g.ctrlKey&&(v="Ctrl-".concat(v)),g.metaKey&&(v="Meta-".concat(v)),g.shiftKey&&(v="Shift-".concat(v))),v.length===1&&f&&(v="'".concat(v,"'")),v}var F=function(){function g(h){I(this,g),Ve.call(this),this.editor=h,this.state={keyMap:"vim"},this.marks={},this.$uid=0,this.disposables=[],this.listeners={},this.curOp={},this.attached=!1,this.statusBar=null,this.options={},this.addLocalListeners(),this.ctxInsert=this.editor.createContextKey("insertMode",!0)}return K(g,[{key:"attach",value:function(){g.keyMap.vim.attach(this)}},{key:"addLocalListeners",value:function(){this.disposables.push(this.editor.onDidChangeCursorPosition(this.handleCursorChange),this.editor.onDidChangeModelContent(this.handleChange),this.editor.onKeyDown(this.handleKeyDown))}},{key:"handleReplaceMode",value:function(f,d){var v=!1,w=f,A=this.editor.getPosition(),P=new k.Range(A.lineNumber,A.column,A.lineNumber,A.column+1),V=!0;if(f.startsWith("'"))w=f[1];else if(w==="Enter")w=`
`;else if(w==="Backspace"){var N=this.replaceStack.pop();if(!N)return;v=!0,w=N,P=new k.Range(A.lineNumber,A.column,A.lineNumber,A.column-1)}else return;d.preventDefault(),d.stopPropagation(),this.replaceStack||(this.replaceStack=[]),v||this.replaceStack.push(this.editor.getModel().getValueInRange(P)),this.editor.executeEdits("vim",[{text:w,range:P,forceMoveMarkers:V}]),v&&this.editor.setPosition(P.getStartPosition())}},{key:"setOption",value:function(f,d){this.state[f]=d,f==="theme"&&k.editor.setTheme(d)}},{key:"getConfiguration",value:function(){var f=this.editor,d=Ue;return typeof f.getConfiguration=="function"?f.getConfiguration():("EditorOption"in k.editor&&(d=k.editor.EditorOption),{readOnly:f.getOption(d.readOnly),viewInfo:{cursorWidth:f.getOption(d.cursorWidth)},fontInfo:f.getOption(d.fontInfo)})}},{key:"getOption",value:function(f){return f==="readOnly"?this.getConfiguration().readOnly:f==="firstLineNumber"?this.firstLine()+1:f==="indentWithTabs"?!this.editor.getModel().getOptions().insertSpaces:typeof this.editor.getConfiguration=="function"?this.editor.getRawConfiguration()[f]:this.editor.getRawOptions()[f]}},{key:"dispatch",value:function(f){for(var d=arguments.length,v=new Array(d>1?d-1:0),w=1;w<d;w++)v[w-1]=arguments[w];var A=this.listeners[f];A&&A.forEach(function(P){return P.apply(void 0,v)})}},{key:"on",value:function(f,d){this.listeners[f]||(this.listeners[f]=[]),this.listeners[f].push(d)}},{key:"off",value:function(f,d){var v=this.listeners[f];v&&(this.listeners[f]=v.filter(function(w){return w!==d}))}},{key:"firstLine",value:function(){return 0}},{key:"lastLine",value:function(){return this.lineCount()-1}},{key:"lineCount",value:function(){return this.editor.getModel().getLineCount()}},{key:"defaultTextHeight",value:function(){return 1}},{key:"getLine",value:function(f){if(f<0)return"";var d=this.editor.getModel(),v=d.getLineCount();return f+1>v&&(f=v-1),this.editor.getModel().getLineContent(f+1)}},{key:"getAnchorForSelection",value:function(f){if(f.isEmpty())return f.getPosition();var d=f.getDirection();return d===k.SelectionDirection.LTR?f.getStartPosition():f.getEndPosition()}},{key:"getHeadForSelection",value:function(f){if(f.isEmpty())return f.getPosition();var d=f.getDirection();return d===k.SelectionDirection.LTR?f.getEndPosition():f.getStartPosition()}},{key:"getCursor",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(!f)return oe(this.editor.getPosition());var d=this.editor.getSelection(),v;return d.isEmpty()?v=d.getPosition():f==="anchor"?v=this.getAnchorForSelection(d):v=this.getHeadForSelection(d),oe(v)}},{key:"getRange",value:function(f,d){var v=G(f),w=G(d);return this.editor.getModel().getValueInRange(k.Range.fromPositions(v,w))}},{key:"getSelection",value:function(){var f=[],d=this.editor;return d.getSelections().map(function(v){f.push(d.getModel().getValueInRange(v))}),f.join(`
`)}},{key:"replaceRange",value:function(f,d,v){var w=G(d),A=v?G(v):w;this.editor.executeEdits("vim",[{text:f,range:k.Range.fromPositions(w,A)}]),this.pushUndoStop()}},{key:"pushUndoStop",value:function(){this.editor.pushUndoStop()}},{key:"setCursor",value:function(f,d){var v=f;T(f)!=="object"&&(v={},v.line=f,v.ch=d);var w=this.editor.getModel().validatePosition(G(v));this.editor.setPosition(G(v)),this.editor.revealPosition(w)}},{key:"somethingSelected",value:function(){return!this.editor.getSelection().isEmpty()}},{key:"operation",value:function(f,d){return f()}},{key:"listSelections",value:function(){var f=this,d=this.editor.getSelections();return!d.length||this.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:d.map(function(v){return v.getPosition(),v.getStartPosition(),v.getEndPosition(),{anchor:f.clipPos(oe(f.getAnchorForSelection(v))),head:f.clipPos(oe(f.getHeadForSelection(v)))}})}},{key:"focus",value:function(){this.editor.focus()}},{key:"setSelections",value:function(f,d){var v=!!this.editor.getSelections().length,w=f.map(function(V,N){var Q=V.anchor,ie=V.head;return v?k.Selection.fromPositions(G(Q),G(ie)):k.Selection.fromPositions(G(ie),G(Q))});if(d&&w[d]&&w.push(w.splice(d,1)[0]),!!w.length){var A=w[0],P;A.getDirection()===k.SelectionDirection.LTR?P=A.getEndPosition():P=A.getStartPosition(),this.editor.setSelections(w),this.editor.revealPosition(P)}}},{key:"setSelection",value:function(f,d){var v=k.Range.fromPositions(G(f),G(d));this.editor.setSelection(v)}},{key:"getSelections",value:function(){var f=this.editor;return f.getSelections().map(function(d){return f.getModel().getValueInRange(d)})}},{key:"replaceSelections",value:function(f){var d=this.editor;d.getSelections().forEach(function(v,w){d.executeEdits("vim",[{range:v,text:f[w],forceMoveMarkers:!1}])})}},{key:"toggleOverwrite",value:function(f){f?(this.enterVimMode(),this.replaceMode=!0):(this.leaveVimMode(),this.replaceMode=!1,this.replaceStack=[])}},{key:"charCoords",value:function(f,d){return{top:f.line,left:f.ch}}},{key:"coordsChar",value:function(f,d){}},{key:"clipPos",value:function(f){var d=this.editor.getModel().validatePosition(G(f));return oe(d)}},{key:"setBookmark",value:function(f,d){var v=new Qe(this,this.$uid++,f.line,f.ch);return(!d||!d.insertLeft)&&(v.$insertRight=!0),this.marks[v.id]=v,v}},{key:"getScrollInfo",value:function(){var f=this.editor,d=f.getVisibleRanges(),v=re(d,1),w=v[0];return{left:0,top:w.startLineNumber-1,height:f.getModel().getLineCount(),clientHeight:w.endLineNumber-w.startLineNumber+1}}},{key:"triggerEditorAction",value:function(f){this.editor.trigger("vim",f)}},{key:"dispose",value:function(){this.dispatch("dispose"),this.removeOverlay(),g.keyMap.vim&&g.keyMap.vim.detach(this),this.disposables.forEach(function(f){return f.dispose()})}},{key:"getInputField",value:function(){}},{key:"getWrapperElement",value:function(){}},{key:"enterVimMode",value:function(){this.ctxInsert.set(!1);var f=this.getConfiguration();this.initialCursorWidth=f.viewInfo.cursorWidth||0,this.editor.updateOptions({cursorWidth:f.fontInfo.typicalFullwidthCharacterWidth,cursorBlinking:"solid",cursorStyle:"block"})}},{key:"leaveVimMode",value:function(){this.ctxInsert.set(!0),this.editor.updateOptions({cursorWidth:this.initialCursorWidth||0,cursorBlinking:"blink",cursorStyle:"line"})}},{key:"virtualSelectionMode",value:function(){return this.inVirtualSelectionMode}},{key:"markText",value:function(){return{clear:function(){},find:function(){}}}},{key:"getUserVisibleLines",value:function(){var f=this.editor.getVisibleRanges();if(!f.length)return{top:0,bottom:0};var d={top:1/0,bottom:0};return f.reduce(function(v,w){return w.startLineNumber<v.top&&(v.top=w.startLineNumber),w.endLineNumber>v.bottom&&(v.bottom=w.endLineNumber),v},d),d.top-=1,d.bottom-=1,d}},{key:"findPosV",value:function(f,d,v){var w=this.editor,A=d,P=v,V=G(f);if(v==="page"){var N=w.getLayoutInfo().height,Q=this.getConfiguration().fontInfo.lineHeight;A=A*Math.floor(N/Q),P="line"}return P==="line"&&(V.lineNumber+=A),oe(V)}},{key:"findMatchingBracket",value:function(f){var d=G(f),v=this.editor.getModel(),w;if(v.bracketPairs)w=v.bracketPairs.matchBracket(d);else{var A;w=(A=v.matchBracket)===null||A===void 0?void 0:A.call(v,d)}return!w||w.length!==2?{to:null}:{to:oe(w[1].getStartPosition())}}},{key:"findFirstNonWhiteSpaceCharacter",value:function(f){return this.editor.getModel().getLineFirstNonWhitespaceColumn(f+1)-1}},{key:"scrollTo",value:function(f,d){!f&&!d||f||(d<0&&(d=this.editor.getPosition().lineNumber-d),this.editor.setScrollTop(this.editor.getTopForLineNumber(d+1)))}},{key:"moveCurrentLineTo",value:function(f){var d,v=this.editor,w=v.getPosition(),A=k.Range.fromPositions(w,w);switch(f){case"top":v.revealRangeAtTop(A);return;case"center":v.revealRangeInCenter(A);return;case"bottom":(d=v._revealRange)===null||d===void 0||d.call(v,A,Te.Bottom);return}}},{key:"getSearchCursor",value:function(f,d){var v=!1,w=!1;f instanceof RegExp&&!f.global&&(v=!f.ignoreCase,f=f.source,w=!0),d.ch==null&&(d.ch=Number.MAX_VALUE);var A=G(d),P=this,V=this.editor,N=null,Q=V.getModel(),ie=Q.findMatches(f,!1,w,v)||[];return{getMatches:function(){return ie},findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},jumpTo:function(me){if(!ie||!ie.length)return!1;var ee=ie[me];return N=ee.range,P.highlightRanges([N],"currentFindMatch"),P.highlightRanges(ie.map(function(L){return L.range}).filter(function(L){return!L.equalsRange(N)})),N},find:function(me){if(!ie||!ie.length)return!1;var ee;if(me){var L=N?N.getStartPosition():A;if(ee=Q.findPreviousMatch(f,L,w,v),!ee||!ee.range.getStartPosition().isBeforeOrEqual(L))return!1}else{var Ee=N?Q.getPositionAt(Q.getOffsetAt(N.getEndPosition())+1):A;if(ee=Q.findNextMatch(f,Ee,w,v),!ee||!Ee.isBeforeOrEqual(ee.range.getStartPosition()))return!1}return N=ee.range,P.highlightRanges([N],"currentFindMatch"),P.highlightRanges(ie.map(function(Ce){return Ce.range}).filter(function(Ce){return!Ce.equalsRange(N)})),N},from:function(){return N&&oe(N.getStartPosition())},to:function(){return N&&oe(N.getEndPosition())},replace:function(me){N&&(V.executeEdits("vim",[{range:N,text:me,forceMoveMarkers:!0}],function(ee){var L=ee[0].range,Ee=L.endLineNumber,Ce=L.endColumn;N=N.setEndPosition(Ee,Ce)}),V.setPosition(N.getStartPosition()))}}}},{key:"highlightRanges",value:function(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"findMatch",v="decoration".concat(d);return this[v]=this.editor.deltaDecorations(this[v]||[],f.map(function(w){return{range:w,options:{stickiness:k.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,zIndex:13,className:d,showIfCollapsed:!0}}})),this[v]}},{key:"addOverlay",value:function(f,d,v){var w=f.query,A=!1,P=!1;w&&w instanceof RegExp&&!w.global&&(P=!0,A=!w.ignoreCase,w=w.source);var V=this.editor.getModel().findNextMatch(w,this.editor.getPosition(),P,A);!V||!V.range||this.highlightRanges([V.range])}},{key:"removeOverlay",value:function(){var f=this;["currentFindMatch","findMatch"].forEach(function(d){f.editor.deltaDecorations(f["decoration".concat(d)]||[],[])})}},{key:"scrollIntoView",value:function(f){f&&this.editor.revealPosition(G(f))}},{key:"moveH",value:function(f,d){if(d==="char"){var v=this.editor.getPosition();this.editor.setPosition(new k.Position(v.lineNumber,v.column+f))}}},{key:"scanForBracket",value:function(f,d,v,w){for(var A=w.bracketRegex,P=G(f),V=this.editor.getModel(),N=(d===-1?V.findPreviousMatch:V.findNextMatch).bind(V),Q=[],ie=0;;){if(ie>10)return;var ae=N(A.source,P,!0,!0,null,!0),me=ae.matches[0];if(ae===void 0)return;var ee=g.matchingBrackets[me];if(ee&&ee.charAt(1)===">"==d>0)Q.push(me);else if(Q.length===0){var L=ae.range.getStartPosition();return{pos:oe(L)}}else Q.pop();P=V.getPositionAt(V.getOffsetAt(ae.range.getStartPosition())+d),ie+=1}}},{key:"indexFromPos",value:function(f){return this.editor.getModel().getOffsetAt(G(f))}},{key:"posFromIndex",value:function(f){return oe(this.editor.getModel().getPositionAt(f))}},{key:"indentLine",value:function(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,v=this.editor,w;v._getViewModel?w=v._getViewModel().cursorConfig:w=v._getCursors().context.config;var A=new k.Position(f+1,1),P=k.Selection.fromPositions(A,A);v.executeCommand("vim",new ve.ShiftCommand(P,{isUnshift:!d,tabSize:w.tabSize,indentSize:w.indentSize,insertSpaces:w.insertSpaces,useTabStops:w.useTabStops,autoIndent:w.autoIndent}))}},{key:"setStatusBar",value:function(f){this.statusBar=f}},{key:"openDialog",value:function(f,d,v){if(this.statusBar)return this.statusBar.setSec(f,d,v)}},{key:"openNotification",value:function(f){this.statusBar&&this.statusBar.showNotification(f)}},{key:"smartIndent",value:function(){this.editor.getAction("editor.action.formatSelection").run()}},{key:"moveCursorTo",value:function(f){var d=this.editor.getPosition();f==="start"?d.column=1:f==="end"&&(d.column=this.editor.getModel().getLineMaxColumn(d.lineNumber)),this.editor.setPosition(d)}},{key:"execCommand",value:function(f){switch(f){case"goLineLeft":this.moveCursorTo("start");break;case"goLineRight":this.moveCursorTo("end");break;case"indentAuto":this.smartIndent();break}}}])}();F.Pos=Be,F.signal=_e,F.on=xe(),F.off=xe(),F.addClass=xe(),F.rmClass=xe(),F.defineOption=xe(),F.keyMap={default:function(h){return function(f){return!0}}},F.matchingBrackets={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"},F.isWordChar=Ze,F.keyName=Je,F.StringStream=Ke,F.e_stop=function(g){return g.stopPropagation?g.stopPropagation():g.cancelBubble=!0,F.e_preventDefault(g),!1},F.e_preventDefault=function(g){return g.preventDefault?(g.preventDefault(),g.browserEvent&&g.browserEvent.preventDefault()):g.returnValue=!1,!1},F.commands={redo:function(h){h.editor.getModel().redo()},undo:function(h){h.editor.getModel().undo()},newlineAndIndent:function(h){h.triggerEditorAction("editor.action.insertLineAfter")}},F.lookupKey=function g(h,f,d){typeof f=="string"&&(f=F.keyMap[f]);var v=typeof f=="function"?f(h):f[h];if(v===!1)return"nothing";if(v==="...")return"multi";if(v!=null&&d(v))return"handled";if(f.fallthrough){if(!Array.isArray(f.fallthrough))return g(h,f.fallthrough,d);for(var w=0;w<f.fallthrough.length;w++){var A=g(h,f.fallthrough[w],d);if(A)return A}}},F.defineExtension=function(g,h){F.prototype[g]=h};var Ve=function(){var h=this;this.handleKeyDown=function(f){if(!(f.browserEvent.defaultPrevented&f.keyCode!==k.KeyCode.Escape)&&h.attached){var d=Je(f);if(h.replaceMode&&h.handleReplaceMode(d,f),!!d){var v=h.state.keyMap;if(F.keyMap[v]&&F.keyMap[v].call){var w=F.keyMap[v].call(d,h);if(w){f.preventDefault(),f.stopPropagation();try{w()}catch(A){console.error(A)}}}}}},this.handleCursorChange=function(f){var d=f.position;f.source;var v=h.editor,w=v.getSelection();if(!h.ctxInsert.get()&&f.source==="mouse"&&w.isEmpty()){var A=v.getModel().getLineMaxColumn(d.lineNumber);if(f.position.column===A){v.setPosition(new k.Position(f.position.lineNumber,A-1));return}}h.dispatch("cursorActivity",h,f)},this.handleChange=function(f){var d=f.changes,v={text:d.reduce(function(A,P){return A.push(P.text),A},[]),origin:"+input"},w=h.curOp=h.curOp||{};w.changeHandlers||(w.changeHandlers=h.listeners.change&&h.listeners.change.slice()),!h.virtualSelectionMode()&&(w.lastChange?w.lastChange.next=w.lastChange=v:w.lastChange=w.change=v,h.dispatch("change",h,v))}};z.default=F})(Wt);(function(z){Object.defineProperty(z,"__esModule",{value:!0}),z.default=z.Vim=void 0;var k=ve(Wt);function ve(I){return I&&I.__esModule?I:{default:I}}function re(I){"@babel/helpers - typeof";return re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},re(I)}var S=k.default.Pos;function Z(I,B){var K=I.state.vim;if(!K||K.insertMode)return B.head;var Y=K.sel.head;if(!Y)return B.head;if(!(K.visualBlock&&B.head.line!=Y.line))return B.from()==B.anchor&&!B.empty()&&B.head.line==Y.line&&B.head.ch!=Y.ch?new S(B.head.line,B.head.ch-1):B.head}var $=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],W=$.length,_=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"global",shortName:"g"}],T=z.Vim=function(){function B(n){n.setOption("disableInput",!0),n.setOption("showCursorWhenSelecting",!1),k.default.signal(n,"vim-mode-change",{mode:"normal"}),n.on("cursorActivity",Bt),ee(n),n.enterVimMode()}function K(n){n.setOption("disableInput",!1),n.off("cursorActivity",Bt),n.state.vim=null,qe&&clearTimeout(qe),n.leaveVimMode()}function Y(n,e){n.attached=!1,this==k.default.keyMap.vim&&(n.options.$customCursor=null),(!e||e.attach!=he)&&K(n)}function he(n,e){this==k.default.keyMap.vim&&(n.attached=!0,n.curOp&&(n.curOp.selectionChanged=!0),n.options.$customCursor=Z),(!e||e.attach!=he)&&B(n)}k.default.defineOption("vimMode",!1,function(n,e,t){e&&n.getOption("keyMap")!="vim"?n.setOption("keyMap","vim"):!e&&t!=k.default.Init&&/^vim/.test(n.getOption("keyMap"))&&n.setOption("keyMap","default")});function Te(n,e){if(e){if(this[n])return this[n];var t=Ze(n);if(!t)return!1;var r=Ne.findKey(e,t);return typeof r=="function"&&k.default.signal(e,"vim-keypress",t),r}}var Ue={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A",CapsLock:""},$e={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"};function Ze(n){if(n.charAt(0)=="'")return n.charAt(1);if(n==="AltGraph")return!1;var e=n.split(/-(?!$)/),t=e[e.length-1];if(e.length==1&&e[0].length==1)return!1;if(e.length==2&&e[0]=="Shift"&&t.length==1)return!1;for(var r=!1,i=0;i<e.length;i++){var o=e[i];o in Ue?e[i]=Ue[o]:r=!0,o in $e&&(e[i]=$e[o])}return r?(d(t)&&(e[e.length-1]=t.toLowerCase()),"<"+e.join("-")+">"):!1}var Be=/[\d]/,_e=[k.default.isWordChar,function(n){return n&&!k.default.isWordChar(n)&&!/\s/.test(n)}],xe=[function(n){return/\S/.test(n)}];function Ke(n,e){for(var t=[],r=n;r<n+e;r++)t.push(String.fromCharCode(r));return t}var oe=Ke(65,26),G=Ke(97,26),Qe=Ke(48,10),Je=[].concat(oe,G,Qe,["<",">"]),F=[].concat(oe,G,Qe,["-",'"',".",":","_","/"]),Ve;try{Ve=new RegExp("^[\\p{Lu}]$","u")}catch{Ve=/^[A-Z]$/}function g(n,e){return e>=n.firstLine()&&e<=n.lastLine()}function h(n){return/^[a-z]$/.test(n)}function f(n){return Be.test(n)}function d(n){return Ve.test(n)}function v(n){return/^\s*$/.test(n)}function w(n){return".?!".indexOf(n)!=-1}function A(n,e){for(var t=0;t<e.length;t++)if(e[t]==n)return!0;return!1}var P={};function V(n,e,t,r,i){if(e===void 0&&!i)throw Error("defaultValue is required unless callback is provided");if(t||(t="string"),P[n]={type:t,defaultValue:e,callback:i},r)for(var o=0;o<r.length;o++)P[r[o]]=P[n];e&&N(n,e)}function N(n,e,t,r){var i=P[n];r=r||{};var o=r.scope;if(!i)return new Error("Unknown option: "+n);if(i.type=="boolean"){if(e&&e!==!0)return new Error("Invalid argument: "+n+"="+e);e!==!1&&(e=!0)}i.callback?(o!=="local"&&i.callback(e,void 0),o!=="global"&&t&&i.callback(e,t)):(o!=="local"&&(i.value=i.type=="boolean"?!!e:e),o!=="global"&&t&&(t.state.vim.options[n]={value:e}))}function Q(n,e,t){var r=P[n];t=t||{};var i=t.scope;if(!r)return new Error("Unknown option: "+n);if(r.callback){var o=e&&r.callback(void 0,e);return i!=="global"&&o!==void 0?o:i!=="local"?r.callback():void 0}else{var o=i!=="global"&&e&&e.state.vim.options[n];return(o||i!=="local"&&r||{}).value}}V("filetype",void 0,"string",["ft"],function(n,e){if(e!==void 0)if(n===void 0){var t=e.getOption("mode");return t=="null"?"":t}else{var t=n==""?"null":n;e.setOption("mode",t)}});var ie=function(){var e=100,t=-1,r=0,i=0,o=new Array(e);function a(u,c,p){var C=t%e,m=o[C];function y(x){var M=++t%e,O=o[M];O&&O.clear(),o[M]=u.setBookmark(x)}if(m){var b=m.find();b&&!ge(b,c)&&y(c)}else y(c);y(p),r=t,i=t-e+1,i<0&&(i=0)}function s(u,c){t+=c,t>r?t=r:t<i&&(t=i);var p=o[(e+t)%e];if(p&&!p.find()){var C=c>0?1:-1,m,y=u.getCursor();do if(t+=C,p=o[(e+t)%e],p&&(m=p.find())&&!ge(y,m))break;while(t<r&&t>i)}return p}function l(u,c){var p=t,C=s(u,c);return t=p,C&&C.find()}return{cachedCursor:void 0,add:a,find:l,move:s}},ae=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};function me(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=ae()}me.prototype={exitMacroRecordMode:function(){var e=L.macroModeState;e.onRecordingDone&&e.onRecordingDone(),e.onRecordingDone=void 0,e.isRecording=!1},enterMacroRecordMode:function(e,t){var r=L.registerController.getRegister(t);r&&(r.clear(),this.latestRegister=t,e.openDialog&&(this.onRecordingDone=e.openDialog(document.createTextNode("(recording)["+t+"]"),null,{bottom:!0})),this.isRecording=!0)}};function ee(n){return n.state.vim||(n.state.vim={inputState:new ze,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),n.state.vim}var L;function Ee(){L={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:ie(),macroModeState:new me,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new lt({}),searchHistoryController:new et,exCommandHistoryController:new et};for(var n in P){var e=P[n];e.value=e.defaultValue}}var Ce,Ne={buildKeyMap:function(){},getRegisterController:function(){return L.registerController},resetVimGlobalState_:Ee,getVimGlobalState_:function(){return L},maybeInitVimState_:ee,suppressErrorLogging:!1,InsertModeKey:st,map:function(e,t,r){be.map(e,t,r)},unmap:function(e,t){return be.unmap(e,t)},noremap:function(e,t,r){function i(m){return m?[m]:["normal","insert","visual"]}for(var o=i(r),a=$.length,s=W,l=a-s;l<a&&o.length;l++){var u=$[l];if(u.keys==t&&(!r||!u.context||u.context===r)&&u.type.substr(0,2)!=="ex"&&u.type.substr(0,3)!=="key"){var c={};for(var p in u)c[p]=u[p];c.keys=e,r&&!c.context&&(c.context=r),this._mapCommand(c);var C=i(u.context);o=o.filter(function(m){return C.indexOf(m)===-1})}}},mapclear:function(e){var t=$.length,r=W,i=$.slice(0,t-r);if($=$.slice(t-r),e)for(var o=i.length-1;o>=0;o--){var a=i[o];if(e!==a.context)if(a.context)this._mapCommand(a);else{var s=["normal","insert","visual"];for(var l in s)if(s[l]!==e){var u={};for(var c in a)u[c]=a[c];u.context=s[l],this._mapCommand(u)}}}},setOption:N,getOption:Q,defineOption:V,defineEx:function(e,t,r){if(!t)t=e;else if(e.indexOf(t)!==0)throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered');Et[e]=r,be.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,r){var i=this.findKey(e,t,r);if(typeof i=="function")return i()},findKey:function(e,t,r){var i=ee(e);function o(){var p=L.macroModeState;if(p.isRecording){if(t=="q")return p.exitMacroRecordMode(),de(e),!0;r!="mapping"&&Tr(p,t)}}function a(){if(t=="<Esc>"){if(i.visualMode)we(e);else if(i.insertMode)We(e);else return;return de(e),!0}}function s(p){for(var C;p;)C=/<\w+-.+?>|<\w+>|./.exec(p),t=C[0],p=p.substring(C.index+t.length),Ne.handleKey(e,t,"mapping")}function l(){if(a())return!0;for(var p=i.inputState.keyBuffer=i.inputState.keyBuffer+t,C=t.length==1,m=Ie.matchCommand(p,$,i.inputState,"insert");p.length>1&&m.type!="full";){var p=i.inputState.keyBuffer=p.slice(1),y=Ie.matchCommand(p,$,i.inputState,"insert");y.type!="none"&&(m=y)}if(m.type=="none")return de(e),!1;if(m.type=="partial")return Ce&&window.clearTimeout(Ce),Ce=window.setTimeout(function(){i.insertMode&&i.inputState.keyBuffer&&de(e)},Q("insertModeEscKeysTimeout")),!C;if(Ce&&window.clearTimeout(Ce),C){for(var b=e.listSelections(),x=0;x<b.length;x++){var M=b[x].head;e.replaceRange("",ue(M,0,-(p.length-1)),M,"+input")}L.macroModeState.lastInsertModeChanges.changes.pop()}return de(e),m.command}function u(){if(o()||a())return!0;var p=i.inputState.keyBuffer=i.inputState.keyBuffer+t;if(/^[1-9]\d*$/.test(p))return!0;var b=/^(\d*)(.*)$/.exec(p);if(!b)return de(e),!1;var C=i.visualMode?"visual":"normal",m=b[2]||b[1];i.inputState.operatorShortcut&&i.inputState.operatorShortcut.slice(-1)==m&&(m=i.inputState.operatorShortcut);var y=Ie.matchCommand(m,$,i.inputState,C);if(y.type=="none")return de(e),!1;if(y.type=="partial")return!0;i.inputState.keyBuffer="";var b=/^(\d*)(.*)$/.exec(p);return b[1]&&b[1]!="0"&&i.inputState.pushRepeatDigit(b[1]),y.command}var c;return i.insertMode?c=l():c=u(),c===!1?!i.insertMode&&t.length===1?function(){return!0}:void 0:c===!0?function(){return!0}:function(){return e.operation(function(){e.curOp.isVimOp=!0;try{c.type=="keyToKey"?s(c.toKeys):Ie.processCommand(e,i,c)}catch(p){throw e.state.vim=void 0,ee(e),Ne.suppressErrorLogging||console.log(p),p}return!0})}},handleEx:function(e,t){be.processCommand(e,t)},defineMotion:Ut,defineAction:Qt,defineOperator:$t,mapCommand:Lr,_mapCommand:Ot,defineRegister:jt,exitVisualMode:we,exitInsertMode:We};function ze(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}ze.prototype.pushRepeatDigit=function(n){this.operator?this.motionRepeat=this.motionRepeat.concat(n):this.prefixRepeat=this.prefixRepeat.concat(n)},ze.prototype.getRepeat=function(){var n=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(n=1,this.prefixRepeat.length>0&&(n*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(n*=parseInt(this.motionRepeat.join(""),10))),n};function de(n,e){n.state.vim.inputState=new ze,k.default.signal(n,"vim-command-done",e)}function ke(n,e,t){this.clear(),this.keyBuffer=[n||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!e,this.blockwise=!!t}ke.prototype={setText:function(e,t,r){this.keyBuffer=[e||""],this.linewise=!!t,this.blockwise=!!r},pushText:function(e,t){t&&(this.linewise||this.keyBuffer.push(`
`),this.linewise=!0),this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(ae(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}};function jt(n,e){var t=L.registerController.registers;if(!n||n.length!=1)throw Error("Register name must be 1 character");if(t[n])throw Error("Register already defined "+n);t[n]=e,F.push(n)}function lt(n){this.registers=n,this.unnamedRegister=n['"']=new ke,n["."]=new ke,n[":"]=new ke,n["/"]=new ke}lt.prototype={pushText:function(e,t,r,i,o){if(e!=="_"){i&&r.charAt(r.length-1)!==`
`&&(r+=`
`);var a=this.isValidRegister(e)?this.getRegister(e):null;if(!a){switch(t){case"yank":this.registers[0]=new ke(r,i,o);break;case"delete":case"change":r.indexOf(`
`)==-1?this.registers["-"]=new ke(r,i):(this.shiftNumericRegisters_(),this.registers[1]=new ke(r,i));break}this.unnamedRegister.setText(r,i,o);return}var s=d(e);s?a.pushText(r,i):a.setText(r,i,o),this.unnamedRegister.setText(a.toString(),i)}},getRegister:function(e){return this.isValidRegister(e)?(e=e.toLowerCase(),this.registers[e]||(this.registers[e]=new ke),this.registers[e]):this.unnamedRegister},isValidRegister:function(e){return e&&A(e,F)},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--)this.registers[e]=this.getRegister(""+(e-1))}};function et(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}et.prototype={nextMatch:function(e,t){var r=this.historyBuffer,i=t?-1:1;this.initialPrefix===null&&(this.initialPrefix=e);for(var o=this.iterator+i;t?o>=0:o<r.length;o+=i)for(var a=r[o],s=0;s<=a.length;s++)if(this.initialPrefix==a.substring(0,s))return this.iterator=o,a;if(o>=r.length)return this.iterator=r.length,this.initialPrefix;if(o<0)return e},pushInput:function(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1),e.length&&this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var Ie={matchCommand:function(e,t,r,i){var o=Jt(e,t,i,r);if(!o.full&&!o.partial)return{type:"none"};if(!o.full&&o.partial)return{type:"partial"};for(var a,s=0;s<o.full.length;s++){var l=o.full[s];a||(a=l)}if(a.keys.slice(-11)=="<character>"){var u=Gt(e);if(!u)return{type:"none"};r.selectedCharacter=u}return{type:"full",command:a}},processCommand:function(e,t,r){switch(t.inputState.repeatOverride=r.repeatOverride,r.type){case"motion":this.processMotion(e,t,r);break;case"operator":this.processOperator(e,t,r);break;case"operatorMotion":this.processOperatorMotion(e,t,r);break;case"action":this.processAction(e,t,r);break;case"search":this.processSearch(e,t,r);break;case"ex":case"keyToEx":this.processEx(e,t,r);break}},processMotion:function(e,t,r){t.inputState.motion=r.motion,t.inputState.motionArgs=Ge(r.motionArgs),this.evalInput(e,t)},processOperator:function(e,t,r){var i=t.inputState;if(i.operator)if(i.operator==r.operator){i.motion="expandToLine",i.motionArgs={linewise:!0},this.evalInput(e,t);return}else de(e);i.operator=r.operator,i.operatorArgs=Ge(r.operatorArgs),r.keys.length>1&&(i.operatorShortcut=r.keys),r.exitVisualBlock&&(t.visualBlock=!1,De(e)),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,r){var i=t.visualMode,o=Ge(r.operatorMotionArgs);o&&i&&o.visualLine&&(t.visualLine=!0),this.processOperator(e,t,r),i||this.processMotion(e,t,r)},processAction:function(e,t,r){var i=t.inputState,o=i.getRepeat(),a=!!o,s=Ge(r.actionArgs)||{};i.selectedCharacter&&(s.selectedCharacter=i.selectedCharacter),r.operator&&this.processOperator(e,t,r),r.motion&&this.processMotion(e,t,r),(r.motion||r.operator)&&this.evalInput(e,t),s.repeat=o||1,s.repeatIsExplicit=a,s.registerName=i.registerName,de(e),t.lastMotion=null,r.isEdit&&this.recordLastEdit(t,i,r),tt[r.action](e,s,t)},processSearch:function(e,t,r){if(!e.getSearchCursor)return;var i=r.searchArgs.forward,o=r.searchArgs.wholeWordOnly;Me(e).setReversed(!i);var a=i?"/":"?",s=Me(e).getQuery(),l=e.getScrollInfo();function u(M,O,R){L.searchHistoryController.pushInput(M),L.searchHistoryController.reset();try{He(e,M,O,R)}catch{j(e,"Invalid regex: "+M),de(e);return}Ie.processMotion(e,t,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:r.searchArgs.toJumplist}})}function c(M){e.scrollTo(l.left,l.top),u(M,!0,!0);var O=L.macroModeState;O.isRecording&&Rr(O,M)}function p(M,O,R){var E=k.default.keyName(M),U,fe;E=="Up"||E=="Down"?(U=E=="Up",fe=M.target?M.target.selectionEnd:0,O=L.searchHistoryController.nextMatch(O,U)||"",R(O),fe&&M.target&&(M.target.selectionEnd=M.target.selectionStart=Math.min(fe,M.target.value.length))):E!="Left"&&E!="Right"&&E!="Ctrl"&&E!="Alt"&&E!="Shift"&&L.searchHistoryController.reset();var X;try{X=He(e,O,!0,!0)}catch{}X?e.scrollIntoView(At(e,!i,X),30):(ot(e),e.scrollTo(l.left,l.top))}function C(M,O,R){var E=k.default.keyName(M);E=="Esc"||E=="Ctrl-C"||E=="Ctrl-["||E=="Backspace"&&O==""?(L.searchHistoryController.pushInput(O),L.searchHistoryController.reset(),He(e,s),ot(e),e.scrollTo(l.left,l.top),k.default.e_stop(M),de(e),R(),e.focus()):E=="Up"||E=="Down"?k.default.e_stop(M):E=="Ctrl-U"&&(k.default.e_stop(M),R(""))}switch(r.searchArgs.querySrc){case"prompt":var m=L.macroModeState;if(m.isPlaying){var x=m.replaySearchQueries.shift();u(x,!0,!1)}else Ye(e,{onClose:c,prefix:a,desc:"(JavaScript regexp)",onKeyUp:p,onKeyDown:C});break;case"wordUnderCursor":var y=Xe(e,!1,!0,!1,!0),b=!0;if(y||(y=Xe(e,!1,!0,!1,!1),b=!1),!y)return;var x=e.getLine(y.start.line).substring(y.start.ch,y.end.ch);b&&o?x="\\b"+x+"\\b":x=Xt(x),L.jumpList.cachedCursor=e.getCursor(),e.setCursor(y.start),u(x,!0,!1);break}},processEx:function(e,t,r){function i(a){L.exCommandHistoryController.pushInput(a),L.exCommandHistoryController.reset(),be.processCommand(e,a)}function o(a,s,l){var u=k.default.keyName(a),c,p;(u=="Esc"||u=="Ctrl-C"||u=="Ctrl-["||u=="Backspace"&&s=="")&&(L.exCommandHistoryController.pushInput(s),L.exCommandHistoryController.reset(),k.default.e_stop(a),de(e),l(),e.focus()),u=="Up"||u=="Down"?(k.default.e_stop(a),c=u=="Up",p=a.target?a.target.selectionEnd:0,s=L.exCommandHistoryController.nextMatch(s,c)||"",l(s),p&&a.target&&(a.target.selectionEnd=a.target.selectionStart=Math.min(p,a.target.value.length))):u=="Ctrl-U"?(k.default.e_stop(a),l("")):u!="Left"&&u!="Right"&&u!="Ctrl"&&u!="Alt"&&u!="Shift"&&L.exCommandHistoryController.reset()}r.type=="keyToEx"?be.processCommand(e,r.exArgs.input):t.visualMode?Ye(e,{onClose:i,prefix:":",value:"'<,'>",onKeyDown:o,selectValueOnOpen:!1}):Ye(e,{onClose:i,prefix:":",onKeyDown:o})},evalInput:function(e,t){var r=t.inputState,i=r.motion,o=r.motionArgs||{},a=r.operator,s=r.operatorArgs||{},l=r.registerName,u=t.sel,c=J(t.visualMode?pe(e,u.head):e.getCursor("head")),p=J(t.visualMode?pe(e,u.anchor):e.getCursor("anchor")),C=J(c),m=J(p),y,b,x;if(a&&this.recordLastEdit(t,r),r.repeatOverride!==void 0?x=r.repeatOverride:x=r.getRepeat(),x>0&&o.explicitRepeat?o.repeatIsExplicit=!0:(o.noRepeat||!o.explicitRepeat&&x===0)&&(x=1,o.repeatIsExplicit=!1),r.selectedCharacter&&(o.selectedCharacter=s.selectedCharacter=r.selectedCharacter),o.repeat=x,de(e),i){var M=Le[i](e,c,o,t,r);if(t.lastMotion=Le[i],!M)return;if(o.toJumplist){var O=L.jumpList,R=O.cachedCursor;R?(gt(e,R,M),delete O.cachedCursor):gt(e,c,M)}M instanceof Array?(b=M[0],y=M[1]):y=M,y||(y=J(c)),t.visualMode?(t.visualBlock&&y.ch===1/0||(y=pe(e,y)),b&&(b=pe(e,b)),b=b||m,u.anchor=b,u.head=y,De(e),Ae(e,t,"<",q(b,y)?b:y),Ae(e,t,">",q(b,y)?y:b)):a||(y=pe(e,y),e.setCursor(y.line,y.ch))}if(a){if(s.lastSel){b=m;var E=s.lastSel,U=Math.abs(E.head.line-E.anchor.line),fe=Math.abs(E.head.ch-E.anchor.ch);E.visualLine?y=new S(m.line+U,m.ch):E.visualBlock?y=new S(m.line+U,m.ch+fe):E.head.line==E.anchor.line?y=new S(m.line,m.ch+fe):y=new S(m.line+U,m.ch),t.visualMode=!0,t.visualLine=E.visualLine,t.visualBlock=E.visualBlock,u=t.sel={anchor:b,head:y},De(e)}else t.visualMode&&(s.lastSel={anchor:J(u.anchor),head:J(u.head),visualBlock:t.visualBlock,visualLine:t.visualLine});var X,se,H,D,ne;if(t.visualMode){if(X=ye(u.head,u.anchor),se=Oe(u.head,u.anchor),H=t.visualLine||s.linewise,D=t.visualBlock?"block":H?"line":"char",ne=nt(e,{anchor:X,head:se},D),H){var ce=ne.ranges;if(D=="block")for(var le=0;le<ce.length;le++)ce[le].head.ch=te(e,ce[le].head.line);else D=="line"&&(ce[0].head=new S(ce[0].head.line+1,0))}}else{if(X=J(b||m),se=J(y||C),q(se,X)){var Re=X;X=se,se=Re}H=o.linewise||s.linewise,H?nr(e,X,se):o.forward&&rr(e,X,se),D="char";var Fe=!o.inclusive||H;ne=nt(e,{anchor:X,head:se},D,Fe)}e.setSelections(ne.ranges,ne.primary),t.lastMotion=null,s.repeat=x,s.registerName=l,s.linewise=H;var je=ft[a](e,s,ne.ranges,m,y);t.visualMode&&we(e,je!=null),je&&e.setCursor(je)}},recordLastEdit:function(e,t,r){var i=L.macroModeState;i.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=r,i.lastInsertModeChanges.changes=[],i.lastInsertModeChanges.expectCursorActivityForChange=!1,i.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0)}},Le={moveToTopLine:function(e,t,r){var i=at(e).top+r.repeat-1;return new S(i,Se(e.getLine(i)))},moveToMiddleLine:function(e){var t=at(e),r=Math.floor((t.top+t.bottom)*.5);return new S(r,Se(e.getLine(r)))},moveToBottomLine:function(e,t,r){var i=at(e).bottom-r.repeat+1;return new S(i,Se(e.getLine(i)))},expandToLine:function(e,t,r){var i=t;return new S(i.line+r.repeat-1,1/0)},findNext:function(e,t,r){var i=Me(e),o=i.getQuery();if(o){var a=!r.forward;return a=i.isReversed()?!a:a,Lt(e,o),At(e,a,o,r.repeat)}},findAndSelectNextInclusive:function(e,t,r,i,o){var a=Me(e),s=a.getQuery();if(s){var l=!r.forward;l=a.isReversed()?!l:l;var u=Mr(e,l,s,r.repeat,i);if(u){if(o.operator)return u;var c=u[0],p=new S(u[1].line,u[1].ch-1);if(i.visualMode){(i.visualLine||i.visualBlock)&&(i.visualLine=!1,i.visualBlock=!1,k.default.signal(e,"vim-mode-change",{mode:"visual",subMode:""}));var C=i.sel.anchor;if(C)return a.isReversed()?r.forward?[C,c]:[C,p]:r.forward?[C,p]:[C,c]}else i.visualMode=!0,i.visualLine=!1,i.visualBlock=!1,k.default.signal(e,"vim-mode-change",{mode:"visual",subMode:""});return l?[p,c]:[c,p]}}},goToMark:function(e,t,r,i){var o=Tt(e,i,r.selectedCharacter);return o?r.linewise?{line:o.line,ch:Se(e.getLine(o.line))}:o:null},moveToOtherHighlightedEnd:function(e,t,r,i){if(i.visualBlock&&r.sameLine){var o=i.sel;return[pe(e,new S(o.anchor.line,o.head.ch)),pe(e,new S(o.head.line,o.anchor.ch))]}else return[i.sel.head,i.sel.anchor]},jumpToMark:function(e,t,r,i){for(var o=t,a=0;a<r.repeat;a++){var s=o;for(var l in i.marks)if(h(l)){var u=i.marks[l].find(),c=r.forward?q(u,s):q(s,u);if(!c&&!(r.linewise&&u.line==s.line)){var p=ge(s,o),C=r.forward?ht(s,u,o):ht(o,u,s);(p||C)&&(o=u)}}}return r.linewise&&(o=new S(o.line,Se(e.getLine(o.line)))),o},moveByCharacters:function(e,t,r){var i=t,o=r.repeat,a=r.forward?i.ch+o:i.ch-o;return new S(i.line,a)},moveByLines:function(e,t,r,i){var o=t,a=o.ch;switch(i.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:a=i.lastHPos;break;default:i.lastHPos=a}var s=r.repeat+(r.repeatOffset||0),l=r.forward?o.line+s:o.line-s,u=e.firstLine(),c=e.lastLine(),p=e.findPosV(o,r.forward?s:-s,"line",i.lastHSPos),C=r.forward?p.line>l:p.line<l;return C&&(l=p.line,a=p.ch),l<u&&o.line==u?this.moveToStartOfLine(e,t,r,i):l>c&&o.line==c?Ct(e,t,r,i,!0):(r.toFirstChar&&(a=Se(e.getLine(l)),i.lastHPos=a),i.lastHSPos=e.charCoords(new S(l,a),"div").left,new S(l,a))},moveByDisplayLines:function(e,t,r,i){var o=t;switch(i.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:i.lastHSPos=e.charCoords(o,"div").left}var a=r.repeat,s=e.findPosV(o,r.forward?a:-a,"line",i.lastHSPos);if(s.hitSide)if(r.forward)var l=e.charCoords(s,"div"),u={top:l.top+8,left:i.lastHSPos},s=e.coordsChar(u,"div");else{var c=e.charCoords(new S(e.firstLine(),0),"div");c.left=i.lastHSPos,s=e.coordsChar(c,"div")}return i.lastHPos=s.ch,s},moveByPage:function(e,t,r){var i=t,o=r.repeat;return e.findPosV(i,r.forward?o:-o,"page")},moveByParagraph:function(e,t,r){var i=r.forward?1:-1;return kt(e,t,r.repeat,i)},moveBySentence:function(e,t,r){var i=r.forward?1:-1;return cr(e,t,r.repeat,i)},moveByScroll:function(e,t,r,i){var o=e.getScrollInfo(),l=null,a=r.repeat;a||(a=o.clientHeight/(2*e.defaultTextHeight()));var s=e.charCoords(t,"local");r.repeat=a;var l=Le.moveByDisplayLines(e,t,r,i);if(!l)return null;var u=e.charCoords(l,"local");return e.scrollTo(null,o.top+u.top-s.top),l},moveByWords:function(e,t,r){return lr(e,t,r.repeat,!!r.forward,!!r.wordEnd,!!r.bigWord)},moveTillCharacter:function(e,t,r){var i=r.repeat,o=it(e,i,r.forward,r.selectedCharacter),a=r.forward?-1:1;return yt(a,r),o?(o.ch+=a,o):null},moveToCharacter:function(e,t,r){var i=r.repeat;return yt(0,r),it(e,i,r.forward,r.selectedCharacter)||t},moveToSymbol:function(e,t,r){var i=r.repeat;return ar(e,i,r.forward,r.selectedCharacter)||t},moveToColumn:function(e,t,r,i){var o=r.repeat;return i.lastHPos=o-1,i.lastHSPos=e.charCoords(t,"div").left,ur(e,o)},moveToEol:function(e,t,r,i){return Ct(e,t,r,i,!1)},moveToFirstNonWhiteSpaceCharacter:function(e,t){var r=t;return new S(r.line,Se(e.getLine(r.line)))},moveToMatchedSymbol:function(e,t){var r=t,i=r.line,o=r.ch,a=e.getLine(i);if(o<a.length){var s=o==="<"||o===">"?/[(){}[\]<>]/:/[(){}[\]]/,l=e.findMatchingBracket(new S(i,o),{bracketRegex:s});return l.to}else return r},moveToStartOfLine:function(e,t){return new S(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,r){var i=r.forward?e.lastLine():e.firstLine();return r.repeatIsExplicit&&(i=r.repeat-e.getOption("firstLineNumber")),new S(i,Se(e.getLine(i)))},moveToStartOfDisplayLine:function(e){return e.execCommand("goLineLeft"),e.getCursor()},moveToEndOfDisplayLine:function(e){e.execCommand("goLineRight");var t=e.getCursor();return t.sticky=="before"&&t.ch--,t},textObjectManipulation:function(e,t,r,i){var o={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"},a={"'":!0,'"':!0,"`":!0},s=r.selectedCharacter;s=="b"?s="(":s=="B"&&(s="{");var l=!r.textObjectInner,u;if(o[s])u=hr(e,t,s,l);else if(a[s])u=dr(e,t,s,l);else if(s==="W")u=Xe(e,l,!0,!0);else if(s==="w")u=Xe(e,l,!0,!1);else if(s==="p")if(u=kt(e,t,r.repeat,0,l),r.linewise=!0,i.visualMode)i.visualLine||(i.visualLine=!0);else{var c=i.inputState.operatorArgs;c&&(c.linewise=!0),u.end.line--}else if(s==="t")u=ir(e,t,l);else return null;return e.state.vim.visualMode?er(e,u.start,u.end):[u.start,u.end]},repeatLastCharacterSearch:function(e,t,r){var i=L.lastCharacterSearch,o=r.repeat,a=r.forward===i.forward,s=(i.increment?1:0)*(a?-1:1);e.moveH(-s,"char"),r.inclusive=!!a;var l=it(e,o,a,i.selectedCharacter);return l?(l.ch+=s,l):(e.moveH(s,"char"),t)}};function Ut(n,e){Le[n]=e}function ut(n,e){for(var t=[],r=0;r<e;r++)t.push(n);return t}var ft={change:function(e,t,r){var i,o,a=e.state.vim,s=r[0].anchor,l=r[0].head;if(a.visualMode)if(t.fullLine)l.ch=Number.MAX_VALUE,l.line--,e.setSelection(s,l),o=e.getSelection(),e.replaceSelections(""),i=s;else{o=e.getSelection();var m=ut("",r.length);e.replaceSelections(m),i=ye(r[0].head,r[0].anchor)}else{o=e.getRange(s,l);var u=a.lastEditInputState||{};if(u.motion=="moveByWords"&&!v(o)){var c=/\s+$/.exec(o);c&&u.motionArgs&&u.motionArgs.forward&&(l=ue(l,0,-c[0].length),o=o.slice(0,-c[0].length))}var p=new S(s.line-1,Number.MAX_VALUE),C=e.firstLine()==e.lastLine();l.line>e.lastLine()&&t.linewise&&!C?e.replaceRange("",p,l):e.replaceRange("",s,l),t.linewise&&(C||(e.setCursor(p),k.default.commands.newlineAndIndent(e)),s.ch=Number.MAX_VALUE),i=s}L.registerController.pushText(t.registerName,"change",o,t.linewise,r.length>1),tt.enterInsertMode(e,{head:i},e.state.vim)},delete:function(e,t,r){e.pushUndoStop();var i,o,a=e.state.vim;if(a.visualBlock){o=e.getSelection();var u=ut("",r.length);e.replaceSelections(u),i=ye(r[0].head,r[0].anchor)}else{var s=r[0].anchor,l=r[0].head;t.linewise&&l.line!=e.firstLine()&&s.line==e.lastLine()&&s.line==l.line-1&&(s.line==e.firstLine()?s.ch=0:s=new S(s.line-1,te(e,s.line-1))),o=e.getRange(s,l),e.replaceRange("",s,l),i=s,t.linewise&&(i=Le.moveToFirstNonWhiteSpaceCharacter(e,s))}return L.registerController.pushText(t.registerName,"delete",o,t.linewise,a.visualBlock),pe(e,i)},indent:function(e,t,r){var i=e.state.vim,o=r[0].anchor.line,a=i.visualBlock?r[r.length-1].anchor.line:r[0].head.line,s=i.visualMode?t.repeat:1;t.linewise&&a--,e.pushUndoStop();for(var l=o;l<=a;l++)for(var u=0;u<s;u++)e.indentLine(l,t.indentRight);return e.pushUndoStop(),Le.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},indentAuto:function(e,t,r){return e.execCommand("indentAuto"),Le.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},changeCase:function(e,t,r,i,o){for(var a=e.getSelections(),s=[],l=t.toLower,u=0;u<a.length;u++){var c=a[u],p="";if(l===!0)p=c.toLowerCase();else if(l===!1)p=c.toUpperCase();else for(var C=0;C<c.length;C++){var m=c.charAt(C);p+=d(m)?m.toLowerCase():m.toUpperCase()}s.push(p)}return e.replaceSelections(s),t.shouldMoveCursor?o:!e.state.vim.visualMode&&t.linewise&&r[0].anchor.line+1==r[0].head.line?Le.moveToFirstNonWhiteSpaceCharacter(e,i):t.linewise?i:ye(r[0].anchor,r[0].head)},yank:function(e,t,r,i){var o=e.state.vim,a=e.getSelection(),s=o.visualMode?ye(o.sel.anchor,o.sel.head,r[0].head,r[0].anchor):i;return L.registerController.pushText(t.registerName,"yank",a,t.linewise,o.visualBlock),s}};function $t(n,e){ft[n]=e}var tt={jumpListWalk:function(e,t,r){if(!r.visualMode){var i=t.repeat,o=t.forward,a=L.jumpList,s=a.move(e,o?i:-i),l=s?s.find():void 0;l=l||e.getCursor(),e.setCursor(l)}},scroll:function(e,t,r){if(!r.visualMode){var i=t.repeat||1,o=e.defaultTextHeight(),a=e.getScrollInfo().top,s=o*i,l=t.forward?a+s:a-s,u=J(e.getCursor()),c=e.charCoords(u,"local");if(t.forward)l>c.top?(u.line+=(l-c.top)/o,u.line=Math.ceil(u.line),e.setCursor(u),c=e.charCoords(u,"local"),e.scrollTo(null,c.top)):e.scrollTo(null,l);else{var p=l+e.getScrollInfo().clientHeight;p<c.bottom?(u.line-=(c.bottom-p)/o,u.line=Math.floor(u.line),e.setCursor(u),c=e.charCoords(u,"local"),e.scrollTo(null,c.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,l)}}},scrollToCursor:function(e,t){var r=e.getCursor().line,i=e.charCoords(new S(r,0),"local"),o=e.getScrollInfo().clientHeight,a=i.top,s=i.bottom-a;switch(t.position){case"center":a=a-o/2+s;break;case"bottom":a=a-o+s;break}e.moveCurrentLineTo(a)},replayMacro:function(e,t,r){var i=t.selectedCharacter,o=t.repeat,a=L.macroModeState;for(i=="@"?i=a.latestRegister:a.latestRegister=i;o--;)Ar(e,r,a,i)},enterMacroRecordMode:function(e,t){var r=L.macroModeState,i=t.selectedCharacter;L.registerController.isValidRegister(i)&&r.enterMacroRecordMode(e,i)},toggleOverwrite:function(e){e.state.overwrite?(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),k.default.signal(e,"vim-mode-change",{mode:"insert"})):(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),k.default.signal(e,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(e,t,r){if(!e.getOption("readOnly")){r.insertMode=!0,r.insertModeRepeat=t&&t.repeat||1;var i=t?t.insertAt:null,o=r.sel,a=t.head||e.getCursor("head"),s=e.listSelections().length;if(i=="eol")a=new S(a.line,te(e,a.line));else if(i=="bol")a=new S(a.line,0);else if(i=="charAfter")a=ue(a,0,1);else if(i=="firstNonBlank")a=Le.moveToFirstNonWhiteSpaceCharacter(e,a);else if(i=="startOfSelectedArea"){if(!r.visualMode)return;r.visualBlock?(a=new S(Math.min(o.head.line,o.anchor.line),Math.min(o.head.ch,o.anchor.ch)),s=Math.abs(o.head.line-o.anchor.line)+1):o.head.line<o.anchor.line?a=o.head:a=new S(o.anchor.line,0)}else if(i=="endOfSelectedArea"){if(!r.visualMode)return;r.visualBlock?(a=new S(Math.min(o.head.line,o.anchor.line),Math.max(o.head.ch,o.anchor.ch)+1),s=Math.abs(o.head.line-o.anchor.line)+1):o.head.line>=o.anchor.line?a=ue(o.head,0,1):a=new S(o.anchor.line,0)}else if(i=="inplace"){if(r.visualMode)return}else i=="lastEdit"&&(a=It(e)||a);e.setOption("disableInput",!1),t&&t.replace?(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),k.default.signal(e,"vim-mode-change",{mode:"replace"})):(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),k.default.signal(e,"vim-mode-change",{mode:"insert"})),L.macroModeState.isPlaying||(e.on("change",Pt),k.default.on(e.getInputField(),"keydown",_t)),r.visualMode&&we(e),pt(e,a,s)}},toggleVisualMode:function(e,t,r){var i=t.repeat,o=e.getCursor(),a;r.visualMode?r.visualLine^t.linewise||r.visualBlock^t.blockwise?(r.visualLine=!!t.linewise,r.visualBlock=!!t.blockwise,k.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),De(e)):we(e):(r.visualMode=!0,r.visualLine=!!t.linewise,r.visualBlock=!!t.blockwise,a=pe(e,new S(o.line,o.ch+i-1)),r.sel={anchor:o,head:a},k.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),De(e),Ae(e,r,"<",ye(o,a)),Ae(e,r,">",Oe(o,a)))},reselectLastSelection:function(e,t,r){var i=r.lastSelection;if(r.visualMode&&vt(e,r),i){var o=i.anchorMark.find(),a=i.headMark.find();if(!o||!a)return;r.sel={anchor:o,head:a},r.visualMode=!0,r.visualLine=i.visualLine,r.visualBlock=i.visualBlock,De(e),Ae(e,r,"<",ye(o,a)),Ae(e,r,">",Oe(o,a)),k.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""})}},joinLines:function(e,t,r){var i,o;if(r.visualMode){if(i=e.getCursor("anchor"),o=e.getCursor("head"),q(o,i)){var a=o;o=i,i=a}o.ch=te(e,o.line)-1}else{var s=Math.max(t.repeat,2);i=e.getCursor(),o=pe(e,new S(i.line+s-1,1/0))}for(var l=0,u=i.line;u<o.line;u++){l=te(e,i.line);var a=new S(i.line+1,te(e,i.line+1)),c=e.getRange(i,a);c=t.keepSpaces?c.replace(/\n\r?/g,""):c.replace(/\n\s*/g," "),e.replaceRange(c,i,a)}var p=new S(i.line,l);r.visualMode&&we(e,!1),e.setCursor(p)},newLineAndEnterInsertMode:function(e,t,r){if(!e.getOption("readOnly")){r.insertMode=!0;var i=J(e.getCursor());if(i.line===e.firstLine()&&!t.after)e.replaceRange(`
`,new S(e.firstLine(),0)),e.setCursor(e.firstLine(),0);else{i.line=t.after?i.line:i.line-1,i.ch=te(e,i.line),e.setCursor(i);var o=k.default.commands.newlineAndIndentContinueComment||k.default.commands.newlineAndIndent;o(e)}this.enterInsertMode(e,{repeat:t.repeat},r)}},paste:function(e,t,r){var i=J(e.getCursor()),o=L.registerController.getRegister(t.registerName),a=o.toString();if(a){if(t.matchIndent){var s=e.getOption("tabSize"),l=function(Re){var Fe=Re.split("	").length-1,je=Re.split(" ").length-1;return Fe*s+je*1},u=e.getLine(e.getCursor().line),c=l(u.match(/^\s*/)[0]),p=a.replace(/\n$/,""),C=a!==p,m=l(a.match(/^\s*/)[0]),a=p.replace(/^\s*/gm,function(le){var Re=c+(l(le)-m);if(Re<0)return"";if(e.getOption("indentWithTabs")){var Fe=Math.floor(Re/s);return Array(Fe+1).join("	")}else return Array(Re+1).join(" ")});a+=C?`
`:""}if(t.repeat>1)var a=Array(t.repeat+1).join(a);var y=o.linewise,b=o.blockwise;if(b){a=a.split(`
`),y&&a.pop();for(var x=0;x<a.length;x++)a[x]=a[x]==""?" ":a[x];i.ch+=t.after?1:0,i.ch=Math.min(te(e,i.line),i.ch)}else y?r.visualMode?a=r.visualLine?a.slice(0,-1):`
`+a.slice(0,a.length-1)+`
`:t.after?(a=`
`+a.slice(0,a.length-1),i.ch=te(e,i.line)):i.ch=0:i.ch+=t.after?1:0;var M,O;if(r.visualMode){r.lastPastedText=a;var R,E=Zt(e,r),U=E[0],fe=E[1],X=e.getSelection(),se=e.listSelections(),H=new Array(se.length).join("1").split("1");r.lastSelection&&(R=r.lastSelection.headMark.find()),L.registerController.unnamedRegister.setText(X),b?(e.replaceSelections(H),fe=new S(U.line+a.length-1,U.ch),e.setCursor(U),dt(e,fe),e.replaceSelections(a),M=U):r.visualBlock?(e.replaceSelections(H),e.setCursor(U),e.replaceRange(a,U,U),M=U):(e.replaceRange(a,U,fe),M=e.posFromIndex(e.indexFromPos(U)+a.length-1)),R&&(r.lastSelection.headMark=e.setBookmark(R)),y&&(M.ch=0)}else if(b){e.setCursor(i);for(var x=0;x<a.length;x++){var D=i.line+x;D>e.lastLine()&&e.replaceRange(`
`,new S(D,0));var ne=te(e,D);ne<i.ch&&Yt(e,D,i.ch)}e.setCursor(i),dt(e,new S(i.line+a.length-1,i.ch)),e.replaceSelections(a),M=i}else e.replaceRange(a,i),y&&t.after?M=new S(i.line+1,Se(e.getLine(i.line+1))):y&&!t.after?M=new S(i.line,Se(e.getLine(i.line))):!y&&t.after?(O=e.indexFromPos(i),M=e.posFromIndex(O+a.length-1)):(O=e.indexFromPos(i),M=e.posFromIndex(O+a.length));r.visualMode&&we(e,!1),e.setCursor(M)}},undo:function(e,t){e.operation(function(){ct(e,k.default.commands.undo,t.repeat)(),e.setCursor(e.getCursor("anchor"))})},redo:function(e,t){ct(e,k.default.commands.redo,t.repeat)()},setRegister:function(e,t,r){r.inputState.registerName=t.selectedCharacter},setMark:function(e,t,r){var i=t.selectedCharacter;Ae(e,r,i,e.getCursor())},replace:function(e,t,r){var i=t.selectedCharacter,o=e.getCursor(),a,s,l=e.listSelections();if(r.visualMode)o=e.getCursor("start"),s=e.getCursor("end");else{var u=e.getLine(o.line);a=o.ch+t.repeat,a>u.length&&(a=u.length),s=new S(o.line,a)}if(i==`
`)r.visualMode||e.replaceRange("",o,s),(k.default.commands.newlineAndIndentContinueComment||k.default.commands.newlineAndIndent)(e);else{var c=e.getRange(o,s);if(c=c.replace(/[^\n]/g,i),r.visualBlock){var p=new Array(e.getOption("tabSize")+1).join(" ");c=e.getSelection(),c=c.replace(/\t/g,p).replace(/[^\n]/g,i).split(`
`),e.replaceSelections(c)}else e.replaceRange(c,o,s);r.visualMode?(o=q(l[0].anchor,l[0].head)?l[0].anchor:l[0].head,e.setCursor(o),we(e,!1)):e.setCursor(ue(s,0,-1))}},incrementNumberToken:function(e,t){for(var r=e.getCursor(),i=e.getLine(r.line),o=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi,a,s,l,u;(a=o.exec(i))!==null&&(s=a.index,l=s+a[0].length,!(r.ch<l)););if(!(!t.backtrack&&l<=r.ch)){if(a){var c=a[2]||a[4],p=a[3]||a[5],C=t.increase?1:-1,m={"0b":2,0:8,"":10,"0x":16}[c.toLowerCase()],y=parseInt(a[1]+p,m)+C*t.repeat;u=y.toString(m);var b=c?new Array(p.length-u.length+1+a[1].length).join("0"):"";u.charAt(0)==="-"?u="-"+c+b+u.substr(1):u=c+b+u;var x=new S(r.line,s),M=new S(r.line,l);e.replaceRange(u,x,M)}else return;e.setCursor(new S(r.line,s+u.length-1))}},repeatLastEdit:function(e,t,r){var i=r.lastEditInputState;if(i){var o=t.repeat;o&&t.repeatIsExplicit?r.lastEditInputState.repeatOverride=o:o=r.lastEditInputState.repeatOverride||o,Kt(e,r,o,!1)}},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:We};function Qt(n,e){tt[n]=e}function pe(n,e){var t=n.state.vim,r=t.insertMode||t.visualMode,i=Math.min(Math.max(n.firstLine(),e.line),n.lastLine()),o=te(n,i)-1+!!r,a=Math.min(Math.max(0,e.ch),o);return new S(i,a)}function Ge(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function ue(n,e,t){return re(e)==="object"&&(t=e.ch,e=e.line),new S(n.line+e,n.ch+t)}function Jt(n,e,t,r){for(var i,o=[],a=[],s=0;s<e.length;s++){var l=e[s];t=="insert"&&l.context!="insert"||l.context&&l.context!=t||r.operator&&l.type=="action"||!(i=zt(n,l.keys))||(i=="partial"&&o.push(l),i=="full"&&a.push(l))}return{partial:o.length&&o,full:a.length&&a}}function zt(n,e){if(e.slice(-11)=="<character>"){var t=e.length-11,r=n.slice(0,t),i=e.slice(0,t);return r==i&&n.length>t?"full":i.indexOf(r)==0?"partial":!1}else return n==e?"full":e.indexOf(n)==0?"partial":!1}function Gt(n){var e=/^.*(<[^>]+>)$/.exec(n),t=e?e[1]:n.slice(-1);if(t.length>1)switch(t){case"<CR>":t=`
`;break;case"<Space>":t=" ";break;default:t="";break}return t}function ct(n,e,t){return function(){for(var r=0;r<t;r++)e(n)}}function J(n){return new S(n.line,n.ch)}function ge(n,e){return n.ch==e.ch&&n.line==e.line}function q(n,e){return n.line<e.line||n.line==e.line&&n.ch<e.ch}function ye(n,e){return arguments.length>2&&(e=ye.apply(void 0,Array.prototype.slice.call(arguments,1))),q(n,e)?n:e}function Oe(n,e){return arguments.length>2&&(e=Oe.apply(void 0,Array.prototype.slice.call(arguments,1))),q(n,e)?e:n}function ht(n,e,t){var r=q(n,e),i=q(e,t);return r&&i}function te(n,e){return n.getLine(e).length}function rt(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function Xt(n){return n.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function Yt(n,e,t){var r=te(n,e),i=new Array(t-r+1).join(" ");n.setCursor(new S(e,r)),n.replaceRange(i,n.getCursor())}function dt(n,e){var t=[],r=n.listSelections(),i=J(n.clipPos(e)),o=!ge(e,i),a=n.getCursor("head"),s=qt(r,a),l=ge(r[s].head,r[s].anchor),u=r.length-1,c=u-s>s?u:0,p=r[c].anchor,C=Math.min(p.line,i.line),m=Math.max(p.line,i.line),y=p.ch,b=i.ch,x=r[c].head.ch-y,M=b-y;x>0&&M<=0?(y++,o||b--):x<0&&M>=0?(y--,l||b++):x<0&&M==-1&&(y--,b++);for(var O=C;O<=m;O++){var R={anchor:new S(O,y),head:new S(O,b)};t.push(R)}return n.setSelections(t),e.ch=b,p.ch=y,p}function pt(n,e,t){for(var r=[],i=0;i<t;i++){var o=ue(e,i,0);r.push({anchor:o,head:o})}n.setSelections(r,0)}function qt(n,e,t){for(var r=0;r<n.length;r++){var i=ge(n[r].anchor,e),o=ge(n[r].head,e);if(i||o)return r}return-1}function Zt(n,e){var t=e.lastSelection,r=function(){var a=n.listSelections(),s=a[0],l=a[a.length-1],u=q(s.anchor,s.head)?s.anchor:s.head,c=q(l.anchor,l.head)?l.head:l.anchor;return[u,c]},i=function(){var a=n.getCursor(),s=n.getCursor(),l=t.visualBlock;if(l){var u=l.width,c=l.height;s=new S(a.line+c,a.ch+u);for(var p=[],C=a.line;C<s.line;C++){var m=new S(C,a.ch),y=new S(C,s.ch),b={anchor:m,head:y};p.push(b)}n.setSelections(p)}else{var x=t.anchorMark.find(),M=t.headMark.find(),O=M.line-x.line,R=M.ch-x.ch;s={line:s.line+O,ch:O?s.ch:R+s.ch},t.visualLine&&(a=new S(a.line,0),s=new S(s.line,te(n,s.line))),n.setSelection(a,s)}return[a,s]};return e.visualMode?r():i()}function vt(n,e){var t=e.sel.anchor,r=e.sel.head;e.lastPastedText&&(r=n.posFromIndex(n.indexFromPos(t)+e.lastPastedText.length),e.lastPastedText=null),e.lastSelection={anchorMark:n.setBookmark(t),headMark:n.setBookmark(r),anchor:J(t),head:J(r),visualMode:e.visualMode,visualLine:e.visualLine,visualBlock:e.visualBlock}}function er(n,e,t){var r=n.state.vim.sel,i=r.head,o=r.anchor,a;return q(t,e)&&(a=t,t=e,e=a),q(i,o)?(i=ye(e,i),o=Oe(o,t)):(o=ye(e,o),i=Oe(i,t),i=ue(i,0,-1),i.ch==-1&&i.line!=n.firstLine()&&(i=new S(i.line-1,te(n,i.line-1)))),[o,i]}function De(n,e,i){var r=n.state.vim;e=e||r.sel;var i=i||r.visualLine?"line":r.visualBlock?"block":"char",o=nt(n,e,i);n.setSelections(o.ranges,o.primary)}function nt(n,e,t,r){var i=J(e.head),o=J(e.anchor);if(t=="char"){var a=!r&&!q(e.head,e.anchor)?1:0,s=q(e.head,e.anchor)?1:0;return i=ue(e.head,0,a),o=ue(e.anchor,0,s),{ranges:[{anchor:o,head:i}],primary:0}}else if(t=="line"){if(q(e.head,e.anchor))i.ch=0,o.ch=te(n,o.line);else{o.ch=0;var l=n.lastLine();i.line>l&&(i.line=l),i.ch=te(n,i.line)}return{ranges:[{anchor:o,head:i}],primary:0}}else if(t=="block"){var u=Math.min(o.line,i.line),c=o.ch,p=Math.max(o.line,i.line),C=i.ch;c<C?C+=1:c+=1;for(var m=p-u+1,y=i.line==u?0:m-1,b=[],x=0;x<m;x++)b.push({anchor:new S(u+x,c),head:new S(u+x,C)});return{ranges:b,primary:y}}}function tr(n){var e=n.getCursor("head");return n.getSelection().length==1&&(e=ye(e,n.getCursor("anchor"))),e}function we(n,e){var t=n.state.vim;e!==!1&&n.setCursor(pe(n,t.sel.head)),vt(n,t),t.visualMode=!1,t.visualLine=!1,t.visualBlock=!1,t.insertMode||k.default.signal(n,"vim-mode-change",{mode:"normal"})}function rr(n,e,t){var r=n.getRange(e,t);if(/\n\s*$/.test(r)){var i=r.split(`
`);i.pop();for(var o,o=i.pop();i.length>0&&o&&v(o);o=i.pop())t.line--,t.ch=0;o?(t.line--,t.ch=te(n,t.line)):t.ch=0}}function nr(n,e,t){e.ch=0,t.ch=0,t.line++}function Se(n){if(!n)return 0;var e=n.search(/\S/);return e==-1?n.length:e}function Xe(n,e,t,r,i){for(var o=tr(n),a=n.getLine(o.line),s=o.ch,l=i?_e[0]:xe[0];!l(a.charAt(s));)if(s++,s>=a.length)return null;r?l=xe[0]:(l=_e[0],l(a.charAt(s))||(l=_e[1]));for(var u=s,c=s;l(a.charAt(u))&&u<a.length;)u++;for(;l(a.charAt(c))&&c>=0;)c--;if(c++,e){for(var p=u;/\s/.test(a.charAt(u))&&u<a.length;)u++;if(p==u){for(var C=c;/\s/.test(a.charAt(c-1))&&c>0;)c--;c||(c=C)}}return{start:new S(o.line,c),end:new S(o.line,u)}}function ir(n,e,t){var r=e;if(!k.default.findMatchingTag||!k.default.findEnclosingTag)return{start:r,end:r};var i=k.default.findMatchingTag(n,e)||k.default.findEnclosingTag(n,e);return!i||!i.open||!i.close?{start:r,end:r}:t?{start:i.open.from,end:i.close.to}:{start:i.open.to,end:i.close.from}}function gt(n,e,t){ge(e,t)||L.jumpList.add(n,e,t)}function yt(n,e){L.lastCharacterSearch.increment=n,L.lastCharacterSearch.forward=e.forward,L.lastCharacterSearch.selectedCharacter=e.selectedCharacter}var or={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},mt={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return e.index===0&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t=e.lastCh==="*"&&e.nextCh==="/";return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb=e.symb==="m"?"{":"}",e.reverseSymb=e.symb==="{"?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if(e.nextCh==="#"){var t=e.lineText.match(/^#(\w+)/)[1];if(t==="endif"){if(e.forward&&e.depth===0)return!0;e.depth++}else if(t==="if"){if(!e.forward&&e.depth===0)return!0;e.depth--}if(t==="else"&&e.depth===0)return!0}return!1}}};function ar(n,e,t,r){var i=J(n.getCursor()),o=t?1:-1,a=t?n.lineCount():-1,s=i.ch,l=i.line,u=n.getLine(l),c={lineText:u,nextCh:u.charAt(s),lastCh:null,index:s,symb:r,reverseSymb:(t?{")":"(","}":"{"}:{"(":")","{":"}"})[r],forward:t,depth:0,curMoveThrough:!1},p=or[r];if(!p)return i;var C=mt[p].init,m=mt[p].isComplete;for(C&&C(c);l!==a&&e;){if(c.index+=o,c.nextCh=c.lineText.charAt(c.index),!c.nextCh){if(l+=o,c.lineText=n.getLine(l)||"",o>0)c.index=0;else{var y=c.lineText.length;c.index=y>0?y-1:0}c.nextCh=c.lineText.charAt(c.index)}m(c)&&(i.line=l,i.ch=c.index,e--)}return c.nextCh||c.curMoveThrough?new S(l,c.index):i}function sr(n,e,t,r,i){var o=e.line,a=e.ch,s=n.getLine(o),l=t?1:-1,u=r?xe:_e;if(i&&s==""){if(o+=l,s=n.getLine(o),!g(n,o))return null;a=t?0:s.length}for(;;){if(i&&s=="")return{from:0,to:0,line:o};for(var c=l>0?s.length:-1,p=c,C=c;a!=c;){for(var m=!1,y=0;y<u.length&&!m;++y)if(u[y](s.charAt(a))){for(p=a;a!=c&&u[y](s.charAt(a));)a+=l;if(C=a,m=p!=C,p==e.ch&&o==e.line&&C==p+l)continue;return{from:Math.min(p,C+1),to:Math.max(p,C),line:o}}m||(a+=l)}if(o+=l,!g(n,o))return null;s=n.getLine(o),a=l>0?0:s.length}}function lr(n,e,t,r,i,o){var a=J(e),s=[];(r&&!i||!r&&i)&&t++;for(var l=!(r&&i),u=0;u<t;u++){var c=sr(n,e,r,o,l);if(!c){var p=te(n,n.lastLine());s.push(r?{line:n.lastLine(),from:p,to:p}:{line:0,from:0,to:0});break}s.push(c),e=new S(c.line,r?c.to-1:c.from)}var C=s.length!=t,m=s[0],y=s.pop();return r&&!i?(!C&&(m.from!=a.ch||m.line!=a.line)&&(y=s.pop()),new S(y.line,y.from)):r&&i?new S(y.line,y.to-1):!r&&i?(!C&&(m.to!=a.ch||m.line!=a.line)&&(y=s.pop()),new S(y.line,y.to)):new S(y.line,y.from)}function Ct(n,e,t,r,i){var o=e,a=new S(o.line+t.repeat-1,1/0),s=n.clipPos(a);return s.ch--,i||(r.lastHPos=1/0,r.lastHSPos=n.charCoords(s,"div").left),a}function it(n,e,t,r){for(var i=n.getCursor(),o=i.ch,a,s=0;s<e;s++){var l=n.getLine(i.line);if(a=fr(o,l,r,t),a==-1)return null;o=a}return new S(n.getCursor().line,a)}function ur(n,e){var t=n.getCursor().line;return pe(n,new S(t,e-1))}function Ae(n,e,t,r){A(t,Je)&&(e.marks[t]&&e.marks[t].clear(),e.marks[t]=n.setBookmark(r))}function fr(n,e,t,r,i){var o;return r?o=e.indexOf(t,n+1):o=e.lastIndexOf(t,n-1),o}function kt(n,e,t,r,i){var o=e.line,a=n.firstLine(),s=n.lastLine(),l,u,c=o;function p(x){return!n.getLine(x)}function C(x,M,O){return O?p(x)!=p(x+M):!p(x)&&p(x+M)}if(r){for(;a<=c&&c<=s&&t>0;)C(c,r)&&t--,c+=r;return new S(c,0)}var m=n.state.vim;if(m.visualLine&&C(o,1,!0)){var y=m.sel.anchor;C(y.line,-1,!0)&&(!i||y.line!=o)&&(o+=1)}var b=p(o);for(c=o;c<=s&&t;c++)C(c,1,!0)&&(!i||p(c)!=b)&&t--;for(u=new S(c,0),c>s&&!b?b=!0:i=!1,c=o;c>a&&!((!i||p(c)==b||c==o)&&C(c,-1,!0));c--);return l=new S(c,0),{start:l,end:u}}function cr(n,e,t,r){function i(l,u){if(u.pos+u.dir<0||u.pos+u.dir>=u.line.length){if(u.ln+=u.dir,!g(l,u.ln)){u.line=null,u.ln=null,u.pos=null;return}u.line=l.getLine(u.ln),u.pos=u.dir>0?0:u.line.length-1}else u.pos+=u.dir}function o(l,u,c,p){var x=l.getLine(u),C=x==="",m={line:x,ln:u,pos:c,dir:p},y={ln:m.ln,pos:m.pos},b=m.line==="";for(i(l,m);m.line!==null;){if(y.ln=m.ln,y.pos=m.pos,m.line===""&&!b)return{ln:m.ln,pos:m.pos};if(C&&m.line!==""&&!v(m.line[m.pos]))return{ln:m.ln,pos:m.pos};w(m.line[m.pos])&&!C&&(m.pos===m.line.length-1||v(m.line[m.pos+1]))&&(C=!0),i(l,m)}var x=l.getLine(y.ln);y.pos=0;for(var M=x.length-1;M>=0;--M)if(!v(x[M])){y.pos=M;break}return y}function a(l,u,c,p){var b=l.getLine(u),C={line:b,ln:u,pos:c,dir:p},m={ln:C.ln,pos:null},y=C.line==="";for(i(l,C);C.line!==null;){if(C.line===""&&!y)return m.pos!==null?m:{ln:C.ln,pos:C.pos};if(w(C.line[C.pos])&&m.pos!==null&&!(C.ln===m.ln&&C.pos+1===m.pos))return m;C.line!==""&&!v(C.line[C.pos])&&(y=!1,m={ln:C.ln,pos:C.pos}),i(l,C)}var b=l.getLine(m.ln);m.pos=0;for(var x=0;x<b.length;++x)if(!v(b[x])){m.pos=x;break}return m}for(var s={ln:e.line,pos:e.ch};t>0;)r<0?s=a(n,s.ln,s.pos,r):s=o(n,s.ln,s.pos,r),t--;return new S(s.ln,s.pos)}function hr(n,e,t,r){var i=e,o,a,s={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[t],l={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[t],u=n.getLine(i.line).charAt(i.ch),c=u===l?1:0;if(o=n.scanForBracket(new S(i.line,i.ch+c),-1,void 0,{bracketRegex:s}),a=n.scanForBracket(new S(i.line,i.ch+c),1,void 0,{bracketRegex:s}),!o||!a)return{start:i,end:i};if(o=o.pos,a=a.pos,o.line==a.line&&o.ch>a.ch||o.line>a.line){var p=o;o=a,a=p}return r?a.ch+=1:o.ch+=1,{start:o,end:a}}function dr(n,e,t,r){var i=J(e),o=n.getLine(i.line),a=o.split(""),s,l,u,c,p=a.indexOf(t);if(i.ch<p?i.ch=p:p<i.ch&&a[i.ch]==t&&(l=i.ch,--i.ch),a[i.ch]==t&&!l)s=i.ch+1;else for(u=i.ch;u>-1&&!s;u--)a[u]==t&&(s=u+1);if(s&&!l)for(u=s,c=a.length;u<c&&!l;u++)a[u]==t&&(l=u);return!s||!l?{start:i,end:i}:(r&&(--s,++l),{start:new S(i.line,s),end:new S(i.line,l)})}V("pcre",!0,"boolean");function wt(){}wt.prototype={getQuery:function(){return L.query},setQuery:function(e){L.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return L.isReversed},setReversed:function(e){L.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}};function Me(n){var e=n.state.vim;return e.searchState_||(e.searchState_=new wt)}function pr(n){return St(n,"/")}function vr(n){return Mt(n,"/")}function St(n,e){var t=Mt(n,e)||[];if(!t.length)return[];var r=[];if(t[0]===0){for(var i=0;i<t.length;i++)typeof t[i]=="number"&&r.push(n.substring(t[i]+1,t[i+1]));return r}}function Mt(n,e){e||(e="/");for(var t=!1,r=[],i=0;i<n.length;i++){var o=n.charAt(i);!t&&o==e&&r.push(i),t=!t&&o=="\\"}return r}function gr(n){for(var e="|(){",t="}",r=!1,i=[],o=-1;o<n.length;o++){var a=n.charAt(o)||"",s=n.charAt(o+1)||"",l=s&&e.indexOf(s)!=-1;r?((a!=="\\"||!l)&&i.push(a),r=!1):a==="\\"?(r=!0,s&&t.indexOf(s)!=-1&&(l=!0),(!l||s==="\\")&&i.push(a)):(i.push(a),l&&s!=="\\"&&i.push("\\"))}return i.join("")}var bt={"\\n":`
`,"\\r":"\r","\\t":"	"};function yr(n){for(var e=!1,t=[],r=-1;r<n.length;r++){var i=n.charAt(r)||"",o=n.charAt(r+1)||"";bt[i+o]?(t.push(bt[i+o]),r++):e?(t.push(i),e=!1):i==="\\"?(e=!0,f(o)||o==="$"?t.push("$"):o!=="/"&&o!=="\\"&&t.push("\\")):(i==="$"&&t.push("$"),t.push(i),o==="/"&&t.push("\\"))}return t.join("")}var xt={"\\/":"/","\\\\":"\\","\\n":`
`,"\\r":"\r","\\t":"	","\\&":"&"};function mr(n){for(var e=new k.default.StringStream(n),t=[];!e.eol();){for(;e.peek()&&e.peek()!="\\";)t.push(e.next());var r=!1;for(var i in xt)if(e.match(i,!0)){r=!0,t.push(xt[i]);break}r||t.push(e.next())}return t.join("")}function Cr(n,e,t){var r=L.registerController.getRegister("/");if(r.setText(n),n instanceof RegExp)return n;var i=vr(n),o,a;if(!i.length)o=n;else{o=n.substring(0,i[0]);var s=n.substring(i[0]);a=s.indexOf("i")!=-1}if(!o)return null;Q("pcre")||(o=gr(o)),t&&(e=/^[^A-Z]*$/.test(o));var l=new RegExp(o,e||a?"im":"m");return l}function Pe(n){typeof n=="string"&&(n=document.createElement(n));for(var e,t=1;t<arguments.length;t++)if(e=arguments[t])if(re(e)!=="object"&&(e=document.createTextNode(e)),e.nodeType)n.appendChild(e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(r[0]==="$"?n.style[r.slice(1)]=e[r]:n.setAttribute(r,e[r]));return n}function j(n,e){var t=Pe("pre",{$color:"red",class:"cm-vim-message"},e);n.openNotification?n.openNotification(t,{bottom:!0,duration:5e3}):alert(t.innerText)}function kr(n,e){return Pe(document.createDocumentFragment(),Pe("span",{$fontFamily:"monospace",$whiteSpace:"pre"},n,Pe("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})),e&&Pe("span",{$color:"#888"},e))}function Ye(n,e){var t=kr(e.prefix,e.desc);if(n.openDialog)n.openDialog(t,e.onClose,{onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:e.value});else{var r="";typeof e.prefix!="string"&&e.prefix&&(r+=e.prefix.textContent),e.desc&&(r+=" "+e.desc),e.onClose(prompt(r,""))}}function wr(n,e){if(n instanceof RegExp&&e instanceof RegExp){for(var t=["global","multiline","ignoreCase","source"],r=0;r<t.length;r++){var i=t[r];if(n[i]!==e[i])return!1}return!0}return!1}function He(n,e,t,r){if(e){var i=Me(n),o=Cr(e,!!t,!!r);if(o)return Lt(n,o),wr(o,i.getQuery())||i.setQuery(o),o}}function Sr(n){if(n.source.charAt(0)=="^")var e=!0;return{token:function(r){if(e&&!r.sol()){r.skipToEnd();return}var i=r.match(n,!1);if(i)return i[0].length==0?(r.next(),"searching"):!r.sol()&&(r.backUp(1),!n.exec(r.next()+i[0]))?(r.next(),null):(r.match(n),"searching");for(;!r.eol()&&(r.next(),!r.match(n,!1)););},query:n}}var qe=0;function Lt(n,e){clearTimeout(qe),qe=setTimeout(function(){if(n.state.vim){var t=Me(n),r=t.getOverlay();(!r||e!=r.query)&&(r&&n.removeOverlay(r),r=Sr(e),n.addOverlay(r),n.showMatchesOnScrollbar&&(t.getScrollbarAnnotate()&&t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(n.showMatchesOnScrollbar(e))),t.setOverlay(r))}},50)}function At(n,e,t,r){return r===void 0&&(r=1),n.operation(function(){for(var i=n.getCursor(),o=n.getSearchCursor(t,i),a=0;a<r;a++){var s=o.find(e);if(a==0&&s&&ge(o.from(),i)){var l=e?o.from():o.to();s=o.find(e),s&&!s[0]&&ge(o.from(),l)&&n.getLine(l.line).length==l.ch&&(s=o.find(e))}if(!s&&(o=n.getSearchCursor(t,e?new S(n.lastLine()):new S(n.firstLine(),0)),!o.find(e)))return}return o.from()})}function Mr(n,e,t,r,i){return r===void 0&&(r=1),n.operation(function(){var o=n.getCursor(),a=n.getSearchCursor(t,o),s=a.find(!e);!i.visualMode&&s&&ge(a.from(),o)&&a.find(!e);for(var l=0;l<r;l++)if(s=a.find(e),!s&&(a=n.getSearchCursor(t,e?new S(n.lastLine()):new S(n.firstLine(),0)),!a.find(e)))return;return[a.from(),a.to()]})}function ot(n){var e=Me(n);n.removeOverlay(Me(n).getOverlay()),e.setOverlay(null),e.getScrollbarAnnotate()&&(e.getScrollbarAnnotate().clear(),e.setScrollbarAnnotate(null))}function br(n,e,t){return typeof n!="number"&&(n=n.line),e instanceof Array?A(n,e):typeof t=="number"?n>=e&&n<=t:n==e}function at(n){var e=n.getScrollInfo(),t=6,r=10,i=n.coordsChar({left:0,top:t+e.top},"local"),o=e.clientHeight-r+e.top,a=n.coordsChar({left:0,top:o},"local");return{top:i.line,bottom:a.line}}function Tt(n,e,t){if(t=="'"||t=="`")return L.jumpList.find(n,-1)||new S(0,0);if(t==".")return It(n);var r=e.marks[t];return r&&r.find()}function It(n){for(var e=n.doc.history.done,t=e.length;t--;)if(e[t].changes)return J(e[t].changes[0].to)}var Rt=function(){this.buildCommandMap_()};Rt.prototype={processCommand:function(e,t,r){var i=this;e.operation(function(){e.curOp.isVimOp=!0,i._processCommand(e,t,r)})},_processCommand:function(e,t,r){var i=e.state.vim,o=L.registerController.getRegister(":"),a=o.toString();i.visualMode&&we(e);var s=new k.default.StringStream(t);o.setText(t);var l=r||{};l.input=t;try{this.parseInput_(e,s,l)}catch(C){throw j(e,C.toString()),C}var u,c;if(!l.commandName)l.line!==void 0&&(c="move");else if(u=this.matchCommand_(l.commandName),u){if(c=u.name,u.excludeFromCommandHistory&&o.setText(a),this.parseCommandArgs_(s,l,u),u.type=="exToKey"){for(var p=0;p<u.toKeys.length;p++)Ne.handleKey(e,u.toKeys[p],"mapping");return}else if(u.type=="exToEx"){this.processCommand(e,u.toInput);return}}if(!c){j(e,'Not an editor command ":'+t+'"');return}try{Et[c](e,l),(!u||!u.possiblyAsync)&&l.callback&&l.callback()}catch(C){throw j(e,C.toString()),C}},parseInput_:function(e,t,r){t.eatWhile(":"),t.eat("%")?(r.line=e.firstLine(),r.lineEnd=e.lastLine()):(r.line=this.parseLineSpec_(e,t),r.line!==void 0&&t.eat(",")&&(r.lineEnd=this.parseLineSpec_(e,t)));var i=t.match(/^(\w+|!!|@@|[!#&*<=>@~])/);return i?r.commandName=i[1]:r.commandName=t.match(/.*/)[0],r},parseLineSpec_:function(e,t){var r=t.match(/^(\d+)/);if(r)return parseInt(r[1],10)-1;switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var i=t.next(),o=Tt(e,e.state.vim,i);if(!o)throw new Error("Mark not set");return this.parseLineSpecOffset_(t,o.line);case"-":case"+":return t.backUp(1),this.parseLineSpecOffset_(t,e.getCursor().line);default:t.backUp(1);return}},parseLineSpecOffset_:function(e,t){var r=e.match(/^([+-])?(\d+)/);if(r){var i=parseInt(r[2],10);r[1]=="-"?t-=i:t+=i}return t},parseCommandArgs_:function(e,t,r){if(!e.eol()){t.argString=e.match(/.*/)[0];var i=r.argDelimiter||/\s+/,o=rt(t.argString).split(i);o.length&&o[0]&&(t.args=o)}},matchCommand_:function(e){for(var t=e.length;t>0;t--){var r=e.substring(0,t);if(this.commandMap_[r]){var i=this.commandMap_[r];if(i.name.indexOf(e)===0)return i}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0;e<_.length;e++){var t=_[e],r=t.shortName||t.name;this.commandMap_[r]=t}},map:function(e,t,r){if(e!=":"&&e.charAt(0)==":"){if(r)throw Error("Mode not supported for ex mappings");var i=e.substring(1);t!=":"&&t.charAt(0)==":"?this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:!0}:this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:!0}}else if(t!=":"&&t.charAt(0)==":"){var o={keys:e,type:"keyToEx",exArgs:{input:t.substring(1)}};r&&(o.context=r),$.unshift(o)}else{var o={keys:e,type:"keyToKey",toKeys:t};r&&(o.context=r),$.unshift(o)}},unmap:function(e,t){if(e!=":"&&e.charAt(0)==":"){if(t)throw Error("Mode not supported for ex mappings");var r=e.substring(1);if(this.commandMap_[r]&&this.commandMap_[r].user)return delete this.commandMap_[r],!0}else for(var i=e,o=0;o<$.length;o++)if(i==$[o].keys&&$[o].context===t)return $.splice(o,1),!0}};var Et={colorscheme:function(e,t){if(!t.args||t.args.length<1){j(e,e.getOption("theme"));return}e.setOption("theme",t.args[0])},map:function(e,t,r){var i=t.args;if(!i||i.length<2){e&&j(e,"Invalid mapping: "+t.input);return}be.map(i[0],i[1],r)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},unmap:function(e,t,r){var i=t.args;(!i||i.length<1||!be.unmap(i[0],r))&&e&&j(e,"No such mapping: "+t.input)},move:function(e,t){Ie.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e,t){var r=t.args,i=t.setCfg||{};if(!r||r.length<1){e&&j(e,"Invalid mapping: "+t.input);return}var o=r[0].split("="),a=o[0],s=o[1],l=!1;if(a.charAt(a.length-1)=="?"){if(s)throw Error("Trailing characters: "+t.argString);a=a.substring(0,a.length-1),l=!0}s===void 0&&a.substring(0,2)=="no"&&(a=a.substring(2),s=!1);var u=P[a]&&P[a].type=="boolean";if(u&&s==null&&(s=!0),!u&&s===void 0||l){var c=Q(a,e,i);c instanceof Error?j(e,c.message):c===!0||c===!1?j(e," "+(c?"":"no")+a):j(e,"  "+a+"="+c)}else{var p=N(a,s,e,i);p instanceof Error&&j(e,p.message)}},setlocal:function(e,t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e,t){var r=t.args,i=L.registerController.registers,o=`----------Registers----------

`;if(r){var a;r=r.join("");for(var l=0;l<r.length;l++)if(a=r.charAt(l),!!L.registerController.isValidRegister(a)){var u=i[a]||new ke;o+='"'+a+"    "+u.toString()+`
`}}else for(var a in i){var s=i[a].toString();s.length&&(o+='"'+a+"    "+s+`
`)}j(e,o)},sort:function(e,t){var r,i,o,a,s;function l(){if(t.argString){var H=new k.default.StringStream(t.argString);if(H.eat("!")&&(r=!0),H.eol())return;if(!H.eatSpace())return"Invalid arguments";var D=H.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!D&&!H.eol())return"Invalid arguments";if(D[1]){i=D[1].indexOf("i")!=-1,o=D[1].indexOf("u")!=-1;var ne=D[1].indexOf("d")!=-1||D[1].indexOf("n")!=-1&&1,ce=D[1].indexOf("x")!=-1&&1,le=D[1].indexOf("o")!=-1&&1;if(ne+ce+le>1)return"Invalid arguments";a=ne&&"decimal"||ce&&"hex"||le&&"octal"}D[2]&&(s=new RegExp(D[2].substr(1,D[2].length-2),i?"i":""))}}var u=l();if(u){j(e,u+": "+t.argString);return}var c=t.line||e.firstLine(),p=t.lineEnd||t.line||e.lastLine();if(c==p)return;var C=new S(c,0),m=new S(p,te(e,p)),y=e.getRange(C,m).split(`
`),b=s||(a=="decimal"?/(-?)([\d]+)/:a=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:a=="octal"?/([0-7]+)/:null),x=a=="decimal"?10:a=="hex"?16:a=="octal"?8:null,M=[],O=[];if(a||s)for(var R=0;R<y.length;R++){var E=s?y[R].match(s):null;E&&E[0]!=""?M.push(E):!s&&b.exec(y[R])?M.push(y[R]):O.push(y[R])}else O=y;function U(H,D){if(r){var ne;ne=H,H=D,D=ne}i&&(H=H.toLowerCase(),D=D.toLowerCase());var ce=a&&b.exec(H),le=a&&b.exec(D);return ce?(ce=parseInt((ce[1]+ce[2]).toLowerCase(),x),le=parseInt((le[1]+le[2]).toLowerCase(),x),ce-le):H<D?-1:1}function fe(H,D){if(r){var ne;ne=H,H=D,D=ne}return i&&(H[0]=H[0].toLowerCase(),D[0]=D[0].toLowerCase()),H[0]<D[0]?-1:1}if(M.sort(s?fe:U),s)for(var R=0;R<M.length;R++)M[R]=M[R].input;else a||O.sort(U);if(y=r?M.concat(O):O.concat(M),o){var X=y,se;y=[];for(var R=0;R<X.length;R++)X[R]!=se&&y.push(X[R]),se=X[R]}e.replaceRange(y.join(`
`),C,m)},vglobal:function(e,t){this.global(e,t)},global:function(e,t){var r=t.argString;if(!r){j(e,"Regular Expression missing from global");return}var i=t.commandName[0]==="v",o=t.line!==void 0?t.line:e.firstLine(),a=t.lineEnd||t.line||e.lastLine(),s=pr(r),l=r,u;if(s.length&&(l=s[0],u=s.slice(1,s.length).join("/")),l)try{He(e,l,!0,!0)}catch{j(e,"Invalid regex: "+l);return}for(var c=Me(e).getQuery(),p=[],C=o;C<=a;C++){var m=e.getLineHandle(C),y=c.test(m.text);y!==i&&p.push(u?m:m.text)}if(!u){j(e,p.join(`
`));return}var b=0,x=function(){if(b<p.length){var O=p[b++],R=e.getLineNumber(O);if(R==null){x();return}var E=R+1+u;be.processCommand(e,E,{callback:x})}};x()},substitute:function(e,t){if(!e.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var r=t.argString,i=r?St(r,r[0]):[],o,a="",s,l,u,c=!1,p=!1;if(i.length)o=i[0],Q("pcre")&&o!==""&&(o=new RegExp(o).source),a=i[1],a!==void 0&&(Q("pcre")?a=mr(a.replace(/([^\\])&/g,"$1$$&")):a=yr(a),L.lastSubstituteReplacePart=a),s=i[2]?i[2].split(" "):[];else if(r&&r.length){j(e,"Substitutions should be of the form :s/pattern/replace/");return}if(s&&(l=s[0],u=parseInt(s[1]),l&&(l.indexOf("c")!=-1&&(c=!0),l.indexOf("g")!=-1&&(p=!0),Q("pcre")?o=o+"/"+l:o=o.replace(/\//g,"\\/")+"/"+l)),o)try{He(e,o,!0,!0)}catch{j(e,"Invalid regex: "+o);return}if(a=a||L.lastSubstituteReplacePart,a===void 0){j(e,"No previous substitute regular expression");return}var C=Me(e),m=C.getQuery(),y=t.line!==void 0?t.line:e.getCursor().line,b=t.lineEnd||y;y==e.firstLine()&&b==e.lastLine()&&(b=1/0),u&&(y=b,b=y+u-1);var x=pe(e,new S(y,0)),M=e.getSearchCursor(m,x);e.pushUndoStop(),xr(e,c,p,y,b,M,m,a,t.callback)},redo:k.default.commands.redo,undo:k.default.commands.undo,write:function(e){k.default.commands.save?k.default.commands.save(e):e.save&&e.save()},nohlsearch:function(e){ot(e)},yank:function(e){var t=J(e.getCursor()),r=t.line,i=e.getLine(r);L.registerController.pushText("0","yank",i,!0,!0)},delmarks:function(e,t){if(!t.argString||!rt(t.argString)){j(e,"Argument required");return}for(var r=e.state.vim,i=new k.default.StringStream(rt(t.argString));!i.eol();){i.eatSpace();var o=i.pos;if(!i.match(/[a-zA-Z]/,!1)){j(e,"Invalid argument: "+t.argString.substring(o));return}var a=i.next();if(i.match("-",!0)){if(!i.match(/[a-zA-Z]/,!1)){j(e,"Invalid argument: "+t.argString.substring(o));return}var s=a,l=i.next();if(h(s)&&h(l)||d(s)&&d(l)){var u=s.charCodeAt(0),c=l.charCodeAt(0);if(u>=c){j(e,"Invalid argument: "+t.argString.substring(o));return}for(var p=0;p<=c-u;p++){var C=String.fromCharCode(u+p);delete r.marks[C]}}else{j(e,"Invalid argument: "+s+"-");return}}else delete r.marks[a]}}},be=new Rt;function xr(n,e,t,r,i,o,a,s,l){n.state.vim.exMode=!0;var u=!1,c,p,C;function m(){n.operation(function(){for(;!u;)y(),x();M()})}function y(){var R=n.getRange(o.from(),o.to()),E=R.replace(a,s),U=o.to().line;o.replace(E),p=o.to().line,i+=p-U,C=p<U}function b(){var R=c&&J(o.to()),E=o.findNext();return E&&!E[0]&&R&&ge(o.from(),R)&&(E=o.findNext()),E}function x(){for(;b()&&br(o.from(),r,i);)if(!(!t&&o.from().line==p&&!C)){n.scrollIntoView(o.from(),30),n.setSelection(o.from(),o.to()),c=o.from(),u=!1;return}u=!0}function M(R){if(R&&R(),n.focus(),c){n.setCursor(c);var E=n.state.vim;E.exMode=!1,E.lastHPos=E.lastHSPos=c.ch}l&&l()}function O(R,E,U){k.default.e_stop(R);var fe=k.default.keyName(R);switch(fe){case"Y":y(),x();break;case"N":x();break;case"A":var X=l;l=void 0,n.operation(m),l=X;break;case"L":y();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":M(U);break}return u&&M(U),!0}if(x(),u){j(n,"No matches for "+a.source);return}if(!e){m(),l&&l();return}Ye(n,{prefix:Pe("span","replace with ",Pe("strong",s)," (y/n/a/q/l)"),onKeyDown:O})}k.default.keyMap.vim={attach:he,detach:Y,call:Te};function We(n){var e=n.state.vim,t=L.macroModeState,r=L.registerController.getRegister("."),i=t.isPlaying,o=t.lastInsertModeChanges;i||(n.off("change",Pt),k.default.off(n.getInputField(),"keydown",_t)),!i&&e.insertModeRepeat>1&&(Kt(n,e,e.insertModeRepeat-1,!0),e.lastEditInputState.repeatOverride=e.insertModeRepeat),delete e.insertModeRepeat,e.insertMode=!1,n.setCursor(n.getCursor().line,n.getCursor().ch-1),n.setOption("keyMap","vim"),n.setOption("disableInput",!0),n.toggleOverwrite(!1),r.setText(o.changes.join("")),k.default.signal(n,"vim-mode-change",{mode:"normal"}),t.isRecording&&Ir(t),n.enterVimMode()}function Ot(n){$.unshift(n)}function Lr(n,e,t,r,i){var o={keys:n,type:e};o[e]=t,o[e+"Args"]=r;for(var a in i)o[a]=i[a];Ot(o)}V("insertModeEscKeysTimeout",200,"number"),k.default.keyMap["vim-insert"]={fallthrough:["default"],attach:he,detach:Y,call:Te},k.default.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:he,detach:Y,call:Te};function Ar(n,e,t,r){var i=L.registerController.getRegister(r);if(r==":"){i.keyBuffer[0]&&be.processCommand(n,i.keyBuffer[0]),t.isPlaying=!1;return}var o=i.keyBuffer,a=0;t.isPlaying=!0,t.replaySearchQueries=i.searchQueries.slice(0);for(var s=0;s<o.length;s++)for(var l=o[s],u,c;l;)if(u=/<\w+-.+?>|<\w+>|./.exec(l),c=u[0],l=l.substring(u.index+c.length),Ne.handleKey(n,c,"macro"),e.insertMode){var p=i.insertModeChanges[a++].changes;L.macroModeState.lastInsertModeChanges.changes=p,Nt(n,p,1),We(n)}t.isPlaying=!1}function Tr(n,e){if(!n.isPlaying){var t=n.latestRegister,r=L.registerController.getRegister(t);r&&r.pushText(e)}}function Ir(n){if(!n.isPlaying){var e=n.latestRegister,t=L.registerController.getRegister(e);t&&t.pushInsertModeChanges&&t.pushInsertModeChanges(n.lastInsertModeChanges)}}function Rr(n,e){if(!n.isPlaying){var t=n.latestRegister,r=L.registerController.getRegister(t);r&&r.pushSearchQuery&&r.pushSearchQuery(e)}}function Pt(n,e){var t=L.macroModeState,r=t.lastInsertModeChanges;if(!t.isPlaying)for(;e;){if(r.expectCursorActivityForChange=!0,r.ignoreCount>1)r.ignoreCount--;else if(e.origin=="+input"||e.origin=="paste"||e.origin===void 0){var i=n.listSelections().length;i>1&&(r.ignoreCount=i);var o=e.text.join(`
`);r.maybeReset&&(r.changes=[],r.maybeReset=!1),o&&(n.state.overwrite&&!/\n/.test(o)?r.changes.push([o]):r.changes.push(o))}e=e.next}}function Bt(n){var e=n.state.vim;if(e.insertMode){var t=L.macroModeState;if(t.isPlaying)return;var r=t.lastInsertModeChanges;r.expectCursorActivityForChange?r.expectCursorActivityForChange=!1:r.maybeReset=!0}else n.curOp.isVimOp||Er(n,e)}function Er(n,e){var t=n.getCursor("anchor"),r=n.getCursor("head");if(e.visualMode&&!n.somethingSelected()?we(n,!1):!e.visualMode&&!e.insertMode&&n.somethingSelected()&&(e.visualMode=!0,e.visualLine=!1,k.default.signal(n,"vim-mode-change",{mode:"visual"})),e.visualMode){var i=q(r,t)?0:-1,o=q(r,t)?-1:0;r=ue(r,0,i),t=ue(t,0,o),e.sel={anchor:t,head:r},Ae(n,e,"<",ye(r,t)),Ae(n,e,">",Oe(r,t))}else e.insertMode||(e.lastHPos=n.getCursor().ch)}function st(n){this.keyName=n}function _t(n){var e=L.macroModeState,t=e.lastInsertModeChanges,r=k.default.keyName(n);if(!r)return;function i(){return t.maybeReset&&(t.changes=[],t.maybeReset=!1),t.changes.push(new st(r)),!0}(r.indexOf("Delete")!=-1||r.indexOf("Backspace")!=-1)&&k.default.lookupKey(r,"vim-insert",i)}function Kt(n,e,t,r){var i=L.macroModeState;i.isPlaying=!0;var o=!!e.lastEditActionCommand,a=e.inputState;function s(){o?Ie.processAction(n,e,e.lastEditActionCommand):Ie.evalInput(n,e)}function l(c){if(i.lastInsertModeChanges.changes.length>0){c=e.lastEditActionCommand?c:1;var p=i.lastInsertModeChanges;Nt(n,p.changes,c)}}if(e.inputState=e.lastEditInputState,o&&e.lastEditActionCommand.interlaceInsertRepeat)for(var u=0;u<t;u++)s(),l(1);else r||s(),l(t);e.inputState=a,e.insertMode&&!r&&We(n),i.isPlaying=!1}function Nt(n,e,t){function r(p){return typeof p=="string"?k.default.commands[p](n):p(n),!0}var i=n.getCursor("head"),o=L.macroModeState.lastInsertModeChanges.visualBlock;o&&(pt(n,i,o+1),t=n.listSelections().length,n.setCursor(i));for(var a=0;a<t;a++){o&&n.setCursor(ue(i,a,0));for(var s=0;s<e.length;s++){var l=e[s];if(l instanceof st)k.default.lookupKey(l.keyName,"vim-insert",r);else if(typeof l=="string")window.cm=n,n.replaceSelections(l);else{var u=n.getCursor(),c=ue(u,0,l[0].length);n.replaceRange(l[0],u,c),n.setCursor(c)}}}o&&n.setCursor(ue(i,0,1))}return Ee(),Ne};k.default.Vim=T(),z.default=k.default})(Ht);var Ft={};(function(z){Object.defineProperty(z,"__esModule",{value:!0}),z.default=void 0;function k(W){"@babel/helpers - typeof";return k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},k(W)}function ve(W,_){if(!(W instanceof _))throw new TypeError("Cannot call a class as a function")}function re(W,_){for(var T=0;T<_.length;T++){var I=_[T];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(W,Z(I.key),I)}}function S(W,_,T){return _&&re(W.prototype,_),Object.defineProperty(W,"prototype",{writable:!1}),W}function Z(W){var _=$(W,"string");return k(_)=="symbol"?_:_+""}function $(W,_){if(k(W)!="object"||!W)return W;var T=W[Symbol.toPrimitive];if(T!==void 0){var I=T.call(W,_);if(k(I)!="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(W)}z.default=function(){function W(_,T){var I=this,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;ve(this,W),this.closeInput=function(){I.removeInputListeners(),I.input=null,I.setSec(""),I.editor&&I.editor.focus()},this.clear=function(){I.setInnerHtml_(I.node,"")},this.inputKeyUp=function(K){var Y=I.input.options;Y&&Y.onKeyUp&&Y.onKeyUp(K,K.target.value,I.closeInput)},this.inputKeyInput=function(K){var Y=I.input.options;Y&&Y.onKeyInput&&Y.onKeyUp(K,K.target.value,I.closeInput)},this.inputBlur=function(){var K=I.input.options;K.closeOnBlur&&I.closeInput()},this.inputKeyDown=function(K){var Y=I.input,he=Y.options,Te=Y.callback;he&&he.onKeyDown&&he.onKeyDown(K,K.target.value,I.closeInput)||((K.keyCode===27||he&&he.closeOnEnter!==!1&&K.keyCode==13)&&(I.input.node.blur(),K.stopPropagation(),I.closeInput()),K.keyCode===13&&Te&&(K.stopPropagation(),K.preventDefault(),Te(K.target.value)))},this.node=_,this.modeInfoNode=document.createElement("span"),this.secInfoNode=document.createElement("span"),this.notifNode=document.createElement("span"),this.notifNode.className="vim-notification",this.keyInfoNode=document.createElement("span"),this.keyInfoNode.setAttribute("style","float: right"),this.node.appendChild(this.modeInfoNode),this.node.appendChild(this.secInfoNode),this.node.appendChild(this.notifNode),this.node.appendChild(this.keyInfoNode),this.toggleVisibility(!1),this.editor=T,this.sanitizer=B}return S(W,[{key:"setMode",value:function(T){if(T.mode==="visual"){T.subMode==="linewise"?this.setText("--VISUAL LINE--"):T.subMode==="blockwise"?this.setText("--VISUAL BLOCK--"):this.setText("--VISUAL--");return}this.setText("--".concat(T.mode.toUpperCase(),"--"))}},{key:"setKeyBuffer",value:function(T){this.keyInfoNode.textContent=T}},{key:"setSec",value:function(T,I,B){if(this.notifNode.textContent="",T===void 0)return this.closeInput;this.setInnerHtml_(this.secInfoNode,T);var K=this.secInfoNode.querySelector("input");return K&&(K.focus(),this.input={callback:I,options:B,node:K},B&&(B.selectValueOnOpen&&K.select(),B.value&&(K.value=B.value)),this.addInputListeners()),this.closeInput}},{key:"setText",value:function(T){this.modeInfoNode.textContent=T}},{key:"toggleVisibility",value:function(T){T?this.node.style.display="block":this.node.style.display="none",this.input&&this.removeInputListeners(),clearInterval(this.notifTimeout)}},{key:"addInputListeners",value:function(){var T=this.input.node;T.addEventListener("keyup",this.inputKeyUp),T.addEventListener("keydown",this.inputKeyDown),T.addEventListener("input",this.inputKeyInput),T.addEventListener("blur",this.inputBlur)}},{key:"removeInputListeners",value:function(){if(!(!this.input||!this.input.node)){var T=this.input.node;T.removeEventListener("keyup",this.inputKeyUp),T.removeEventListener("keydown",this.inputKeyDown),T.removeEventListener("input",this.inputKeyInput),T.removeEventListener("blur",this.inputBlur)}}},{key:"showNotification",value:function(T){var I=this,B=document.createElement("span");this.setInnerHtml_(B,T),this.notifNode.textContent=B.textContent,this.notifTimeout=setTimeout(function(){I.notifNode.textContent=""},5e3)}},{key:"setInnerHtml_",value:function(T,I){for(;T.childNodes.length;)T.removeChild(T.childNodes[0]);I&&(this.sanitizer?T.appendChild(this.sanitizer(I)):T.appendChild(I))}}])}()})(Ft);(function(z){Object.defineProperty(z,"__esModule",{value:!0}),Object.defineProperty(z,"StatusBar",{enumerable:!0,get:function(){return ve.default}}),Object.defineProperty(z,"VimMode",{enumerable:!0,get:function(){return k.default}}),z.initVimMode=S;var k=re(Ht),ve=re(Ft);function re(Z){return Z&&Z.__esModule?Z:{default:Z}}function S(Z){var $=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ve.default,_=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,T=new k.default(Z);if(!$)return T.attach(),T;var I=new W($,Z,_),B="";return T.on("vim-mode-change",function(K){I.setMode(K)}),T.on("vim-keypress",function(K){K===":"?B="":B+=K,I.setKeyBuffer(B)}),T.on("vim-command-done",function(){B="",I.setKeyBuffer(B)}),T.on("dispose",function(){I.toggleVisibility(!1),I.closeInput(),I.clear()}),I.toggleVisibility(!0),T.setStatusBar(I),T.attach(),T}})(Vt);const Vr=Br({__proto__:null},[Vt]);export{Vr as i};
